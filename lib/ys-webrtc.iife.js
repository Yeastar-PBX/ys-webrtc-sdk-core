var YSWebRTC=function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=n(ms);
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function r(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{a(s.next(e))}catch(e){i(e)}}function l(e){try{a(s.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}a((s=s.apply(e,t||[])).next())}))}function i(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)}function o(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n}const l=function(e,t){const n=t||new Date,s=`${n.getFullYear()}`;let r=`${n.getMonth()+1}`;1===r.length&&(r=`0${r}`);let i=`${n.getDate()}`;1===i.length&&(i=`0${i}`);let o=`${n.getHours()}`;1===o.length&&(o=`0${o}`);let l=`${n.getMinutes()}`;1===l.length&&(l=`0${l}`);let a=`${n.getSeconds()}`;return 1===a.length&&(a=`0${a}`),(e||"yyyy-MM-dd hh:mm:ss").replace(/yyyy/g,s).replace(/MM/g,r).replace(/dd/g,i).replace(/hh/g,o).replace(/mm/g,l).replace(/ss/g,a)},a="error";const u=new class{constructor(){this.init=e=>{e||(e={});const{uploadLog:t}=e;if(t)if(this.isInit)console.error("Log has been initialized, please do not repeat initialization!");else{this.resetUploadTime();for(let t in this)void 0!==e[t]&&(this[t]=e[t]);this.isInit=!0,window&&window.addEventListener("unhandledrejection",(e=>this.handleError(e))),window&&window.addEventListener("error",(e=>this.handleError(e)))}else console.log("Log initialization failed, uploadLog field is missing!")},this.resetDate=()=>{this.logList=[]},this.resetUploadTime=()=>{this.uploadTime&&clearTimeout(this.uploadTime),this.uploadTime=setTimeout((()=>{this.doUpload()}),this.maxTime)},this.handleError=({reason:e,message:t,error:n})=>r(this,void 0,void 0,(function*(){var s,r;try{const i=null===(s=null==n?void 0:n.stack)||void 0===s?void 0:s.split(" at ")[1],o=(null===(r=null==i?void 0:i.replace("\n",""))||void 0===r?void 0:r.split("/"))||[],l=o[o.length-1],u=(null==l?void 0:l.split(":"))||[];let c=e;c&&"object"==typeof c&&(c=JSON.stringify(c),c&&(c=c.substring(0,200)));const h={level:a,msg:t,source:u[0],line:u[1],column:u[2]};u[0]&&(yield this.addLog(h))}catch(e){console.error(e)}})),this.doUpload=()=>r(this,void 0,void 0,(function*(){if(this.logList&&this.logList.length){const e=[...this.logList];this.logList=[];const t=(yield this.uploadLog({log_list:e}))||{};t&&t.data&&0===t.data.errcode?this.resetUploadTime():this.logList=[...this.logList,...e]}})),this.addLog=e=>{if(!this.isInit)return void console.error("The log has not been initialized, please initialize it first");const{caller_id_name:t,ext_num:n}=this.extensionInfo,{level:s}=e;this.logList.push(JSON.stringify(Object.assign(Object.assign({},e),{ts:l(),extensionInfo:{caller_id_name:t,ext_num:n}}))),(this.logList.length>=this.maxLogCount||s===a)&&this.doUpload()},this.logList=[],this.maxLogCount=100,this.maxTime=3e5,this.uploadTime=null,this.extensionInfo={},this.uploadLog=()=>{},this.isInit=!1}};var c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function h(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function d(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){if(this instanceof e){var n=[null];return n.push.apply(n,arguments),new(Function.bind.apply(t,n))}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var s=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,s.get?s:{enumerable:!0,get:function(){return e[t]}})})),n}var f="object"==typeof c&&c&&c.Object===Object&&c,_=f,p="object"==typeof self&&self&&self.Object===Object&&self,m=_||p||Function("return this")(),g=m.Symbol,T=g,v=Object.prototype,E=v.hasOwnProperty,C=v.toString,S=T?T.toStringTag:void 0;var A=function(e){var t=E.call(e,S),n=e[S];try{e[S]=void 0;var s=!0}catch(e){}var r=C.call(e);return s&&(t?e[S]=n:delete e[S]),r},R=Object.prototype.toString;var y=A,b=function(e){return R.call(e)},w="[object Null]",I="[object Undefined]",O=g?g.toStringTag:void 0;var N=function(e){return null==e?void 0===e?I:w:O&&O in Object(e)?y(e):b(e)};var D=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},P=N,x=D,L="[object AsyncFunction]",U="[object Function]",k="[object GeneratorFunction]",M="[object Proxy]";var $,F=function(e){if(!x(e))return!1;var t=P(e);return t==U||t==k||t==L||t==M},q=m["__core-js_shared__"],H=($=/[^.]+$/.exec(q&&q.keys&&q.keys.IE_PROTO||""))?"Symbol(src)_1."+$:"";var j=function(e){return!!H&&H in e},B=Function.prototype.toString;var W=F,G=j,V=D,K=function(e){if(null!=e){try{return B.call(e)}catch(e){}try{return e+""}catch(e){}}return""},z=/^\[object .+?Constructor\]$/,J=Function.prototype,X=Object.prototype,Y=J.toString,Q=X.hasOwnProperty,Z=RegExp("^"+Y.call(Q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ee=function(e){return!(!V(e)||G(e))&&(W(e)?Z:z).test(K(e))},te=function(e,t){return null==e?void 0:e[t]};var ne=function(e,t){var n=te(e,t);return ee(n)?n:void 0},se=function(){try{var e=ne(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),re=se;var ie=function(e,t,n){"__proto__"==t&&re?re(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var oe=function(e,t){return e===t||e!=e&&t!=t},le=ie,ae=oe,ue=Object.prototype.hasOwnProperty;var ce=function(e,t,n){var s=e[t];ue.call(e,t)&&ae(s,n)&&(void 0!==n||t in e)||le(e,t,n)},he=ie;var de=function(e,t,n,s){var r=!n;n||(n={});for(var i=-1,o=t.length;++i<o;){var l=t[i],a=s?s(n[l],e[l],l,n,e):void 0;void 0===a&&(a=e[l]),r?he(n,l,a):ce(n,l,a)}return n};var fe=function(e){return e};var _e=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},pe=Math.max;var me=function(e,t,n){return t=pe(void 0===t?e.length-1:t,0),function(){for(var s=arguments,r=-1,i=pe(s.length-t,0),o=Array(i);++r<i;)o[r]=s[t+r];r=-1;for(var l=Array(t+1);++r<t;)l[r]=s[r];return l[t]=n(o),_e(e,this,l)}};var ge=function(e){return function(){return e}},Te=se,ve=Te?function(e,t){return Te(e,"toString",{configurable:!0,enumerable:!1,value:ge(t),writable:!0})}:fe,Ee=800,Ce=16,Se=Date.now;var Ae=function(e){var t=0,n=0;return function(){var s=Se(),r=Ce-(s-n);if(n=s,r>0){if(++t>=Ee)return arguments[0]}else t=0;return e.apply(void 0,arguments)}},Re=Ae(ve),ye=fe,be=me,we=Re;var Ie=9007199254740991;var Oe=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Ie},Ne=F,De=Oe;var Pe=function(e){return null!=e&&De(e.length)&&!Ne(e)},xe=9007199254740991,Le=/^(?:0|[1-9]\d*)$/;var Ue=function(e,t){var n=typeof e;return!!(t=null==t?xe:t)&&("number"==n||"symbol"!=n&&Le.test(e))&&e>-1&&e%1==0&&e<t},ke=oe,Me=Pe,$e=Ue,Fe=D;var qe=function(e,t){return we(be(e,t,ye),e+"")},He=function(e,t,n){if(!Fe(n))return!1;var s=typeof t;return!!("number"==s?Me(n)&&$e(t,n.length):"string"==s&&t in n)&&ke(n[t],e)};var je=function(e){return qe((function(t,n){var s=-1,r=n.length,i=r>1?n[r-1]:void 0,o=r>2?n[2]:void 0;for(i=e.length>3&&"function"==typeof i?(r--,i):void 0,o&&He(n[0],n[1],o)&&(i=r<3?void 0:i,r=1),t=Object(t);++s<r;){var l=n[s];l&&e(t,l,s,i)}return t}))};var Be=function(e,t){for(var n=-1,s=Array(e);++n<e;)s[n]=t(n);return s};var We=function(e){return null!=e&&"object"==typeof e},Ge=N,Ve=We,Ke="[object Arguments]";var ze=function(e){return Ve(e)&&Ge(e)==Ke},Je=We,Xe=Object.prototype,Ye=Xe.hasOwnProperty,Qe=Xe.propertyIsEnumerable,Ze=ze(function(){return arguments}())?ze:function(e){return Je(e)&&Ye.call(e,"callee")&&!Qe.call(e,"callee")},et=Ze,tt=Array.isArray,nt={};var st=function(){return!1};!function(e,t){var n=m,s=st,r=t&&!t.nodeType&&t,i=r&&e&&!e.nodeType&&e,o=i&&i.exports===r?n.Buffer:void 0,l=(o?o.isBuffer:void 0)||s;e.exports=l}({get exports(){return nt},set exports(e){nt=e}},nt);var rt=N,it=Oe,ot=We,lt={};lt["[object Float32Array]"]=lt["[object Float64Array]"]=lt["[object Int8Array]"]=lt["[object Int16Array]"]=lt["[object Int32Array]"]=lt["[object Uint8Array]"]=lt["[object Uint8ClampedArray]"]=lt["[object Uint16Array]"]=lt["[object Uint32Array]"]=!0,lt["[object Arguments]"]=lt["[object Array]"]=lt["[object ArrayBuffer]"]=lt["[object Boolean]"]=lt["[object DataView]"]=lt["[object Date]"]=lt["[object Error]"]=lt["[object Function]"]=lt["[object Map]"]=lt["[object Number]"]=lt["[object Object]"]=lt["[object RegExp]"]=lt["[object Set]"]=lt["[object String]"]=lt["[object WeakMap]"]=!1;var at=function(e){return ot(e)&&it(e.length)&&!!lt[rt(e)]};var ut=function(e){return function(t){return e(t)}},ct={};!function(e,t){var n=f,s=t&&!t.nodeType&&t,r=s&&e&&!e.nodeType&&e,i=r&&r.exports===s&&n.process,o=function(){try{var e=r&&r.require&&r.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=o}({get exports(){return ct},set exports(e){ct=e}},ct);var ht=at,dt=ut,ft=ct&&ct.isTypedArray,_t=ft?dt(ft):ht,pt=Be,mt=et,gt=tt,Tt=nt,vt=Ue,Et=_t,Ct=Object.prototype.hasOwnProperty;var St=function(e,t){var n=gt(e),s=!n&&mt(e),r=!n&&!s&&Tt(e),i=!n&&!s&&!r&&Et(e),o=n||s||r||i,l=o?pt(e.length,String):[],a=l.length;for(var u in e)!t&&!Ct.call(e,u)||o&&("length"==u||r&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||vt(u,a))||l.push(u);return l},At=Object.prototype;var Rt=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||At)};var yt=function(e,t){return function(n){return e(t(n))}}(Object.keys,Object),bt=Rt,wt=yt,It=Object.prototype.hasOwnProperty;var Ot=St,Nt=function(e){if(!bt(e))return wt(e);var t=[];for(var n in Object(e))It.call(e,n)&&"constructor"!=n&&t.push(n);return t},Dt=Pe;var Pt=de,xt=function(e){return Dt(e)?Ot(e):Nt(e)},Lt=je((function(e,t,n,s){Pt(t,xt(t),e,s)}));var Ut=function(e){return void 0===e};function kt(e){return Array.isArray(e)?e.map((e=>kt(e))):null!==e&&"object"==typeof e?Object.keys(e).reduce(((t,n)=>{const s=n.replace(/_([a-z])/g,((e,t)=>t.toUpperCase())),r=e[n];return t[s]=kt(r),t}),{}):e}function Mt(e){return Array.isArray(e)?e.map((e=>Mt(e))):null!==e&&"object"==typeof e?Object.keys(e).reduce(((t,n)=>{const s=n.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`)),r=e[n];return t[s]=Mt(r),t}),{}):e}function $t(e,t){return Lt(e,t,((e,t)=>Ut(t)?e:t))}function Ft(e,t="-",n=":"){const s=e||new Date,r=s.getFullYear(),i=s.getMonth()+1,o=s.getDate(),l=s.getHours(),a=s.getMinutes(),u=s.getSeconds(),c=s.getMilliseconds();return`${r}${t}${qt(i)}${t}${qt(o)} ${qt(l)}${n}${qt(a)}${n}${qt(u)}${n}${qt(c,3)}`}function qt(e,t=2){return e.toString().padStart(t,"0")}function Ht(e,t,n){return r(this,void 0,void 0,(function*(){const s={audio:!0,video:!1};let r=!0,i=!0;try{const o=yield navigator.mediaDevices.enumerateDevices(),l=o.filter((e=>"videoinput"===e.kind));r=!(l.length>0),e&&l.length>0&&(n&&l.some((e=>e.deviceId===n))?s.video={deviceId:{exact:n}}:s.video=!0);const a=o.filter((e=>"audioinput"===e.kind));return i=!(a.length>0),a.length>0&&(t&&a.some((e=>e.deviceId===t))?s.audio={deviceId:{exact:t}}:s.audio=!0),{mediaConstraints:s,isNoneCamera:r,isNoneAudio:i}}catch(e){return null}}))}function jt(e){return r(this,void 0,void 0,(function*(){const{browserName:t}=function(){var e,t;const n=navigator.userAgent;return{browserName:null===(e=n.toLowerCase().match(/(chrome|firefox|msie|trident|edge|safari|opera)/))||void 0===e?void 0:e[1],browserVersion:null===(t=n.match(/(version|opr|chrome|firefox|safari|msie|trident|edge)\/([\d.]+)/i))||void 0===t?void 0:t[2]}}();if("chrome"!==t&&"edge"!==t&&"opear"!==t)return!0;try{const t={audio:!0};"video"===e&&(t.video=!0);return(yield navigator.mediaDevices.getUserMedia(t)).getTracks().forEach((e=>{e.stop()})),!0}catch(e){return!1}}))}function Bt(e){let t="unused",n="unused";if(!e.subscribe_plan_list)return{fqdnStatus:t,videoStatus:n};return e.subscribe_plan_list.forEach((e=>{if(!(null==e?void 0:e.service_list))return;e.service_list.forEach((e=>{(null==e?void 0:e.status)&&("fqdn"===(null==e?void 0:e.service_name)?t=e.status:"video"===(null==e?void 0:e.service_name)&&(n=e.status))}))})),{fqdnStatus:t,videoStatus:n}}class Wt{static set(e,t,n=!0){return!(!n&&this._data.hasOwnProperty(e))&&(this._data[e]=t,!0)}static get(e){return void 0===e?this._data:this._data[e]}static remove(e){delete this._data[e]}}Wt._data={};var Gt=new class{constructor(e=!0){this._enabled=!0,this._enabled=e}getCurrentTime(){const e=new Date,t=e.getFullYear(),n=e.getMonth()+1,s=e.getDate(),r=e.getHours(),i=e.getMinutes(),o=e.getSeconds(),l=e.getMilliseconds();return`${t}-${this.padZero(n)}-${this.padZero(s)} ${this.padZero(r)}:${this.padZero(i)}:${this.padZero(o)}:${this.padZero(l,3)}`}padZero(e,t=2){return e.toString().padStart(t,"0")}log(e,...t){if(this._enabled)switch(console.log(`[${e}] ${this.getCurrentTime()} `,...t),e){case"error":case"warn":case"record":u.addLog({level:"record"===e?"info":e,msg:`${this.username||""} ${t.toString()}`,source:"WebRTC SDK"})}}error(...e){this.log("error",...e)}warn(...e){this.log("warn",...e)}info(...e){this.log("info",...e)}enable(){this._enabled=!0}disable(){this._enabled=!1}};function Vt(e,t){return function(){return e.apply(t,arguments)}}const{toString:Kt}=Object.prototype,{getPrototypeOf:zt}=Object,Jt=(Xt=Object.create(null),e=>{const t=Kt.call(e);return Xt[t]||(Xt[t]=t.slice(8,-1).toLowerCase())});var Xt;const Yt=e=>(e=e.toLowerCase(),t=>Jt(t)===e),Qt=e=>t=>typeof t===e,{isArray:Zt}=Array,en=Qt("undefined");const tn=Yt("ArrayBuffer");const nn=Qt("string"),sn=Qt("function"),rn=Qt("number"),on=e=>null!==e&&"object"==typeof e,ln=e=>{if("object"!==Jt(e))return!1;const t=zt(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},an=Yt("Date"),un=Yt("File"),cn=Yt("Blob"),hn=Yt("FileList"),dn=Yt("URLSearchParams");function fn(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let s,r;if("object"!=typeof e&&(e=[e]),Zt(e))for(s=0,r=e.length;s<r;s++)t.call(null,e[s],s,e);else{const r=n?Object.getOwnPropertyNames(e):Object.keys(e),i=r.length;let o;for(s=0;s<i;s++)o=r[s],t.call(null,e[o],o,e)}}function _n(e,t){t=t.toLowerCase();const n=Object.keys(e);let s,r=n.length;for(;r-- >0;)if(s=n[r],t===s.toLowerCase())return s;return null}const pn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,mn=e=>!en(e)&&e!==pn;const gn=(Tn="undefined"!=typeof Uint8Array&&zt(Uint8Array),e=>Tn&&e instanceof Tn);var Tn;const vn=Yt("HTMLFormElement"),En=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),Cn=Yt("RegExp"),Sn=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),s={};fn(n,((n,r)=>{!1!==t(n,r,e)&&(s[r]=n)})),Object.defineProperties(e,s)},An="abcdefghijklmnopqrstuvwxyz",Rn="0123456789",yn={DIGIT:Rn,ALPHA:An,ALPHA_DIGIT:An+An.toUpperCase()+Rn};var bn={isArray:Zt,isArrayBuffer:tn,isBuffer:function(e){return null!==e&&!en(e)&&null!==e.constructor&&!en(e.constructor)&&sn(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{const t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||Kt.call(e)===t||sn(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&tn(e.buffer),t},isString:nn,isNumber:rn,isBoolean:e=>!0===e||!1===e,isObject:on,isPlainObject:ln,isUndefined:en,isDate:an,isFile:un,isBlob:cn,isRegExp:Cn,isFunction:sn,isStream:e=>on(e)&&sn(e.pipe),isURLSearchParams:dn,isTypedArray:gn,isFileList:hn,forEach:fn,merge:function e(){const{caseless:t}=mn(this)&&this||{},n={},s=(s,r)=>{const i=t&&_n(n,r)||r;ln(n[i])&&ln(s)?n[i]=e(n[i],s):ln(s)?n[i]=e({},s):Zt(s)?n[i]=s.slice():n[i]=s};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&fn(arguments[e],s);return n},extend:(e,t,n,{allOwnKeys:s}={})=>(fn(t,((t,s)=>{n&&sn(t)?e[s]=Vt(t,n):e[s]=t}),{allOwnKeys:s}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,s)=>{e.prototype=Object.create(t.prototype,s),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,s)=>{let r,i,o;const l={};if(t=t||{},null==e)return t;do{for(r=Object.getOwnPropertyNames(e),i=r.length;i-- >0;)o=r[i],s&&!s(o,e,t)||l[o]||(t[o]=e[o],l[o]=!0);e=!1!==n&&zt(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Jt,kindOfTest:Yt,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const s=e.indexOf(t,n);return-1!==s&&s===n},toArray:e=>{if(!e)return null;if(Zt(e))return e;let t=e.length;if(!rn(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let s;for(;(s=n.next())&&!s.done;){const n=s.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const s=[];for(;null!==(n=e.exec(t));)s.push(n);return s},isHTMLForm:vn,hasOwnProperty:En,hasOwnProp:En,reduceDescriptors:Sn,freezeMethods:e=>{Sn(e,((t,n)=>{if(sn(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const s=e[n];sn(s)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},s=e=>{e.forEach((e=>{n[e]=!0}))};return Zt(e)?s(e):s(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:_n,global:pn,isContextDefined:mn,ALPHABET:yn,generateString:(e=16,t=yn.ALPHA_DIGIT)=>{let n="";const{length:s}=t;for(;e--;)n+=t[Math.random()*s|0];return n},isSpecCompliantForm:function(e){return!!(e&&sn(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,s)=>{if(on(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[s]=e;const r=Zt(e)?[]:{};return fn(e,((e,t)=>{const i=n(e,s+1);!en(i)&&(r[t]=i)})),t[s]=void 0,r}}return e};return n(e,0)}};function wn(e,t,n,s,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),s&&(this.request=s),r&&(this.response=r)}bn.inherits(wn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:bn.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const In=wn.prototype,On={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{On[e]={value:e}})),Object.defineProperties(wn,On),Object.defineProperty(In,"isAxiosError",{value:!0}),wn.from=(e,t,n,s,r,i)=>{const o=Object.create(In);return bn.toFlatObject(e,o,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),wn.call(o,e.message,t,n,s,r),o.cause=e,o.name=e.name,i&&Object.assign(o,i),o};function Nn(e){return bn.isPlainObject(e)||bn.isArray(e)}function Dn(e){return bn.endsWith(e,"[]")?e.slice(0,-2):e}function Pn(e,t,n){return e?e.concat(t).map((function(e,t){return e=Dn(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const xn=bn.toFlatObject(bn,{},null,(function(e){return/^is[A-Z]/.test(e)}));function Ln(e,t,n){if(!bn.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const s=(n=bn.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!bn.isUndefined(t[e])}))).metaTokens,r=n.visitor||u,i=n.dots,o=n.indexes,l=(n.Blob||"undefined"!=typeof Blob&&Blob)&&bn.isSpecCompliantForm(t);if(!bn.isFunction(r))throw new TypeError("visitor must be a function");function a(e){if(null===e)return"";if(bn.isDate(e))return e.toISOString();if(!l&&bn.isBlob(e))throw new wn("Blob is not supported. Use a Buffer instead.");return bn.isArrayBuffer(e)||bn.isTypedArray(e)?l&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function u(e,n,r){let l=e;if(e&&!r&&"object"==typeof e)if(bn.endsWith(n,"{}"))n=s?n:n.slice(0,-2),e=JSON.stringify(e);else if(bn.isArray(e)&&function(e){return bn.isArray(e)&&!e.some(Nn)}(e)||(bn.isFileList(e)||bn.endsWith(n,"[]"))&&(l=bn.toArray(e)))return n=Dn(n),l.forEach((function(e,s){!bn.isUndefined(e)&&null!==e&&t.append(!0===o?Pn([n],s,i):null===o?n:n+"[]",a(e))})),!1;return!!Nn(e)||(t.append(Pn(r,n,i),a(e)),!1)}const c=[],h=Object.assign(xn,{defaultVisitor:u,convertValue:a,isVisitable:Nn});if(!bn.isObject(e))throw new TypeError("data must be an object");return function e(n,s){if(!bn.isUndefined(n)){if(-1!==c.indexOf(n))throw Error("Circular reference detected in "+s.join("."));c.push(n),bn.forEach(n,(function(n,i){!0===(!(bn.isUndefined(n)||null===n)&&r.call(t,n,bn.isString(i)?i.trim():i,s,h))&&e(n,s?s.concat(i):[i])})),c.pop()}}(e),t}function Un(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function kn(e,t){this._pairs=[],e&&Ln(e,this,t)}const Mn=kn.prototype;function $n(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Fn(e,t,n){if(!t)return e;const s=n&&n.encode||$n,r=n&&n.serialize;let i;if(i=r?r(t,n):bn.isURLSearchParams(t)?t.toString():new kn(t,n).toString(s),i){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}Mn.append=function(e,t){this._pairs.push([e,t])},Mn.toString=function(e){const t=e?function(t){return e.call(this,t,Un)}:Un;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};class qn{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){bn.forEach(this.handlers,(function(t){null!==t&&e(t)}))}}var Hn={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};var jn={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:kn,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},isStandardBrowserEnv:(()=>{let e;return("undefined"==typeof navigator||"ReactNative"!==(e=navigator.product)&&"NativeScript"!==e&&"NS"!==e)&&("undefined"!=typeof window&&"undefined"!=typeof document)})(),isStandardBrowserWebWorkerEnv:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,protocols:["http","https","file","blob","url","data"]};function Bn(e){function t(e,n,s,r){let i=e[r++];const o=Number.isFinite(+i),l=r>=e.length;if(i=!i&&bn.isArray(s)?s.length:i,l)return bn.hasOwnProp(s,i)?s[i]=[s[i],n]:s[i]=n,!o;s[i]&&bn.isObject(s[i])||(s[i]=[]);return t(e,n,s[i],r)&&bn.isArray(s[i])&&(s[i]=function(e){const t={},n=Object.keys(e);let s;const r=n.length;let i;for(s=0;s<r;s++)i=n[s],t[i]=e[i];return t}(s[i])),!o}if(bn.isFormData(e)&&bn.isFunction(e.entries)){const n={};return bn.forEachEntry(e,((e,s)=>{t(function(e){return bn.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),s,n,0)})),n}return null}const Wn={"Content-Type":void 0};const Gn={transitional:Hn,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",s=n.indexOf("application/json")>-1,r=bn.isObject(e);r&&bn.isHTMLForm(e)&&(e=new FormData(e));if(bn.isFormData(e))return s&&s?JSON.stringify(Bn(e)):e;if(bn.isArrayBuffer(e)||bn.isBuffer(e)||bn.isStream(e)||bn.isFile(e)||bn.isBlob(e))return e;if(bn.isArrayBufferView(e))return e.buffer;if(bn.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Ln(e,new jn.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,s){return s.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((i=bn.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Ln(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return r||s?(t.setContentType("application/json",!1),function(e,t,n){if(bn.isString(e))try{return(t||JSON.parse)(e),bn.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Gn.transitional,n=t&&t.forcedJSONParsing,s="json"===this.responseType;if(e&&bn.isString(e)&&(n&&!this.responseType||s)){const n=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw wn.from(e,wn.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:jn.classes.FormData,Blob:jn.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};bn.forEach(["delete","get","head"],(function(e){Gn.headers[e]={}})),bn.forEach(["post","put","patch"],(function(e){Gn.headers[e]=bn.merge(Wn)}));const Vn=bn.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);const Kn=Symbol("internals");function zn(e){return e&&String(e).trim().toLowerCase()}function Jn(e){return!1===e||null==e?e:bn.isArray(e)?e.map(Jn):String(e)}function Xn(e,t,n,s,r){return bn.isFunction(s)?s.call(this,t,n):(r&&(t=n),bn.isString(t)?bn.isString(s)?-1!==t.indexOf(s):bn.isRegExp(s)?s.test(t):void 0:void 0)}class Yn{constructor(e){e&&this.set(e)}set(e,t,n){const s=this;function r(e,t,n){const r=zn(t);if(!r)throw new Error("header name must be a non-empty string");const i=bn.findKey(s,r);(!i||void 0===s[i]||!0===n||void 0===n&&!1!==s[i])&&(s[i||t]=Jn(e))}const i=(e,t)=>bn.forEach(e,((e,n)=>r(e,n,t)));return bn.isPlainObject(e)||e instanceof this.constructor?i(e,t):bn.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z]+$/.test(e.trim())?i((e=>{const t={};let n,s,r;return e&&e.split("\n").forEach((function(e){r=e.indexOf(":"),n=e.substring(0,r).trim().toLowerCase(),s=e.substring(r+1).trim(),!n||t[n]&&Vn[n]||("set-cookie"===n?t[n]?t[n].push(s):t[n]=[s]:t[n]=t[n]?t[n]+", "+s:s)})),t})(e),t):null!=e&&r(t,e,n),this}get(e,t){if(e=zn(e)){const n=bn.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=n.exec(e);)t[s[1]]=s[2];return t}(e);if(bn.isFunction(t))return t.call(this,e,n);if(bn.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=zn(e)){const n=bn.findKey(this,e);return!(!n||void 0===this[n]||t&&!Xn(0,this[n],n,t))}return!1}delete(e,t){const n=this;let s=!1;function r(e){if(e=zn(e)){const r=bn.findKey(n,e);!r||t&&!Xn(0,n[r],r,t)||(delete n[r],s=!0)}}return bn.isArray(e)?e.forEach(r):r(e),s}clear(e){const t=Object.keys(this);let n=t.length,s=!1;for(;n--;){const r=t[n];e&&!Xn(0,this[r],r,e,!0)||(delete this[r],s=!0)}return s}normalize(e){const t=this,n={};return bn.forEach(this,((s,r)=>{const i=bn.findKey(n,r);if(i)return t[i]=Jn(s),void delete t[r];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(r):String(r).trim();o!==r&&delete t[r],t[o]=Jn(s),n[o]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return bn.forEach(this,((n,s)=>{null!=n&&!1!==n&&(t[s]=e&&bn.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach((e=>n.set(e))),n}static accessor(e){const t=(this[Kn]=this[Kn]={accessors:{}}).accessors,n=this.prototype;function s(e){const s=zn(e);t[s]||(!function(e,t){const n=bn.toCamelCase(" "+t);["get","set","has"].forEach((s=>{Object.defineProperty(e,s+n,{value:function(e,n,r){return this[s].call(this,t,e,n,r)},configurable:!0})}))}(n,e),t[s]=!0)}return bn.isArray(e)?e.forEach(s):s(e),this}}function Qn(e,t){const n=this||Gn,s=t||n,r=Yn.from(s.headers);let i=s.data;return bn.forEach(e,(function(e){i=e.call(n,i,r.normalize(),t?t.status:void 0)})),r.normalize(),i}function Zn(e){return!(!e||!e.__CANCEL__)}function es(e,t,n){wn.call(this,null==e?"canceled":e,wn.ERR_CANCELED,t,n),this.name="CanceledError"}Yn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),bn.freezeMethods(Yn.prototype),bn.freezeMethods(Yn),bn.inherits(es,wn,{__CANCEL__:!0});var ts=jn.isStandardBrowserEnv?{write:function(e,t,n,s,r,i){const o=[];o.push(e+"="+encodeURIComponent(t)),bn.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),bn.isString(s)&&o.push("path="+s),bn.isString(r)&&o.push("domain="+r),!0===i&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function ns(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}var ss=jn.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function s(n){let s=n;return e&&(t.setAttribute("href",s),s=t.href),t.setAttribute("href",s),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=s(window.location.href),function(e){const t=bn.isString(e)?s(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0};function rs(e,t){let n=0;const s=function(e,t){e=e||10;const n=new Array(e),s=new Array(e);let r,i=0,o=0;return t=void 0!==t?t:1e3,function(l){const a=Date.now(),u=s[o];r||(r=a),n[i]=l,s[i]=a;let c=o,h=0;for(;c!==i;)h+=n[c++],c%=e;if(i=(i+1)%e,i===o&&(o=(o+1)%e),a-r<t)return;const d=u&&a-u;return d?Math.round(1e3*h/d):void 0}}(50,250);return r=>{const i=r.loaded,o=r.lengthComputable?r.total:void 0,l=i-n,a=s(l);n=i;const u={loaded:i,total:o,progress:o?i/o:void 0,bytes:l,rate:a||void 0,estimated:a&&o&&i<=o?(o-i)/a:void 0,event:r};u[t?"download":"upload"]=!0,e(u)}}var is="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){let s=e.data;const r=Yn.from(e.headers).normalize(),i=e.responseType;let o;function l(){e.cancelToken&&e.cancelToken.unsubscribe(o),e.signal&&e.signal.removeEventListener("abort",o)}bn.isFormData(s)&&(jn.isStandardBrowserEnv||jn.isStandardBrowserWebWorkerEnv)&&r.setContentType(!1);let a=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";r.set("Authorization","Basic "+btoa(t+":"+n))}const u=ns(e.baseURL,e.url);function c(){if(!a)return;const s=Yn.from("getAllResponseHeaders"in a&&a.getAllResponseHeaders());!function(e,t,n){const s=n.config.validateStatus;n.status&&s&&!s(n.status)?t(new wn("Request failed with status code "+n.status,[wn.ERR_BAD_REQUEST,wn.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}((function(e){t(e),l()}),(function(e){n(e),l()}),{data:i&&"text"!==i&&"json"!==i?a.response:a.responseText,status:a.status,statusText:a.statusText,headers:s,config:e,request:a}),a=null}if(a.open(e.method.toUpperCase(),Fn(u,e.params,e.paramsSerializer),!0),a.timeout=e.timeout,"onloadend"in a?a.onloadend=c:a.onreadystatechange=function(){a&&4===a.readyState&&(0!==a.status||a.responseURL&&0===a.responseURL.indexOf("file:"))&&setTimeout(c)},a.onabort=function(){a&&(n(new wn("Request aborted",wn.ECONNABORTED,e,a)),a=null)},a.onerror=function(){n(new wn("Network Error",wn.ERR_NETWORK,e,a)),a=null},a.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const s=e.transitional||Hn;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new wn(t,s.clarifyTimeoutError?wn.ETIMEDOUT:wn.ECONNABORTED,e,a)),a=null},jn.isStandardBrowserEnv){const t=(e.withCredentials||ss(u))&&e.xsrfCookieName&&ts.read(e.xsrfCookieName);t&&r.set(e.xsrfHeaderName,t)}void 0===s&&r.setContentType(null),"setRequestHeader"in a&&bn.forEach(r.toJSON(),(function(e,t){a.setRequestHeader(t,e)})),bn.isUndefined(e.withCredentials)||(a.withCredentials=!!e.withCredentials),i&&"json"!==i&&(a.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&a.addEventListener("progress",rs(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&a.upload&&a.upload.addEventListener("progress",rs(e.onUploadProgress)),(e.cancelToken||e.signal)&&(o=t=>{a&&(n(!t||t.type?new es(null,e,a):t),a.abort(),a=null)},e.cancelToken&&e.cancelToken.subscribe(o),e.signal&&(e.signal.aborted?o():e.signal.addEventListener("abort",o)));const h=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(u);h&&-1===jn.protocols.indexOf(h)?n(new wn("Unsupported protocol "+h+":",wn.ERR_BAD_REQUEST,e)):a.send(s||null)}))};const os={http:null,xhr:is};bn.forEach(os,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));var ls={getAdapter:e=>{e=bn.isArray(e)?e:[e];const{length:t}=e;let n,s;for(let r=0;r<t&&(n=e[r],!(s=bn.isString(n)?os[n.toLowerCase()]:n));r++);if(!s){if(!1===s)throw new wn(`Adapter ${n} is not supported by the environment`,"ERR_NOT_SUPPORT");throw new Error(bn.hasOwnProp(os,n)?`Adapter '${n}' is not available in the build`:`Unknown adapter '${n}'`)}if(!bn.isFunction(s))throw new TypeError("adapter is not a function");return s},adapters:os};function as(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new es(null,e)}function us(e){as(e),e.headers=Yn.from(e.headers),e.data=Qn.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return ls.getAdapter(e.adapter||Gn.adapter)(e).then((function(t){return as(e),t.data=Qn.call(e,e.transformResponse,t),t.headers=Yn.from(t.headers),t}),(function(t){return Zn(t)||(as(e),t&&t.response&&(t.response.data=Qn.call(e,e.transformResponse,t.response),t.response.headers=Yn.from(t.response.headers))),Promise.reject(t)}))}const cs=e=>e instanceof Yn?e.toJSON():e;function hs(e,t){t=t||{};const n={};function s(e,t,n){return bn.isPlainObject(e)&&bn.isPlainObject(t)?bn.merge.call({caseless:n},e,t):bn.isPlainObject(t)?bn.merge({},t):bn.isArray(t)?t.slice():t}function r(e,t,n){return bn.isUndefined(t)?bn.isUndefined(e)?void 0:s(void 0,e,n):s(e,t,n)}function i(e,t){if(!bn.isUndefined(t))return s(void 0,t)}function o(e,t){return bn.isUndefined(t)?bn.isUndefined(e)?void 0:s(void 0,e):s(void 0,t)}function l(n,r,i){return i in t?s(n,r):i in e?s(void 0,n):void 0}const a={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l,headers:(e,t)=>r(cs(e),cs(t),!0)};return bn.forEach(Object.keys(e).concat(Object.keys(t)),(function(s){const i=a[s]||r,o=i(e[s],t[s],s);bn.isUndefined(o)&&i!==l||(n[s]=o)})),n}const ds="1.3.4",fs={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{fs[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const _s={};fs.transitional=function(e,t,n){function s(e,t){return"[Axios v"+ds+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,r,i)=>{if(!1===e)throw new wn(s(r," has been removed"+(t?" in "+t:"")),wn.ERR_DEPRECATED);return t&&!_s[r]&&(_s[r]=!0,console.warn(s(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,i)}};var ps={assertOptions:function(e,t,n){if("object"!=typeof e)throw new wn("options must be an object",wn.ERR_BAD_OPTION_VALUE);const s=Object.keys(e);let r=s.length;for(;r-- >0;){const i=s[r],o=t[i];if(o){const t=e[i],n=void 0===t||o(t,i,e);if(!0!==n)throw new wn("option "+i+" must be "+n,wn.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new wn("Unknown option "+i,wn.ERR_BAD_OPTION)}},validators:fs};const gs=ps.validators;class Ts{constructor(e){this.defaults=e,this.interceptors={request:new qn,response:new qn}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=hs(this.defaults,t);const{transitional:n,paramsSerializer:s,headers:r}=t;let i;void 0!==n&&ps.assertOptions(n,{silentJSONParsing:gs.transitional(gs.boolean),forcedJSONParsing:gs.transitional(gs.boolean),clarifyTimeoutError:gs.transitional(gs.boolean)},!1),void 0!==s&&ps.assertOptions(s,{encode:gs.function,serialize:gs.function},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase(),i=r&&bn.merge(r.common,r[t.method]),i&&bn.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete r[e]})),t.headers=Yn.concat(i,r);const o=[];let l=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(l=l&&e.synchronous,o.unshift(e.fulfilled,e.rejected))}));const a=[];let u;this.interceptors.response.forEach((function(e){a.push(e.fulfilled,e.rejected)}));let c,h=0;if(!l){const e=[us.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,a),c=e.length,u=Promise.resolve(t);h<c;)u=u.then(e[h++],e[h++]);return u}c=o.length;let d=t;for(h=0;h<c;){const e=o[h++],t=o[h++];try{d=e(d)}catch(e){t.call(this,e);break}}try{u=us.call(this,d)}catch(e){return Promise.reject(e)}for(h=0,c=a.length;h<c;)u=u.then(a[h++],a[h++]);return u}getUri(e){return Fn(ns((e=hs(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}bn.forEach(["delete","get","head","options"],(function(e){Ts.prototype[e]=function(t,n){return this.request(hs(n||{},{method:e,url:t,data:(n||{}).data}))}})),bn.forEach(["post","put","patch"],(function(e){function t(t){return function(n,s,r){return this.request(hs(r||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:s}))}}Ts.prototype[e]=t(),Ts.prototype[e+"Form"]=t(!0)}));class vs{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const s=new Promise((e=>{n.subscribe(e),t=e})).then(e);return s.cancel=function(){n.unsubscribe(t)},s},e((function(e,s,r){n.reason||(n.reason=new es(e,s,r),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new vs((function(t){e=t})),cancel:e}}}const Es={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Es).forEach((([e,t])=>{Es[t]=e}));const Cs=function e(t){const n=new Ts(t),s=Vt(Ts.prototype.request,n);return bn.extend(s,Ts.prototype,n,{allOwnKeys:!0}),bn.extend(s,n,null,{allOwnKeys:!0}),s.create=function(n){return e(hs(t,n))},s}(Gn);Cs.Axios=Ts,Cs.CanceledError=es,Cs.CancelToken=vs,Cs.isCancel=Zn,Cs.VERSION=ds,Cs.toFormData=Ln,Cs.AxiosError=wn,Cs.Cancel=Cs.CanceledError,Cs.all=function(e){return Promise.all(e)},Cs.spread=function(e){return function(t){return e.apply(null,t)}},Cs.isAxiosError=function(e){return bn.isObject(e)&&!0===e.isAxiosError},Cs.mergeConfig=hs,Cs.AxiosHeaders=Yn,Cs.formToJSON=e=>Bn(bn.isHTMLForm(e)?new FormData(e):e),Cs.HttpStatusCode=Es,Cs.default=Cs;class Ss{constructor(e){this.config=e}}class As extends Ss{constructor(e){super(e),this.token="",this.instance=Cs.create(e),this.instance.interceptors.request.use((e=>{const t=this.token||Wt.get("token");return t&&(e.headers.Authorization=t),e}),(e=>Promise.reject(e))),this.instance.interceptors.response.use((function(e){return e}),(function(e){return Promise.reject(e)}))}}class Rs extends As{constructor(e){super(e)}}var ys=new class{constructor(e,t="XHR"){if(this.get=(e,t)=>r(this,void 0,void 0,(function*(){return this.instance.get(e,{params:t})})),this.post=(e,t)=>r(this,void 0,void 0,(function*(){return this.instance.post(e,t)})),this.resetRequest=e=>{if("Fetch"===e)this._request=new Rs(this._config);else this._request=new As(this._config)},this._config=e,"Fetch"===t)this._request=new Rs(e);else this._request=new As(e)}get instance(){return this._request.instance}set config(e){this._config=e,this._request.instance.defaults.baseURL=e.baseURL,this._request.instance.defaults.timeout=e.timeout}set token(e){this._request.token=e,Wt.set("token",e),this._request.instance.defaults.headers.Authorization=e}}({});const bs=()=>ys.get("/v1.0/pbx/getproduct"),ws=()=>ys.get("/v1.0/extension/getregisterinfo"),Is=e=>ys.get("/v1.0/extension/getphoto",e),Os=e=>ys.get("/v1.0/contacts/matchall",e),Ns=e=>ys.post("/v1.0/systemlog/webclientlog",e),Ds={UNKNOWN_ERROR:{code:-1,msg:"UNKNOWN_ERROR",describe:"未知错误"},INVALID_PBX_URL:{code:-2,msg:"INVALID_PBX_URL",describe:"pbxURL 不合法"},PBX_URL_NOT_HTTPS:{code:-3,msg:"PBX_URL_NOT_HTTPS",describe:"pbxURL 不是https"},GET_PRODUCT_FAILED:{code:-4,msg:"GET_PRODUCT_FAILED",describe:"获取PBX PRODUCT接口失败"}},Ps={SUCCESS:{code:0,msg:"SUCCESS",describe:"成功"}},xs={UNKNOWN_ERROR:{code:-100,msg:"UNKNOWN_ERROR",describe:"未知错误"},REGISTRY_FAILED:{code:-101,msg:"REGISTRY_FAILED",describe:"注册失败"},PBX_NETWORK_ERROR:{code:-102,msg:"PBX_NETWORK_ERROR",describe:"PBX接口请求错误"},PBX_API_ERROR:{code:-103,msg:"PBX_API_ERROR",describe:"PBX接口错误，返回的错误不等于0"},GET_PERSONAL_NOT_FOUND_DATA:{code:-104,msg:"GET_PERSONAL_NOT_FOUND_DATA",describe:"PBX未返回分机信息"},PBX_ALREADY_INITIALIZED:{code:-105,msg:"PBX_ALREADY_INITIALIZED",describe:"PBX对象已初始化过，不许重复初始化"},LINKUS_DISABLED:{code:-106,msg:"LINKUS_DISABLED",describe:"linkus 客户端未开启"},LOGGED_IN_ELSEWHERE:{code:-107,msg:"LOGGED_IN_ELSEWHERE",describe:"在别处登录了"},EXTENSION_DELETED:{code:-108,msg:"EXTENSION_DELETED",describe:"分机被删除了"},RE_LOGIN:{code:-109,msg:"RE_LOGIN",describe:"重新登录"}},Ls={SUCCESS:{code:100,msg:"SUCCESS",describe:"PBX对象通用成功"}},Us={UNKNOWN_ERROR:{code:-200,msg:"UNKNOWN_ERROR",describe:"未知错误"},REGISTRY_FAILED:{code:-201,msg:"REGISTRY_FAILED",describe:"注册失败"},GET_AGREE_CHROME_USER_MEDIA_ROLE_ERROR:{code:-202,msg:"GET_AGREE_CHROME_USER_MEDIA_ROLE_ERROR",describe:"获取媒体流失败（未获得授权）"},GET_LOCAL_STREAM_ERROR:{code:-203,msg:"GET_LOCAL_STREAM_ERROR",describe:"获取媒体流失败"},RE_REGISTRY_MAX_LIMIT_TIMES:{code:-204,msg:"RE_REGISTRY_MAX_LIMIT_TIMES",describe:"已达最大重试次数"},MAX_LIMIT_CALL:{code:-205,msg:"MAX_LIMIT_CALL",describe:"已达最大通话数"},GET_LOCAL_MEDIA_INFO_ERROR:{code:-206,msg:"GET_LOCAL_MEDIA_INFO_ERROR",describe:"获取本地媒体设备错误"},ATTENDED_PARENT_NOT_FOUND:{code:-207,msg:"ATTENDED_PARENT_NOT_FOUND",describe:"咨询转父节点未找到"},CALL_TOO_MANY_TIMES:{code:-208,msg:"CALL_TOO_MANY_TIMES",describe:"1秒钟内呼出太多次"},INVALID_NUMBER:{code:-209,msg:"INVALID_NUMBER",describe:"非法号码"},CURRENT_CALL_HAS_NOT_CONNECTED:{code:-210,msg:"CURRENT_CALL_HAS_NOT_CONNECTED",describe:"当前有未接通的电话"},NOT_FOUND_CALL_ID:{code:-211,msg:"NOT_FOUND_CALL_ID",describe:"未找到通话id"},NOT_FOUND_AUDIO_INPUT_DEVICE:{code:-290,msg:"NOT_FOUND_AUDIO_INPUT_DEVICE",describe:"未找到音频输入设备"},NOT_FOUND_VIDEO_INPUT_DEVICE:{code:-291,msg:"NOT_FOUND_VIDEO_INPUT_DEVICE",describe:"未找到视频输入设备"}},ks={SUCCESS:{code:200,msg:"SUCCESS",describe:"Phone对象通用成功"}};var Ms;!function(e){e[e.RECORD_FEATURE_CODE=20008]="RECORD_FEATURE_CODE",e[e.REGISTRY_INFO_CHANGE=20066]="REGISTRY_INFO_CHANGE",e[e.RECORD_PERMISSIONS_CHANGE=20047]="RECORD_PERMISSIONS_CHANGE",e[e.CALL_STATUS_CHANGE=20048]="CALL_STATUS_CHANGE"}(Ms||(Ms={}));class $s{constructor(e,t){this.code=e[t].code,this.message=e[t].msg}}class Fs{static error(e){return new $s(Ds,e)}static success(e){return new $s(Ps,e)}}class qs{static error(e){return new $s(xs,e)}static success(e){return new $s(Ls,e)}}class Hs{static error(e){return new $s(Us,e)}static success(e){return new $s(ks,e)}}var js,Bs={},Ws={get exports(){return Bs},set exports(e){Bs=e}},Gs="object"==typeof Reflect?Reflect:null,Vs=Gs&&"function"==typeof Gs.apply?Gs.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};js=Gs&&"function"==typeof Gs.ownKeys?Gs.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var Ks=Number.isNaN||function(e){return e!=e};function zs(){zs.init.call(this)}Ws.exports=zs,Bs.once=function(e,t){return new Promise((function(n,s){function r(n){e.removeListener(t,i),s(n)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}rr(e,t,i,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&rr(e,"error",t,n)}(e,r,{once:!0})}))},zs.EventEmitter=zs,zs.prototype._events=void 0,zs.prototype._eventsCount=0,zs.prototype._maxListeners=void 0;var Js=10;function Xs(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function Ys(e){return void 0===e._maxListeners?zs.defaultMaxListeners:e._maxListeners}function Qs(e,t,n,s){var r,i,o,l;if(Xs(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),o=i[t]),void 0===o)o=i[t]=n,++e._eventsCount;else if("function"==typeof o?o=i[t]=s?[n,o]:[o,n]:s?o.unshift(n):o.push(n),(r=Ys(e))>0&&o.length>r&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,l=a,console&&console.warn&&console.warn(l)}return e}function Zs(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function er(e,t,n){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=Zs.bind(s);return r.listener=n,s.wrapFn=r,r}function tr(e,t,n){var s=e._events;if(void 0===s)return[];var r=s[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):sr(r,r.length)}function nr(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function sr(e,t){for(var n=new Array(t),s=0;s<t;++s)n[s]=e[s];return n}function rr(e,t,n,s){if("function"==typeof e.on)s.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(i){s.once&&e.removeEventListener(t,r),n(i)}))}}Object.defineProperty(zs,"defaultMaxListeners",{enumerable:!0,get:function(){return Js},set:function(e){if("number"!=typeof e||e<0||Ks(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Js=e}}),zs.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},zs.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||Ks(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},zs.prototype.getMaxListeners=function(){return Ys(this)},zs.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var s="error"===e,r=this._events;if(void 0!==r)s=s&&void 0===r.error;else if(!s)return!1;if(s){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var o=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw o.context=i,o}var l=r[e];if(void 0===l)return!1;if("function"==typeof l)Vs(l,this,t);else{var a=l.length,u=sr(l,a);for(n=0;n<a;++n)Vs(u[n],this,t)}return!0},zs.prototype.addListener=function(e,t){return Qs(this,e,t,!1)},zs.prototype.on=zs.prototype.addListener,zs.prototype.prependListener=function(e,t){return Qs(this,e,t,!0)},zs.prototype.once=function(e,t){return Xs(t),this.on(e,er(this,e,t)),this},zs.prototype.prependOnceListener=function(e,t){return Xs(t),this.prependListener(e,er(this,e,t)),this},zs.prototype.removeListener=function(e,t){var n,s,r,i,o;if(Xs(t),void 0===(s=this._events))return this;if(void 0===(n=s[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){o=n[i].listener,r=i;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(s[e]=n[0]),void 0!==s.removeListener&&this.emit("removeListener",e,o||t)}return this},zs.prototype.off=zs.prototype.removeListener,zs.prototype.removeAllListeners=function(e){var t,n,s;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,i=Object.keys(n);for(s=0;s<i.length;++s)"removeListener"!==(r=i[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},zs.prototype.listeners=function(e){return tr(this,e,!0)},zs.prototype.rawListeners=function(e){return tr(this,e,!1)},zs.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):nr.call(e,t)},zs.prototype.listenerCount=nr,zs.prototype.eventNames=function(){return this._eventsCount>0?js(this._events):[]};var ir={name:"jssip",title:"JsSIP",description:"the Javascript SIP library,based on 3.6.1",version:"1.3.1",homepage:"https://jssip.net",author:"linwb@yeastar.com",types:"lib/JsSIP.d.ts",main:"lib-es5/JsSIP.js",keywords:["sip","websocket","webrtc","node","browser","library"],license:"MIT",dependencies:{"@types/debug":"^4.1.5","@types/node":"^14.0.6",debug:"^4.1.1",events:"^3.1.0","sdp-transform":"^2.14.0"},devDependencies:{"@babel/core":"^7.9.6","@babel/preset-env":"^7.9.6","ansi-colors":"^3.2.4",browserify:"^16.5.1",eslint:"^5.16.0","fancy-log":"^1.3.3",gulp:"^4.0.2","gulp-babel":"^8.0.0","gulp-eslint":"^5.0.0","gulp-expect-file":"^1.0.2","gulp-header":"^2.0.9","gulp-nodeunit-runner":"^0.2.2","gulp-plumber":"^1.2.1","gulp-rename":"^1.4.0","gulp-uglify-es":"^1.0.4",pegjs:"^0.7.0","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},scripts:{lint:"gulp lint",test:"gulp test",prepublishOnly:"gulp babel"}};var or={USER_AGENT:`${ir.title} ${ir.version}`,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484,424],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",DTMF_TRANSPORT:{INFO:"INFO",RFC2833:"RFC2833"},REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",424:"Bad Location Information",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO,NOTIFY",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:90,MIN_SESSION_EXPIRES:60,CONNECTION_RECOVERY_MAX_INTERVAL:30,CONNECTION_RECOVERY_MIN_INTERVAL:2};class lr extends Error{constructor(e,t){super(),this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=e,this.value=t,this.message=this.value?`Invalid value ${JSON.stringify(this.value)} for parameter "${this.parameter}"`:`Missing parameter: ${this.parameter}`}}class ar extends Error{constructor(e){super(),this.code=2,this.name="INVALID_STATE_ERROR",this.status=e,this.message=`Invalid status: ${e}`}}class ur extends Error{constructor(e){super(),this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=e}}class cr extends Error{constructor(e){super(),this.code=4,this.name="NOT_READY_ERROR",this.message=e}}var hr,dr,fr,_r,pr,mr,gr,Tr={ConfigurationError:lr,InvalidStateError:ar,NotSupportedError:ur,NotReadyError:cr},vr={};function Er(){if(dr)return hr;dr=1;const e=Sr(),t=Cr();return hr=class n{static parse(e){return-1!==(e=t.parse(e,"Name_Addr_Header"))?e:void 0}constructor(t,n,s){if(!(t&&t instanceof e))throw new TypeError('missing or invalid "uri" parameter');this._uri=t,this._parameters={},this.display_name=n;for(const e in s)Object.prototype.hasOwnProperty.call(s,e)&&this.setParam(e,s[e])}get uri(){return this._uri}get display_name(){return this._display_name}set display_name(e){this._display_name=0===e?"0":e}setParam(e,t){e&&(this._parameters[e.toLowerCase()]=null==t?null:t.toString())}getParam(e){if(e)return this._parameters[e.toLowerCase()]}hasParam(e){if(e)return!!this._parameters.hasOwnProperty(e.toLowerCase())}deleteParam(e){if(e=e.toLowerCase(),this._parameters.hasOwnProperty(e)){const t=this._parameters[e];return delete this._parameters[e],t}}clearParams(){this._parameters={}}clone(){return new n(this._uri.clone(),this._display_name,JSON.parse(JSON.stringify(this._parameters)))}_quote(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}toString(){let e=this._display_name?`"${this._quote(this._display_name)}" `:"";e+=`<${this._uri.toString()}>`;for(const t in this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,t)&&(e+=`;${t}`,null!==this._parameters[t]&&(e+=`=${this._parameters[t]}`));return e}},hr}function Cr(){return _r||(_r=1,fr=function(){function e(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var t={parse:function(t,n){var s={CRLF:a,DIGIT:u,ALPHA:c,HEXDIG:h,WSP:d,OCTET:f,DQUOTE:_,SP:p,HTAB:m,alphanum:g,reserved:T,unreserved:v,mark:E,escaped:C,LWS:S,SWS:A,HCOLON:R,TEXT_UTF8_TRIM:y,TEXT_UTF8char:b,UTF8_NONASCII:w,UTF8_CONT:I,LHEX:function(){var e;null===(e=u())&&(/^[a-f]/.test(t.charAt(r))?(e=t.charAt(r),r++):(e=null,l("[a-f]")));return e},token:O,token_nodot:N,separators:function(){var e;40===t.charCodeAt(r)?(e="(",r++):(e=null,l('"("'));null===e&&(41===t.charCodeAt(r)?(e=")",r++):(e=null,l('")"')),null===e&&(60===t.charCodeAt(r)?(e="<",r++):(e=null,l('"<"')),null===e&&(62===t.charCodeAt(r)?(e=">",r++):(e=null,l('">"')),null===e&&(64===t.charCodeAt(r)?(e="@",r++):(e=null,l('"@"')),null===e&&(44===t.charCodeAt(r)?(e=",",r++):(e=null,l('","')),null===e&&(59===t.charCodeAt(r)?(e=";",r++):(e=null,l('";"')),null===e&&(58===t.charCodeAt(r)?(e=":",r++):(e=null,l('":"')),null===e&&(92===t.charCodeAt(r)?(e="\\",r++):(e=null,l('"\\\\"')),null===e&&null===(e=_())&&(47===t.charCodeAt(r)?(e="/",r++):(e=null,l('"/"')),null===e&&(91===t.charCodeAt(r)?(e="[",r++):(e=null,l('"["')),null===e&&(93===t.charCodeAt(r)?(e="]",r++):(e=null,l('"]"')),null===e&&(63===t.charCodeAt(r)?(e="?",r++):(e=null,l('"?"')),null===e&&(61===t.charCodeAt(r)?(e="=",r++):(e=null,l('"="')),null===e&&(123===t.charCodeAt(r)?(e="{",r++):(e=null,l('"{"')),null===e&&(125===t.charCodeAt(r)?(e="}",r++):(e=null,l('"}"')),null===e&&null===(e=p())&&(e=m()))))))))))))))));return e},word:D,STAR:P,SLASH:x,EQUAL:L,LPAREN:U,RPAREN:k,RAQUOT:M,LAQUOT:$,COMMA:F,SEMI:q,COLON:H,LDQUOT:j,RDQUOT:B,comment:function e(){var t,n,s,i;if(i=r,null!==(t=U())){for(n=[],null===(s=W())&&null===(s=z())&&(s=e());null!==s;)n.push(s),null===(s=W())&&null===(s=z())&&(s=e());null!==n&&null!==(s=k())?t=[t,n,s]:(t=null,r=i)}else t=null,r=i;return t},ctext:W,quoted_string:G,quoted_string_clean:V,qdtext:K,quoted_pair:z,SIP_URI_noparams:J,SIP_URI:X,uri_scheme:Y,uri_scheme_sips:Q,uri_scheme_sip:Z,userinfo:ee,user:te,user_unreserved:ne,password:se,hostport:re,host:ie,hostname:oe,domainlabel:le,toplabel:ae,IPv6reference:ue,IPv6address:ce,h16:he,ls32:de,IPv4address:fe,dec_octet:_e,port:pe,uri_parameters:me,uri_parameter:ge,transport_param:Te,user_param:ve,method_param:Ee,ttl_param:Ce,maddr_param:Se,lr_param:Ae,other_param:Re,pname:ye,pvalue:be,paramchar:we,param_unreserved:Ie,headers:Oe,header:Ne,hname:De,hvalue:Pe,hnv_unreserved:xe,Request_Response:function(){var e;null===(e=ut())&&(e=Le());return e},Request_Line:Le,Request_URI:Ue,absoluteURI:ke,hier_part:Me,net_path:$e,abs_path:Fe,opaque_part:qe,uric:He,uric_no_slash:je,path_segments:Be,segment:We,param:Ge,pchar:Ve,scheme:Ke,authority:ze,srvr:Je,reg_name:Xe,query:Ye,SIP_Version:Qe,INVITEm:Ze,ACKm:et,OPTIONSm:tt,BYEm:nt,CANCELm:st,REGISTERm:rt,SUBSCRIBEm:it,NOTIFYm:ot,REFERm:lt,Method:at,Status_Line:ut,Status_Code:ct,extension_code:ht,Reason_Phrase:dt,Allow_Events:function(){var e,t,n,s,i,o;if(i=r,null!==(e=kt())){for(t=[],o=r,null!==(n=F())&&null!==(s=kt())?n=[n,s]:(n=null,r=o);null!==n;)t.push(n),o=r,null!==(n=F())&&null!==(s=kt())?n=[n,s]:(n=null,r=o);null!==t?e=[e,t]:(e=null,r=i)}else e=null,r=i;return e},Call_ID:function(){var e,n,s,i,o,a;i=r,o=r,null!==(e=D())?(a=r,64===t.charCodeAt(r)?(n="@",r++):(n=null,l('"@"')),null!==n&&null!==(s=D())?n=[n,s]:(n=null,r=a),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,r=o)):(e=null,r=o);null!==e&&(e=function(e){Fn=t.substring(r,e)}(i));null===e&&(r=i);return e},Contact:function(){var e,t,n,s,i,o,l;if(i=r,null===(e=P()))if(o=r,null!==(e=ft())){for(t=[],l=r,null!==(n=F())&&null!==(s=ft())?n=[n,s]:(n=null,r=l);null!==n;)t.push(n),l=r,null!==(n=F())&&null!==(s=ft())?n=[n,s]:(n=null,r=l);null!==t?e=[e,t]:(e=null,r=o)}else e=null,r=o;null!==e&&(e=function(e){var t,n;for(n=Fn.multi_header.length,t=0;t<n;t++)if(null===Fn.multi_header[t].parsed){Fn=null;break}Fn=null!==Fn?Fn.multi_header:-1}());null===e&&(r=i);return e},contact_param:ft,name_addr:_t,display_name:pt,contact_params:mt,c_p_q:gt,c_p_expires:Tt,delta_seconds:vt,qvalue:Et,generic_param:Ct,gen_value:St,Content_Disposition:function(){var e,t,n,s,i,o;if(i=r,null!==(e=At())){for(t=[],o=r,null!==(n=q())&&null!==(s=Rt())?n=[n,s]:(n=null,r=o);null!==n;)t.push(n),o=r,null!==(n=q())&&null!==(s=Rt())?n=[n,s]:(n=null,r=o);null!==t?e=[e,t]:(e=null,r=i)}else e=null,r=i;return e},disp_type:At,disp_param:Rt,handling_param:yt,Content_Encoding:function(){var e,t,n,s,i,o;if(i=r,null!==(e=O())){for(t=[],o=r,null!==(n=F())&&null!==(s=O())?n=[n,s]:(n=null,r=o);null!==n;)t.push(n),o=r,null!==(n=F())&&null!==(s=O())?n=[n,s]:(n=null,r=o);null!==t?e=[e,t]:(e=null,r=i)}else e=null,r=i;return e},Content_Length:function(){var e,t,n;if(n=r,null!==(t=u()))for(e=[];null!==t;)e.push(t),t=u();else e=null;null!==e&&(e=void(Fn=parseInt(e.join(""))));null===e&&(r=n);return e},Content_Type:function(){var e,n;n=r,null!==(e=bt())&&(e=function(e){Fn=t.substring(r,e)}(n));null===e&&(r=n);return e},media_type:bt,m_type:wt,discrete_type:It,composite_type:Ot,extension_token:Nt,x_token:Dt,m_subtype:Pt,m_parameter:xt,m_value:Lt,CSeq:function(){var e,t,n,s;s=r,null!==(e=Ut())&&null!==(t=S())&&null!==(n=at())?e=[e,t,n]:(e=null,r=s);return e},CSeq_value:Ut,Expires:function(){var e,t;t=r,null!==(e=vt())&&(e=void(Fn=e));null===e&&(r=t);return e},Event:function(){var e,t,n,s,i,o,l;if(i=r,o=r,null!==(e=kt())){for(t=[],l=r,null!==(n=q())&&null!==(s=Ct())?n=[n,s]:(n=null,r=l);null!==n;)t.push(n),l=r,null!==(n=q())&&null!==(s=Ct())?n=[n,s]:(n=null,r=l);null!==t?e=[e,t]:(e=null,r=o)}else e=null,r=o;null!==e&&(a=e[0],e=void(Fn.event=a.join("").toLowerCase()));var a;null===e&&(r=i);return e},event_type:kt,From:function(){var e,t,n,s,i,o,l;i=r,o=r,null===(e=J())&&(e=_t());if(null!==e){for(t=[],l=r,null!==(n=q())&&null!==(s=Mt())?n=[n,s]:(n=null,r=l);null!==n;)t.push(n),l=r,null!==(n=q())&&null!==(s=Mt())?n=[n,s]:(n=null,r=l);null!==t?e=[e,t]:(e=null,r=o)}else e=null,r=o;null!==e&&(e=function(e){var t=Fn.tag;try{Fn=new $n(Fn.uri,Fn.display_name,Fn.params),t&&Fn.setParam("tag",t)}catch(e){Fn=-1}}());null===e&&(r=i);return e},from_param:Mt,tag_param:$t,Max_Forwards:function(){var e,t,n;if(n=r,null!==(t=u()))for(e=[];null!==t;)e.push(t),t=u();else e=null;null!==e&&(e=void(Fn=parseInt(e.join(""))));null===e&&(r=n);return e},Min_Expires:function(){var e,t;t=r,null!==(e=vt())&&(e=void(Fn=e));null===e&&(r=t);return e},Name_Addr_Header:function(){var e,t,n,s,i,o,l,a,u,c;a=r,u=r,e=[],t=pt();for(;null!==t;)e.push(t),t=pt();if(null!==e)if(null!==(t=$()))if(null!==(n=X()))if(null!==(s=M())){for(i=[],c=r,null!==(o=q())&&null!==(l=Ct())?o=[o,l]:(o=null,r=c);null!==o;)i.push(o),c=r,null!==(o=q())&&null!==(l=Ct())?o=[o,l]:(o=null,r=c);null!==i?e=[e,t,n,s,i]:(e=null,r=u)}else e=null,r=u;else e=null,r=u;else e=null,r=u;else e=null,r=u;null!==e&&(e=function(e){try{Fn=new $n(Fn.uri,Fn.display_name,Fn.params)}catch(e){Fn=-1}}());null===e&&(r=a);return e},Proxy_Authenticate:function(){return Ft()},challenge:Ft,other_challenge:qt,auth_param:Ht,digest_cln:jt,realm:Bt,realm_value:Wt,domain:Gt,URI:Vt,nonce:Kt,nonce_value:zt,opaque:Jt,stale:Xt,algorithm:Yt,qop_options:Qt,qop_value:Zt,Proxy_Require:function(){var e,t,n,s,i,o;if(i=r,null!==(e=O())){for(t=[],o=r,null!==(n=F())&&null!==(s=O())?n=[n,s]:(n=null,r=o);null!==n;)t.push(n),o=r,null!==(n=F())&&null!==(s=O())?n=[n,s]:(n=null,r=o);null!==t?e=[e,t]:(e=null,r=i)}else e=null,r=i;return e},Record_Route:function(){var e,t,n,s,i,o,l;if(i=r,o=r,null!==(e=en())){for(t=[],l=r,null!==(n=F())&&null!==(s=en())?n=[n,s]:(n=null,r=l);null!==n;)t.push(n),l=r,null!==(n=F())&&null!==(s=en())?n=[n,s]:(n=null,r=l);null!==t?e=[e,t]:(e=null,r=o)}else e=null,r=o;null!==e&&(e=function(e){var t,n;for(n=Fn.multi_header.length,t=0;t<n;t++)if(null===Fn.multi_header[t].parsed){Fn=null;break}Fn=null!==Fn?Fn.multi_header:-1}());null===e&&(r=i);return e},rec_route:en,Reason:function(){var e,n,s,i,o,a,u;o=r,a=r,"sip"===t.substr(r,3).toLowerCase()?(e=t.substr(r,3),r+=3):(e=null,l('"SIP"'));null===e&&(e=O());if(null!==e){for(n=[],u=r,null!==(s=q())&&null!==(i=tn())?s=[s,i]:(s=null,r=u);null!==s;)n.push(s),u=r,null!==(s=q())&&null!==(i=tn())?s=[s,i]:(s=null,r=u);null!==n?e=[e,n]:(e=null,r=a)}else e=null,r=a;null!==e&&(e=function(e,t){if(Fn.protocol=t.toLowerCase(),Fn.params||(Fn.params={}),Fn.params.text&&'"'===Fn.params.text[0]){var n=Fn.params.text;Fn.text=n.substring(1,n.length-1),delete Fn.params.text}}(0,e[0]));null===e&&(r=o);return e},reason_param:tn,reason_cause:nn,Require:function(){var e,t,n,s,i,o;if(i=r,null!==(e=O())){for(t=[],o=r,null!==(n=F())&&null!==(s=O())?n=[n,s]:(n=null,r=o);null!==n;)t.push(n),o=r,null!==(n=F())&&null!==(s=O())?n=[n,s]:(n=null,r=o);null!==t?e=[e,t]:(e=null,r=i)}else e=null,r=i;return e},Route:function(){var e,t,n,s,i,o;if(i=r,null!==(e=sn())){for(t=[],o=r,null!==(n=F())&&null!==(s=sn())?n=[n,s]:(n=null,r=o);null!==n;)t.push(n),o=r,null!==(n=F())&&null!==(s=sn())?n=[n,s]:(n=null,r=o);null!==t?e=[e,t]:(e=null,r=i)}else e=null,r=i;return e},route_param:sn,Subscription_State:function(){var e,t,n,s,i,o;if(i=r,null!==(e=rn())){for(t=[],o=r,null!==(n=q())&&null!==(s=on())?n=[n,s]:(n=null,r=o);null!==n;)t.push(n),o=r,null!==(n=q())&&null!==(s=on())?n=[n,s]:(n=null,r=o);null!==t?e=[e,t]:(e=null,r=i)}else e=null,r=i;return e},substate_value:rn,subexp_params:on,event_reason_value:ln,Subject:function(){var e;return e=null!==(e=y())?e:""},Supported:function(){var e,t,n,s,i,o;if(i=r,null!==(e=O())){for(t=[],o=r,null!==(n=F())&&null!==(s=O())?n=[n,s]:(n=null,r=o);null!==n;)t.push(n),o=r,null!==(n=F())&&null!==(s=O())?n=[n,s]:(n=null,r=o);null!==t?e=[e,t]:(e=null,r=i)}else e=null,r=i;return e=null!==e?e:""},To:function(){var e,t,n,s,i,o,l;i=r,o=r,null===(e=J())&&(e=_t());if(null!==e){for(t=[],l=r,null!==(n=q())&&null!==(s=an())?n=[n,s]:(n=null,r=l);null!==n;)t.push(n),l=r,null!==(n=q())&&null!==(s=an())?n=[n,s]:(n=null,r=l);null!==t?e=[e,t]:(e=null,r=o)}else e=null,r=o;null!==e&&(e=function(e){var t=Fn.tag;try{Fn=new $n(Fn.uri,Fn.display_name,Fn.params),t&&Fn.setParam("tag",t)}catch(e){Fn=-1}}());null===e&&(r=i);return e},to_param:an,Via:function(){var e,t,n,s,i,o;if(i=r,null!==(e=un())){for(t=[],o=r,null!==(n=F())&&null!==(s=un())?n=[n,s]:(n=null,r=o);null!==n;)t.push(n),o=r,null!==(n=F())&&null!==(s=un())?n=[n,s]:(n=null,r=o);null!==t?e=[e,t]:(e=null,r=i)}else e=null,r=i;return e},via_param:un,via_params:cn,via_ttl:hn,via_maddr:dn,via_received:fn,via_branch:_n,response_port:pn,rport:mn,sent_protocol:gn,protocol_name:Tn,transport:vn,sent_by:En,via_host:Cn,via_port:Sn,ttl:An,WWW_Authenticate:function(){return Ft()},Session_Expires:function(){var e,t,n,s,i,o;if(i=r,null!==(e=Rn())){for(t=[],o=r,null!==(n=q())&&null!==(s=yn())?n=[n,s]:(n=null,r=o);null!==n;)t.push(n),o=r,null!==(n=q())&&null!==(s=yn())?n=[n,s]:(n=null,r=o);null!==t?e=[e,t]:(e=null,r=i)}else e=null,r=i;return e},s_e_expires:Rn,s_e_params:yn,s_e_refresher:bn,extension_header:function(){var e,t,n,s;s=r,null!==(e=O())&&null!==(t=R())&&null!==(n=wn())?e=[e,t,n]:(e=null,r=s);return e},header_value:wn,message_body:function(){var e,t;e=[],t=f();for(;null!==t;)e.push(t),t=f();return e},uuid_URI:function(){var e,n,s;s=r,"uuid:"===t.substr(r,5)?(e="uuid:",r+=5):(e=null,l('"uuid:"'));null!==e&&null!==(n=In())?e=[e,n]:(e=null,r=s);return e},uuid:In,hex4:On,hex8:Nn,hex12:Dn,Refer_To:function(){var e,t,n,s,i,o,l;i=r,o=r,null===(e=J())&&(e=_t());if(null!==e){for(t=[],l=r,null!==(n=q())&&null!==(s=Ct())?n=[n,s]:(n=null,r=l);null!==n;)t.push(n),l=r,null!==(n=q())&&null!==(s=Ct())?n=[n,s]:(n=null,r=l);null!==t?e=[e,t]:(e=null,r=o)}else e=null,r=o;null!==e&&(e=function(e){try{Fn=new $n(Fn.uri,Fn.display_name,Fn.params)}catch(e){Fn=-1}}());null===e&&(r=i);return e},Replaces:function(){var e,t,n,s,i,o;if(i=r,null!==(e=Pn())){for(t=[],o=r,null!==(n=q())&&null!==(s=xn())?n=[n,s]:(n=null,r=o);null!==n;)t.push(n),o=r,null!==(n=q())&&null!==(s=xn())?n=[n,s]:(n=null,r=o);null!==t?e=[e,t]:(e=null,r=i)}else e=null,r=i;return e},call_id:Pn,replaces_param:xn,to_tag:Ln,from_tag:Un,early_flag:kn};if(void 0!==n){if(void 0===s[n])throw new Error("Invalid rule name: "+e(n)+".")}else n="CRLF";var r=0,i=0,o=[];function l(e){r<i||(r>i&&(i=r,o=[]),o.push(e))}function a(){var e;return"\r\n"===t.substr(r,2)?(e="\r\n",r+=2):(e=null,l('"\\r\\n"')),e}function u(){var e;return/^[0-9]/.test(t.charAt(r))?(e=t.charAt(r),r++):(e=null,l("[0-9]")),e}function c(){var e;return/^[a-zA-Z]/.test(t.charAt(r))?(e=t.charAt(r),r++):(e=null,l("[a-zA-Z]")),e}function h(){var e;return/^[0-9a-fA-F]/.test(t.charAt(r))?(e=t.charAt(r),r++):(e=null,l("[0-9a-fA-F]")),e}function d(){var e;return null===(e=p())&&(e=m()),e}function f(){var e;return/^[\0-\xFF]/.test(t.charAt(r))?(e=t.charAt(r),r++):(e=null,l("[\\0-\\xFF]")),e}function _(){var e;return/^["]/.test(t.charAt(r))?(e=t.charAt(r),r++):(e=null,l('["]')),e}function p(){var e;return 32===t.charCodeAt(r)?(e=" ",r++):(e=null,l('" "')),e}function m(){var e;return 9===t.charCodeAt(r)?(e="\t",r++):(e=null,l('"\\t"')),e}function g(){var e;return/^[a-zA-Z0-9]/.test(t.charAt(r))?(e=t.charAt(r),r++):(e=null,l("[a-zA-Z0-9]")),e}function T(){var e;return 59===t.charCodeAt(r)?(e=";",r++):(e=null,l('";"')),null===e&&(47===t.charCodeAt(r)?(e="/",r++):(e=null,l('"/"')),null===e&&(63===t.charCodeAt(r)?(e="?",r++):(e=null,l('"?"')),null===e&&(58===t.charCodeAt(r)?(e=":",r++):(e=null,l('":"')),null===e&&(64===t.charCodeAt(r)?(e="@",r++):(e=null,l('"@"')),null===e&&(38===t.charCodeAt(r)?(e="&",r++):(e=null,l('"&"')),null===e&&(61===t.charCodeAt(r)?(e="=",r++):(e=null,l('"="')),null===e&&(43===t.charCodeAt(r)?(e="+",r++):(e=null,l('"+"')),null===e&&(36===t.charCodeAt(r)?(e="$",r++):(e=null,l('"$"')),null===e&&(44===t.charCodeAt(r)?(e=",",r++):(e=null,l('","'))))))))))),e}function v(){var e;return null===(e=g())&&(e=E()),e}function E(){var e;return 45===t.charCodeAt(r)?(e="-",r++):(e=null,l('"-"')),null===e&&(95===t.charCodeAt(r)?(e="_",r++):(e=null,l('"_"')),null===e&&(46===t.charCodeAt(r)?(e=".",r++):(e=null,l('"."')),null===e&&(33===t.charCodeAt(r)?(e="!",r++):(e=null,l('"!"')),null===e&&(126===t.charCodeAt(r)?(e="~",r++):(e=null,l('"~"')),null===e&&(42===t.charCodeAt(r)?(e="*",r++):(e=null,l('"*"')),null===e&&(39===t.charCodeAt(r)?(e="'",r++):(e=null,l('"\'"')),null===e&&(40===t.charCodeAt(r)?(e="(",r++):(e=null,l('"("')),null===e&&(41===t.charCodeAt(r)?(e=")",r++):(e=null,l('")"')))))))))),e}function C(){var e,n,s,i,o;return i=r,o=r,37===t.charCodeAt(r)?(e="%",r++):(e=null,l('"%"')),null!==e&&null!==(n=h())&&null!==(s=h())?e=[e,n,s]:(e=null,r=o),null!==e&&(e=e.join("")),null===e&&(r=i),e}function S(){var e,t,n,s,i,o;for(s=r,i=r,o=r,e=[],t=d();null!==t;)e.push(t),t=d();if(null!==e&&null!==(t=a())?e=[e,t]:(e=null,r=o),null!==(e=null!==e?e:"")){if(null!==(n=d()))for(t=[];null!==n;)t.push(n),n=d();else t=null;null!==t?e=[e,t]:(e=null,r=i)}else e=null,r=i;return null!==e&&(e=" "),null===e&&(r=s),e}function A(){var e;return e=null!==(e=S())?e:""}function R(){var e,n,s,i,o;for(i=r,o=r,e=[],null===(n=p())&&(n=m());null!==n;)e.push(n),null===(n=p())&&(n=m());return null!==e?(58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null!==n&&null!==(s=A())?e=[e,n,s]:(e=null,r=o)):(e=null,r=o),null!==e&&(e=":"),null===e&&(r=i),e}function y(){var e,n,s,i,o,l,a;if(o=r,l=r,null!==(n=b()))for(e=[];null!==n;)e.push(n),n=b();else e=null;if(null!==e){for(n=[],a=r,s=[],i=S();null!==i;)s.push(i),i=S();for(null!==s&&null!==(i=b())?s=[s,i]:(s=null,r=a);null!==s;){for(n.push(s),a=r,s=[],i=S();null!==i;)s.push(i),i=S();null!==s&&null!==(i=b())?s=[s,i]:(s=null,r=a)}null!==n?e=[e,n]:(e=null,r=l)}else e=null,r=l;return null!==e&&(e=function(e){return t.substring(r,e)}(o)),null===e&&(r=o),e}function b(){var e;return/^[!-~]/.test(t.charAt(r))?(e=t.charAt(r),r++):(e=null,l("[!-~]")),null===e&&(e=w()),e}function w(){var e;return/^[\x80-\uFFFF]/.test(t.charAt(r))?(e=t.charAt(r),r++):(e=null,l("[\\x80-\\uFFFF]")),e}function I(){var e;return/^[\x80-\xBF]/.test(t.charAt(r))?(e=t.charAt(r),r++):(e=null,l("[\\x80-\\xBF]")),e}function O(){var e,n,s;if(s=r,null===(n=g())&&(45===t.charCodeAt(r)?(n="-",r++):(n=null,l('"-"')),null===n&&(46===t.charCodeAt(r)?(n=".",r++):(n=null,l('"."')),null===n&&(33===t.charCodeAt(r)?(n="!",r++):(n=null,l('"!"')),null===n&&(37===t.charCodeAt(r)?(n="%",r++):(n=null,l('"%"')),null===n&&(42===t.charCodeAt(r)?(n="*",r++):(n=null,l('"*"')),null===n&&(95===t.charCodeAt(r)?(n="_",r++):(n=null,l('"_"')),null===n&&(43===t.charCodeAt(r)?(n="+",r++):(n=null,l('"+"')),null===n&&(96===t.charCodeAt(r)?(n="`",r++):(n=null,l('"`"')),null===n&&(39===t.charCodeAt(r)?(n="'",r++):(n=null,l('"\'"')),null===n&&(126===t.charCodeAt(r)?(n="~",r++):(n=null,l('"~"')))))))))))),null!==n)for(e=[];null!==n;)e.push(n),null===(n=g())&&(45===t.charCodeAt(r)?(n="-",r++):(n=null,l('"-"')),null===n&&(46===t.charCodeAt(r)?(n=".",r++):(n=null,l('"."')),null===n&&(33===t.charCodeAt(r)?(n="!",r++):(n=null,l('"!"')),null===n&&(37===t.charCodeAt(r)?(n="%",r++):(n=null,l('"%"')),null===n&&(42===t.charCodeAt(r)?(n="*",r++):(n=null,l('"*"')),null===n&&(95===t.charCodeAt(r)?(n="_",r++):(n=null,l('"_"')),null===n&&(43===t.charCodeAt(r)?(n="+",r++):(n=null,l('"+"')),null===n&&(96===t.charCodeAt(r)?(n="`",r++):(n=null,l('"`"')),null===n&&(39===t.charCodeAt(r)?(n="'",r++):(n=null,l('"\'"')),null===n&&(126===t.charCodeAt(r)?(n="~",r++):(n=null,l('"~"'))))))))))));else e=null;return null!==e&&(e=function(e){return t.substring(r,e)}(s)),null===e&&(r=s),e}function N(){var e,n,s;if(s=r,null===(n=g())&&(45===t.charCodeAt(r)?(n="-",r++):(n=null,l('"-"')),null===n&&(33===t.charCodeAt(r)?(n="!",r++):(n=null,l('"!"')),null===n&&(37===t.charCodeAt(r)?(n="%",r++):(n=null,l('"%"')),null===n&&(42===t.charCodeAt(r)?(n="*",r++):(n=null,l('"*"')),null===n&&(95===t.charCodeAt(r)?(n="_",r++):(n=null,l('"_"')),null===n&&(43===t.charCodeAt(r)?(n="+",r++):(n=null,l('"+"')),null===n&&(96===t.charCodeAt(r)?(n="`",r++):(n=null,l('"`"')),null===n&&(39===t.charCodeAt(r)?(n="'",r++):(n=null,l('"\'"')),null===n&&(126===t.charCodeAt(r)?(n="~",r++):(n=null,l('"~"'))))))))))),null!==n)for(e=[];null!==n;)e.push(n),null===(n=g())&&(45===t.charCodeAt(r)?(n="-",r++):(n=null,l('"-"')),null===n&&(33===t.charCodeAt(r)?(n="!",r++):(n=null,l('"!"')),null===n&&(37===t.charCodeAt(r)?(n="%",r++):(n=null,l('"%"')),null===n&&(42===t.charCodeAt(r)?(n="*",r++):(n=null,l('"*"')),null===n&&(95===t.charCodeAt(r)?(n="_",r++):(n=null,l('"_"')),null===n&&(43===t.charCodeAt(r)?(n="+",r++):(n=null,l('"+"')),null===n&&(96===t.charCodeAt(r)?(n="`",r++):(n=null,l('"`"')),null===n&&(39===t.charCodeAt(r)?(n="'",r++):(n=null,l('"\'"')),null===n&&(126===t.charCodeAt(r)?(n="~",r++):(n=null,l('"~"')))))))))));else e=null;return null!==e&&(e=function(e){return t.substring(r,e)}(s)),null===e&&(r=s),e}function D(){var e,n,s;if(s=r,null===(n=g())&&(45===t.charCodeAt(r)?(n="-",r++):(n=null,l('"-"')),null===n&&(46===t.charCodeAt(r)?(n=".",r++):(n=null,l('"."')),null===n&&(33===t.charCodeAt(r)?(n="!",r++):(n=null,l('"!"')),null===n&&(37===t.charCodeAt(r)?(n="%",r++):(n=null,l('"%"')),null===n&&(42===t.charCodeAt(r)?(n="*",r++):(n=null,l('"*"')),null===n&&(95===t.charCodeAt(r)?(n="_",r++):(n=null,l('"_"')),null===n&&(43===t.charCodeAt(r)?(n="+",r++):(n=null,l('"+"')),null===n&&(96===t.charCodeAt(r)?(n="`",r++):(n=null,l('"`"')),null===n&&(39===t.charCodeAt(r)?(n="'",r++):(n=null,l('"\'"')),null===n&&(126===t.charCodeAt(r)?(n="~",r++):(n=null,l('"~"')),null===n&&(40===t.charCodeAt(r)?(n="(",r++):(n=null,l('"("')),null===n&&(41===t.charCodeAt(r)?(n=")",r++):(n=null,l('")"')),null===n&&(60===t.charCodeAt(r)?(n="<",r++):(n=null,l('"<"')),null===n&&(62===t.charCodeAt(r)?(n=">",r++):(n=null,l('">"')),null===n&&(58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null===n&&(92===t.charCodeAt(r)?(n="\\",r++):(n=null,l('"\\\\"')),null===n&&null===(n=_())&&(47===t.charCodeAt(r)?(n="/",r++):(n=null,l('"/"')),null===n&&(91===t.charCodeAt(r)?(n="[",r++):(n=null,l('"["')),null===n&&(93===t.charCodeAt(r)?(n="]",r++):(n=null,l('"]"')),null===n&&(63===t.charCodeAt(r)?(n="?",r++):(n=null,l('"?"')),null===n&&(123===t.charCodeAt(r)?(n="{",r++):(n=null,l('"{"')),null===n&&(125===t.charCodeAt(r)?(n="}",r++):(n=null,l('"}"')))))))))))))))))))))))),null!==n)for(e=[];null!==n;)e.push(n),null===(n=g())&&(45===t.charCodeAt(r)?(n="-",r++):(n=null,l('"-"')),null===n&&(46===t.charCodeAt(r)?(n=".",r++):(n=null,l('"."')),null===n&&(33===t.charCodeAt(r)?(n="!",r++):(n=null,l('"!"')),null===n&&(37===t.charCodeAt(r)?(n="%",r++):(n=null,l('"%"')),null===n&&(42===t.charCodeAt(r)?(n="*",r++):(n=null,l('"*"')),null===n&&(95===t.charCodeAt(r)?(n="_",r++):(n=null,l('"_"')),null===n&&(43===t.charCodeAt(r)?(n="+",r++):(n=null,l('"+"')),null===n&&(96===t.charCodeAt(r)?(n="`",r++):(n=null,l('"`"')),null===n&&(39===t.charCodeAt(r)?(n="'",r++):(n=null,l('"\'"')),null===n&&(126===t.charCodeAt(r)?(n="~",r++):(n=null,l('"~"')),null===n&&(40===t.charCodeAt(r)?(n="(",r++):(n=null,l('"("')),null===n&&(41===t.charCodeAt(r)?(n=")",r++):(n=null,l('")"')),null===n&&(60===t.charCodeAt(r)?(n="<",r++):(n=null,l('"<"')),null===n&&(62===t.charCodeAt(r)?(n=">",r++):(n=null,l('">"')),null===n&&(58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null===n&&(92===t.charCodeAt(r)?(n="\\",r++):(n=null,l('"\\\\"')),null===n&&null===(n=_())&&(47===t.charCodeAt(r)?(n="/",r++):(n=null,l('"/"')),null===n&&(91===t.charCodeAt(r)?(n="[",r++):(n=null,l('"["')),null===n&&(93===t.charCodeAt(r)?(n="]",r++):(n=null,l('"]"')),null===n&&(63===t.charCodeAt(r)?(n="?",r++):(n=null,l('"?"')),null===n&&(123===t.charCodeAt(r)?(n="{",r++):(n=null,l('"{"')),null===n&&(125===t.charCodeAt(r)?(n="}",r++):(n=null,l('"}"'))))))))))))))))))))))));else e=null;return null!==e&&(e=function(e){return t.substring(r,e)}(s)),null===e&&(r=s),e}function P(){var e,n,s,i,o;return i=r,o=r,null!==(e=A())?(42===t.charCodeAt(r)?(n="*",r++):(n=null,l('"*"')),null!==n&&null!==(s=A())?e=[e,n,s]:(e=null,r=o)):(e=null,r=o),null!==e&&(e="*"),null===e&&(r=i),e}function x(){var e,n,s,i,o;return i=r,o=r,null!==(e=A())?(47===t.charCodeAt(r)?(n="/",r++):(n=null,l('"/"')),null!==n&&null!==(s=A())?e=[e,n,s]:(e=null,r=o)):(e=null,r=o),null!==e&&(e="/"),null===e&&(r=i),e}function L(){var e,n,s,i,o;return i=r,o=r,null!==(e=A())?(61===t.charCodeAt(r)?(n="=",r++):(n=null,l('"="')),null!==n&&null!==(s=A())?e=[e,n,s]:(e=null,r=o)):(e=null,r=o),null!==e&&(e="="),null===e&&(r=i),e}function U(){var e,n,s,i,o;return i=r,o=r,null!==(e=A())?(40===t.charCodeAt(r)?(n="(",r++):(n=null,l('"("')),null!==n&&null!==(s=A())?e=[e,n,s]:(e=null,r=o)):(e=null,r=o),null!==e&&(e="("),null===e&&(r=i),e}function k(){var e,n,s,i,o;return i=r,o=r,null!==(e=A())?(41===t.charCodeAt(r)?(n=")",r++):(n=null,l('")"')),null!==n&&null!==(s=A())?e=[e,n,s]:(e=null,r=o)):(e=null,r=o),null!==e&&(e=")"),null===e&&(r=i),e}function M(){var e,n,s,i;return s=r,i=r,62===t.charCodeAt(r)?(e=">",r++):(e=null,l('">"')),null!==e&&null!==(n=A())?e=[e,n]:(e=null,r=i),null!==e&&(e=">"),null===e&&(r=s),e}function $(){var e,n,s,i;return s=r,i=r,null!==(e=A())?(60===t.charCodeAt(r)?(n="<",r++):(n=null,l('"<"')),null!==n?e=[e,n]:(e=null,r=i)):(e=null,r=i),null!==e&&(e="<"),null===e&&(r=s),e}function F(){var e,n,s,i,o;return i=r,o=r,null!==(e=A())?(44===t.charCodeAt(r)?(n=",",r++):(n=null,l('","')),null!==n&&null!==(s=A())?e=[e,n,s]:(e=null,r=o)):(e=null,r=o),null!==e&&(e=","),null===e&&(r=i),e}function q(){var e,n,s,i,o;return i=r,o=r,null!==(e=A())?(59===t.charCodeAt(r)?(n=";",r++):(n=null,l('";"')),null!==n&&null!==(s=A())?e=[e,n,s]:(e=null,r=o)):(e=null,r=o),null!==e&&(e=";"),null===e&&(r=i),e}function H(){var e,n,s,i,o;return i=r,o=r,null!==(e=A())?(58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null!==n&&null!==(s=A())?e=[e,n,s]:(e=null,r=o)):(e=null,r=o),null!==e&&(e=":"),null===e&&(r=i),e}function j(){var e,t,n,s;return n=r,s=r,null!==(e=A())&&null!==(t=_())?e=[e,t]:(e=null,r=s),null!==e&&(e='"'),null===e&&(r=n),e}function B(){var e,t,n,s;return n=r,s=r,null!==(e=_())&&null!==(t=A())?e=[e,t]:(e=null,r=s),null!==e&&(e='"'),null===e&&(r=n),e}function W(){var e;return/^[!-']/.test(t.charAt(r))?(e=t.charAt(r),r++):(e=null,l("[!-']")),null===e&&(/^[*-[]/.test(t.charAt(r))?(e=t.charAt(r),r++):(e=null,l("[*-[]")),null===e&&(/^[\]-~]/.test(t.charAt(r))?(e=t.charAt(r),r++):(e=null,l("[\\]-~]")),null===e&&null===(e=w())&&(e=S()))),e}function G(){var e,n,s,i,o,l;if(o=r,l=r,null!==(e=A()))if(null!==(n=_())){for(s=[],null===(i=K())&&(i=z());null!==i;)s.push(i),null===(i=K())&&(i=z());null!==s&&null!==(i=_())?e=[e,n,s,i]:(e=null,r=l)}else e=null,r=l;else e=null,r=l;return null!==e&&(e=function(e){return t.substring(r,e)}(o)),null===e&&(r=o),e}function V(){var e,n,s,i,o,l;if(o=r,l=r,null!==(e=A()))if(null!==(n=_())){for(s=[],null===(i=K())&&(i=z());null!==i;)s.push(i),null===(i=K())&&(i=z());null!==s&&null!==(i=_())?e=[e,n,s,i]:(e=null,r=l)}else e=null,r=l;else e=null,r=l;return null!==e&&(e=function(e){var n=t.substring(r,e).trim();return n.substring(1,n.length-1).replace(/\\([\x00-\x09\x0b-\x0c\x0e-\x7f])/g,"$1")}(o)),null===e&&(r=o),e}function K(){var e;return null===(e=S())&&(33===t.charCodeAt(r)?(e="!",r++):(e=null,l('"!"')),null===e&&(/^[#-[]/.test(t.charAt(r))?(e=t.charAt(r),r++):(e=null,l("[#-[]")),null===e&&(/^[\]-~]/.test(t.charAt(r))?(e=t.charAt(r),r++):(e=null,l("[\\]-~]")),null===e&&(e=w())))),e}function z(){var e,n,s;return s=r,92===t.charCodeAt(r)?(e="\\",r++):(e=null,l('"\\\\"')),null!==e?(/^[\0-\t]/.test(t.charAt(r))?(n=t.charAt(r),r++):(n=null,l("[\\0-\\t]")),null===n&&(/^[\x0B-\f]/.test(t.charAt(r))?(n=t.charAt(r),r++):(n=null,l("[\\x0B-\\f]")),null===n&&(/^[\x0E-]/.test(t.charAt(r))?(n=t.charAt(r),r++):(n=null,l("[\\x0E-]")))),null!==n?e=[e,n]:(e=null,r=s)):(e=null,r=s),e}function J(){var e,n,s,i,o,a;return o=r,a=r,null!==(e=Y())?(58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null!==n&&null!==(s=null!==(s=ee())?s:"")&&null!==(i=re())?e=[e,n,s,i]:(e=null,r=a)):(e=null,r=a),null!==e&&(e=function(e){try{Fn.uri=new Mn(Fn.scheme,Fn.user,Fn.host,Fn.port),delete Fn.scheme,delete Fn.user,delete Fn.host,delete Fn.host_type,delete Fn.port}catch(e){Fn=-1}}()),null===e&&(r=o),e}function X(){var e,s,i,o,a,u,c,h;return c=r,h=r,null!==(e=Y())?(58===t.charCodeAt(r)?(s=":",r++):(s=null,l('":"')),null!==s&&null!==(i=null!==(i=ee())?i:"")&&null!==(o=re())&&null!==(a=me())&&null!==(u=null!==(u=Oe())?u:"")?e=[e,s,i,o,a,u]:(e=null,r=h)):(e=null,r=h),null!==e&&(e=function(e){try{Fn.uri=new Mn(Fn.scheme,Fn.user,Fn.host,Fn.port,Fn.uri_params,Fn.uri_headers),delete Fn.scheme,delete Fn.user,delete Fn.host,delete Fn.host_type,delete Fn.port,delete Fn.uri_params,"SIP_URI"===n&&(Fn=Fn.uri)}catch(e){Fn=-1}}()),null===e&&(r=c),e}function Y(){var e;return null===(e=Q())&&(e=Z()),e}function Q(){var e,n,s;return n=r,"sips"===t.substr(r,4).toLowerCase()?(e=t.substr(r,4),r+=4):(e=null,l('"sips"')),null!==e&&(s=e,e=void(Fn.scheme=s.toLowerCase())),null===e&&(r=n),e}function Z(){var e,n,s;return n=r,"sip"===t.substr(r,3).toLowerCase()?(e=t.substr(r,3),r+=3):(e=null,l('"sip"')),null!==e&&(s=e,e=void(Fn.scheme=s.toLowerCase())),null===e&&(r=n),e}function ee(){var e,n,s,i,o,a;return i=r,o=r,null!==(e=te())?(a=r,58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null!==n&&null!==(s=se())?n=[n,s]:(n=null,r=a),null!==(n=null!==n?n:"")?(64===t.charCodeAt(r)?(s="@",r++):(s=null,l('"@"')),null!==s?e=[e,n,s]:(e=null,r=o)):(e=null,r=o)):(e=null,r=o),null!==e&&(e=function(e){Fn.user=decodeURIComponent(t.substring(r-1,e))}(i)),null===e&&(r=i),e}function te(){var e,t;if(null===(t=v())&&null===(t=C())&&(t=ne()),null!==t)for(e=[];null!==t;)e.push(t),null===(t=v())&&null===(t=C())&&(t=ne());else e=null;return e}function ne(){var e;return 38===t.charCodeAt(r)?(e="&",r++):(e=null,l('"&"')),null===e&&(61===t.charCodeAt(r)?(e="=",r++):(e=null,l('"="')),null===e&&(43===t.charCodeAt(r)?(e="+",r++):(e=null,l('"+"')),null===e&&(36===t.charCodeAt(r)?(e="$",r++):(e=null,l('"$"')),null===e&&(44===t.charCodeAt(r)?(e=",",r++):(e=null,l('","')),null===e&&(59===t.charCodeAt(r)?(e=";",r++):(e=null,l('";"')),null===e&&(63===t.charCodeAt(r)?(e="?",r++):(e=null,l('"?"')),null===e&&(47===t.charCodeAt(r)?(e="/",r++):(e=null,l('"/"'))))))))),e}function se(){var e,n,s;for(s=r,e=[],null===(n=v())&&null===(n=C())&&(38===t.charCodeAt(r)?(n="&",r++):(n=null,l('"&"')),null===n&&(61===t.charCodeAt(r)?(n="=",r++):(n=null,l('"="')),null===n&&(43===t.charCodeAt(r)?(n="+",r++):(n=null,l('"+"')),null===n&&(36===t.charCodeAt(r)?(n="$",r++):(n=null,l('"$"')),null===n&&(44===t.charCodeAt(r)?(n=",",r++):(n=null,l('","')))))));null!==n;)e.push(n),null===(n=v())&&null===(n=C())&&(38===t.charCodeAt(r)?(n="&",r++):(n=null,l('"&"')),null===n&&(61===t.charCodeAt(r)?(n="=",r++):(n=null,l('"="')),null===n&&(43===t.charCodeAt(r)?(n="+",r++):(n=null,l('"+"')),null===n&&(36===t.charCodeAt(r)?(n="$",r++):(n=null,l('"$"')),null===n&&(44===t.charCodeAt(r)?(n=",",r++):(n=null,l('","')))))));return null!==e&&(e=function(e){Fn.password=t.substring(r,e)}(s)),null===e&&(r=s),e}function re(){var e,n,s,i,o;return i=r,null!==(e=ie())?(o=r,58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null!==n&&null!==(s=pe())?n=[n,s]:(n=null,r=o),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,r=i)):(e=null,r=i),e}function ie(){var e,n;return n=r,null===(e=oe())&&null===(e=fe())&&(e=ue()),null!==e&&(e=function(e){return Fn.host=t.substring(r,e).toLowerCase(),Fn.host}(n)),null===e&&(r=n),e}function oe(){var e,n,s,i,o,a;for(i=r,o=r,e=[],a=r,null!==(n=le())?(46===t.charCodeAt(r)?(s=".",r++):(s=null,l('"."')),null!==s?n=[n,s]:(n=null,r=a)):(n=null,r=a);null!==n;)e.push(n),a=r,null!==(n=le())?(46===t.charCodeAt(r)?(s=".",r++):(s=null,l('"."')),null!==s?n=[n,s]:(n=null,r=a)):(n=null,r=a);return null!==e&&null!==(n=ae())?(46===t.charCodeAt(r)?(s=".",r++):(s=null,l('"."')),null!==(s=null!==s?s:"")?e=[e,n,s]:(e=null,r=o)):(e=null,r=o),null!==e&&(e=function(e){return Fn.host_type="domain",t.substring(r,e)}(i)),null===e&&(r=i),e}function le(){var e,n,s,i;if(i=r,null!==(e=g())){for(n=[],null===(s=g())&&(45===t.charCodeAt(r)?(s="-",r++):(s=null,l('"-"')),null===s&&(95===t.charCodeAt(r)?(s="_",r++):(s=null,l('"_"'))));null!==s;)n.push(s),null===(s=g())&&(45===t.charCodeAt(r)?(s="-",r++):(s=null,l('"-"')),null===s&&(95===t.charCodeAt(r)?(s="_",r++):(s=null,l('"_"'))));null!==n?e=[e,n]:(e=null,r=i)}else e=null,r=i;return e}function ae(){var e,n,s,i;if(i=r,null!==(e=g())){for(n=[],null===(s=g())&&(45===t.charCodeAt(r)?(s="-",r++):(s=null,l('"-"')),null===s&&(95===t.charCodeAt(r)?(s="_",r++):(s=null,l('"_"'))));null!==s;)n.push(s),null===(s=g())&&(45===t.charCodeAt(r)?(s="-",r++):(s=null,l('"-"')),null===s&&(95===t.charCodeAt(r)?(s="_",r++):(s=null,l('"_"'))));null!==n?e=[e,n]:(e=null,r=i)}else e=null,r=i;return e}function ue(){var e,n,s,i,o;return i=r,o=r,91===t.charCodeAt(r)?(e="[",r++):(e=null,l('"["')),null!==e&&null!==(n=ce())?(93===t.charCodeAt(r)?(s="]",r++):(s=null,l('"]"')),null!==s?e=[e,n,s]:(e=null,r=o)):(e=null,r=o),null!==e&&(e=function(e){return Fn.host_type="IPv6",t.substring(r,e)}(i)),null===e&&(r=i),e}function ce(){var e,n,s,i,o,a,u,c,h,d,f,_,p,m,g,T;return m=r,g=r,null!==(e=he())?(58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null!==n&&null!==(s=he())?(58===t.charCodeAt(r)?(i=":",r++):(i=null,l('":"')),null!==i&&null!==(o=he())?(58===t.charCodeAt(r)?(a=":",r++):(a=null,l('":"')),null!==a&&null!==(u=he())?(58===t.charCodeAt(r)?(c=":",r++):(c=null,l('":"')),null!==c&&null!==(h=he())?(58===t.charCodeAt(r)?(d=":",r++):(d=null,l('":"')),null!==d&&null!==(f=he())?(58===t.charCodeAt(r)?(_=":",r++):(_=null,l('":"')),null!==_&&null!==(p=de())?e=[e,n,s,i,o,a,u,c,h,d,f,_,p]:(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g),null===e&&(g=r,"::"===t.substr(r,2)?(e="::",r+=2):(e=null,l('"::"')),null!==e&&null!==(n=he())?(58===t.charCodeAt(r)?(s=":",r++):(s=null,l('":"')),null!==s&&null!==(i=he())?(58===t.charCodeAt(r)?(o=":",r++):(o=null,l('":"')),null!==o&&null!==(a=he())?(58===t.charCodeAt(r)?(u=":",r++):(u=null,l('":"')),null!==u&&null!==(c=he())?(58===t.charCodeAt(r)?(h=":",r++):(h=null,l('":"')),null!==h&&null!==(d=he())?(58===t.charCodeAt(r)?(f=":",r++):(f=null,l('":"')),null!==f&&null!==(_=de())?e=[e,n,s,i,o,a,u,c,h,d,f,_]:(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g),null===e&&(g=r,"::"===t.substr(r,2)?(e="::",r+=2):(e=null,l('"::"')),null!==e&&null!==(n=he())?(58===t.charCodeAt(r)?(s=":",r++):(s=null,l('":"')),null!==s&&null!==(i=he())?(58===t.charCodeAt(r)?(o=":",r++):(o=null,l('":"')),null!==o&&null!==(a=he())?(58===t.charCodeAt(r)?(u=":",r++):(u=null,l('":"')),null!==u&&null!==(c=he())?(58===t.charCodeAt(r)?(h=":",r++):(h=null,l('":"')),null!==h&&null!==(d=de())?e=[e,n,s,i,o,a,u,c,h,d]:(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g),null===e&&(g=r,"::"===t.substr(r,2)?(e="::",r+=2):(e=null,l('"::"')),null!==e&&null!==(n=he())?(58===t.charCodeAt(r)?(s=":",r++):(s=null,l('":"')),null!==s&&null!==(i=he())?(58===t.charCodeAt(r)?(o=":",r++):(o=null,l('":"')),null!==o&&null!==(a=he())?(58===t.charCodeAt(r)?(u=":",r++):(u=null,l('":"')),null!==u&&null!==(c=de())?e=[e,n,s,i,o,a,u,c]:(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g),null===e&&(g=r,"::"===t.substr(r,2)?(e="::",r+=2):(e=null,l('"::"')),null!==e&&null!==(n=he())?(58===t.charCodeAt(r)?(s=":",r++):(s=null,l('":"')),null!==s&&null!==(i=he())?(58===t.charCodeAt(r)?(o=":",r++):(o=null,l('":"')),null!==o&&null!==(a=de())?e=[e,n,s,i,o,a]:(e=null,r=g)):(e=null,r=g)):(e=null,r=g),null===e&&(g=r,"::"===t.substr(r,2)?(e="::",r+=2):(e=null,l('"::"')),null!==e&&null!==(n=he())?(58===t.charCodeAt(r)?(s=":",r++):(s=null,l('":"')),null!==s&&null!==(i=de())?e=[e,n,s,i]:(e=null,r=g)):(e=null,r=g),null===e&&(g=r,"::"===t.substr(r,2)?(e="::",r+=2):(e=null,l('"::"')),null!==e&&null!==(n=de())?e=[e,n]:(e=null,r=g),null===e&&(g=r,"::"===t.substr(r,2)?(e="::",r+=2):(e=null,l('"::"')),null!==e&&null!==(n=he())?e=[e,n]:(e=null,r=g),null===e&&(g=r,null!==(e=he())?("::"===t.substr(r,2)?(n="::",r+=2):(n=null,l('"::"')),null!==n&&null!==(s=he())?(58===t.charCodeAt(r)?(i=":",r++):(i=null,l('":"')),null!==i&&null!==(o=he())?(58===t.charCodeAt(r)?(a=":",r++):(a=null,l('":"')),null!==a&&null!==(u=he())?(58===t.charCodeAt(r)?(c=":",r++):(c=null,l('":"')),null!==c&&null!==(h=he())?(58===t.charCodeAt(r)?(d=":",r++):(d=null,l('":"')),null!==d&&null!==(f=de())?e=[e,n,s,i,o,a,u,c,h,d,f]:(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g),null===e&&(g=r,null!==(e=he())?(T=r,58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null!==n&&null!==(s=he())?n=[n,s]:(n=null,r=T),null!==(n=null!==n?n:"")?("::"===t.substr(r,2)?(s="::",r+=2):(s=null,l('"::"')),null!==s&&null!==(i=he())?(58===t.charCodeAt(r)?(o=":",r++):(o=null,l('":"')),null!==o&&null!==(a=he())?(58===t.charCodeAt(r)?(u=":",r++):(u=null,l('":"')),null!==u&&null!==(c=he())?(58===t.charCodeAt(r)?(h=":",r++):(h=null,l('":"')),null!==h&&null!==(d=de())?e=[e,n,s,i,o,a,u,c,h,d]:(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g),null===e&&(g=r,null!==(e=he())?(T=r,58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null!==n&&null!==(s=he())?n=[n,s]:(n=null,r=T),null!==(n=null!==n?n:"")?(T=r,58===t.charCodeAt(r)?(s=":",r++):(s=null,l('":"')),null!==s&&null!==(i=he())?s=[s,i]:(s=null,r=T),null!==(s=null!==s?s:"")?("::"===t.substr(r,2)?(i="::",r+=2):(i=null,l('"::"')),null!==i&&null!==(o=he())?(58===t.charCodeAt(r)?(a=":",r++):(a=null,l('":"')),null!==a&&null!==(u=he())?(58===t.charCodeAt(r)?(c=":",r++):(c=null,l('":"')),null!==c&&null!==(h=de())?e=[e,n,s,i,o,a,u,c,h]:(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g),null===e&&(g=r,null!==(e=he())?(T=r,58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null!==n&&null!==(s=he())?n=[n,s]:(n=null,r=T),null!==(n=null!==n?n:"")?(T=r,58===t.charCodeAt(r)?(s=":",r++):(s=null,l('":"')),null!==s&&null!==(i=he())?s=[s,i]:(s=null,r=T),null!==(s=null!==s?s:"")?(T=r,58===t.charCodeAt(r)?(i=":",r++):(i=null,l('":"')),null!==i&&null!==(o=he())?i=[i,o]:(i=null,r=T),null!==(i=null!==i?i:"")?("::"===t.substr(r,2)?(o="::",r+=2):(o=null,l('"::"')),null!==o&&null!==(a=he())?(58===t.charCodeAt(r)?(u=":",r++):(u=null,l('":"')),null!==u&&null!==(c=de())?e=[e,n,s,i,o,a,u,c]:(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g),null===e&&(g=r,null!==(e=he())?(T=r,58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null!==n&&null!==(s=he())?n=[n,s]:(n=null,r=T),null!==(n=null!==n?n:"")?(T=r,58===t.charCodeAt(r)?(s=":",r++):(s=null,l('":"')),null!==s&&null!==(i=he())?s=[s,i]:(s=null,r=T),null!==(s=null!==s?s:"")?(T=r,58===t.charCodeAt(r)?(i=":",r++):(i=null,l('":"')),null!==i&&null!==(o=he())?i=[i,o]:(i=null,r=T),null!==(i=null!==i?i:"")?(T=r,58===t.charCodeAt(r)?(o=":",r++):(o=null,l('":"')),null!==o&&null!==(a=he())?o=[o,a]:(o=null,r=T),null!==(o=null!==o?o:"")?("::"===t.substr(r,2)?(a="::",r+=2):(a=null,l('"::"')),null!==a&&null!==(u=de())?e=[e,n,s,i,o,a,u]:(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g),null===e&&(g=r,null!==(e=he())?(T=r,58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null!==n&&null!==(s=he())?n=[n,s]:(n=null,r=T),null!==(n=null!==n?n:"")?(T=r,58===t.charCodeAt(r)?(s=":",r++):(s=null,l('":"')),null!==s&&null!==(i=he())?s=[s,i]:(s=null,r=T),null!==(s=null!==s?s:"")?(T=r,58===t.charCodeAt(r)?(i=":",r++):(i=null,l('":"')),null!==i&&null!==(o=he())?i=[i,o]:(i=null,r=T),null!==(i=null!==i?i:"")?(T=r,58===t.charCodeAt(r)?(o=":",r++):(o=null,l('":"')),null!==o&&null!==(a=he())?o=[o,a]:(o=null,r=T),null!==(o=null!==o?o:"")?(T=r,58===t.charCodeAt(r)?(a=":",r++):(a=null,l('":"')),null!==a&&null!==(u=he())?a=[a,u]:(a=null,r=T),null!==(a=null!==a?a:"")?("::"===t.substr(r,2)?(u="::",r+=2):(u=null,l('"::"')),null!==u&&null!==(c=he())?e=[e,n,s,i,o,a,u,c]:(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g),null===e&&(g=r,null!==(e=he())?(T=r,58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null!==n&&null!==(s=he())?n=[n,s]:(n=null,r=T),null!==(n=null!==n?n:"")?(T=r,58===t.charCodeAt(r)?(s=":",r++):(s=null,l('":"')),null!==s&&null!==(i=he())?s=[s,i]:(s=null,r=T),null!==(s=null!==s?s:"")?(T=r,58===t.charCodeAt(r)?(i=":",r++):(i=null,l('":"')),null!==i&&null!==(o=he())?i=[i,o]:(i=null,r=T),null!==(i=null!==i?i:"")?(T=r,58===t.charCodeAt(r)?(o=":",r++):(o=null,l('":"')),null!==o&&null!==(a=he())?o=[o,a]:(o=null,r=T),null!==(o=null!==o?o:"")?(T=r,58===t.charCodeAt(r)?(a=":",r++):(a=null,l('":"')),null!==a&&null!==(u=he())?a=[a,u]:(a=null,r=T),null!==(a=null!==a?a:"")?(T=r,58===t.charCodeAt(r)?(u=":",r++):(u=null,l('":"')),null!==u&&null!==(c=he())?u=[u,c]:(u=null,r=T),null!==(u=null!==u?u:"")?("::"===t.substr(r,2)?(c="::",r+=2):(c=null,l('"::"')),null!==c?e=[e,n,s,i,o,a,u,c]:(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g)):(e=null,r=g))))))))))))))),null!==e&&(e=function(e){return Fn.host_type="IPv6",t.substring(r,e)}(m)),null===e&&(r=m),e}function he(){var e,t,n,s,i;return i=r,null!==(e=h())&&null!==(t=null!==(t=h())?t:"")&&null!==(n=null!==(n=h())?n:"")&&null!==(s=null!==(s=h())?s:"")?e=[e,t,n,s]:(e=null,r=i),e}function de(){var e,n,s,i;return i=r,null!==(e=he())?(58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null!==n&&null!==(s=he())?e=[e,n,s]:(e=null,r=i)):(e=null,r=i),null===e&&(e=fe()),e}function fe(){var e,n,s,i,o,a,u,c,h;return c=r,h=r,null!==(e=_e())?(46===t.charCodeAt(r)?(n=".",r++):(n=null,l('"."')),null!==n&&null!==(s=_e())?(46===t.charCodeAt(r)?(i=".",r++):(i=null,l('"."')),null!==i&&null!==(o=_e())?(46===t.charCodeAt(r)?(a=".",r++):(a=null,l('"."')),null!==a&&null!==(u=_e())?e=[e,n,s,i,o,a,u]:(e=null,r=h)):(e=null,r=h)):(e=null,r=h)):(e=null,r=h),null!==e&&(e=function(e){return Fn.host_type="IPv4",t.substring(r,e)}(c)),null===e&&(r=c),e}function _e(){var e,n,s,i;return i=r,"25"===t.substr(r,2)?(e="25",r+=2):(e=null,l('"25"')),null!==e?(/^[0-5]/.test(t.charAt(r))?(n=t.charAt(r),r++):(n=null,l("[0-5]")),null!==n?e=[e,n]:(e=null,r=i)):(e=null,r=i),null===e&&(i=r,50===t.charCodeAt(r)?(e="2",r++):(e=null,l('"2"')),null!==e?(/^[0-4]/.test(t.charAt(r))?(n=t.charAt(r),r++):(n=null,l("[0-4]")),null!==n&&null!==(s=u())?e=[e,n,s]:(e=null,r=i)):(e=null,r=i),null===e&&(i=r,49===t.charCodeAt(r)?(e="1",r++):(e=null,l('"1"')),null!==e&&null!==(n=u())&&null!==(s=u())?e=[e,n,s]:(e=null,r=i),null===e&&(i=r,/^[1-9]/.test(t.charAt(r))?(e=t.charAt(r),r++):(e=null,l("[1-9]")),null!==e&&null!==(n=u())?e=[e,n]:(e=null,r=i),null===e&&(e=u())))),e}function pe(){var e,t,n,s,i,o,l,a;return o=r,l=r,null!==(e=null!==(e=u())?e:"")&&null!==(t=null!==(t=u())?t:"")&&null!==(n=null!==(n=u())?n:"")&&null!==(s=null!==(s=u())?s:"")&&null!==(i=null!==(i=u())?i:"")?e=[e,t,n,s,i]:(e=null,r=l),null!==e&&(a=e,a=parseInt(a.join("")),Fn.port=a,e=a),null===e&&(r=o),e}function me(){var e,n,s,i;for(e=[],i=r,59===t.charCodeAt(r)?(n=";",r++):(n=null,l('";"')),null!==n&&null!==(s=ge())?n=[n,s]:(n=null,r=i);null!==n;)e.push(n),i=r,59===t.charCodeAt(r)?(n=";",r++):(n=null,l('";"')),null!==n&&null!==(s=ge())?n=[n,s]:(n=null,r=i);return e}function ge(){var e;return null===(e=Te())&&null===(e=ve())&&null===(e=Ee())&&null===(e=Ce())&&null===(e=Se())&&null===(e=Ae())&&(e=Re()),e}function Te(){var e,n,s,i;return s=r,i=r,"transport="===t.substr(r,10).toLowerCase()?(e=t.substr(r,10),r+=10):(e=null,l('"transport="')),null!==e?("udp"===t.substr(r,3).toLowerCase()?(n=t.substr(r,3),r+=3):(n=null,l('"udp"')),null===n&&("tcp"===t.substr(r,3).toLowerCase()?(n=t.substr(r,3),r+=3):(n=null,l('"tcp"')),null===n&&("sctp"===t.substr(r,4).toLowerCase()?(n=t.substr(r,4),r+=4):(n=null,l('"sctp"')),null===n&&("tls"===t.substr(r,3).toLowerCase()?(n=t.substr(r,3),r+=3):(n=null,l('"tls"')),null===n&&(n=O())))),null!==n?e=[e,n]:(e=null,r=i)):(e=null,r=i),null!==e&&(e=function(e,t){Fn.uri_params||(Fn.uri_params={}),Fn.uri_params.transport=t.toLowerCase()}(0,e[1])),null===e&&(r=s),e}function ve(){var e,n,s,i,o;return s=r,i=r,"user="===t.substr(r,5).toLowerCase()?(e=t.substr(r,5),r+=5):(e=null,l('"user="')),null!==e?("phone"===t.substr(r,5).toLowerCase()?(n=t.substr(r,5),r+=5):(n=null,l('"phone"')),null===n&&("ip"===t.substr(r,2).toLowerCase()?(n=t.substr(r,2),r+=2):(n=null,l('"ip"')),null===n&&(n=O())),null!==n?e=[e,n]:(e=null,r=i)):(e=null,r=i),null!==e&&(o=e[1],Fn.uri_params||(Fn.uri_params={}),e=void(Fn.uri_params.user=o.toLowerCase())),null===e&&(r=s),e}function Ee(){var e,n,s,i,o;return s=r,i=r,"method="===t.substr(r,7).toLowerCase()?(e=t.substr(r,7),r+=7):(e=null,l('"method="')),null!==e&&null!==(n=at())?e=[e,n]:(e=null,r=i),null!==e&&(o=e[1],Fn.uri_params||(Fn.uri_params={}),e=void(Fn.uri_params.method=o)),null===e&&(r=s),e}function Ce(){var e,n,s,i,o;return s=r,i=r,"ttl="===t.substr(r,4).toLowerCase()?(e=t.substr(r,4),r+=4):(e=null,l('"ttl="')),null!==e&&null!==(n=An())?e=[e,n]:(e=null,r=i),null!==e&&(o=e[1],Fn.params||(Fn.params={}),e=void(Fn.params.ttl=o)),null===e&&(r=s),e}function Se(){var e,n,s,i,o;return s=r,i=r,"maddr="===t.substr(r,6).toLowerCase()?(e=t.substr(r,6),r+=6):(e=null,l('"maddr="')),null!==e&&null!==(n=ie())?e=[e,n]:(e=null,r=i),null!==e&&(o=e[1],Fn.uri_params||(Fn.uri_params={}),e=void(Fn.uri_params.maddr=o)),null===e&&(r=s),e}function Ae(){var e,n,s,i,o,a;return i=r,o=r,"lr"===t.substr(r,2).toLowerCase()?(e=t.substr(r,2),r+=2):(e=null,l('"lr"')),null!==e?(a=r,61===t.charCodeAt(r)?(n="=",r++):(n=null,l('"="')),null!==n&&null!==(s=O())?n=[n,s]:(n=null,r=a),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,r=o)):(e=null,r=o),null!==e&&(Fn.uri_params||(Fn.uri_params={}),e=void(Fn.uri_params.lr=void 0)),null===e&&(r=i),e}function Re(){var e,n,s,i,o,a,u,c;return i=r,o=r,null!==(e=ye())?(a=r,61===t.charCodeAt(r)?(n="=",r++):(n=null,l('"="')),null!==n&&null!==(s=be())?n=[n,s]:(n=null,r=a),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,r=o)):(e=null,r=o),null!==e&&(u=e[0],c=e[1],Fn.uri_params||(Fn.uri_params={}),c=void 0===c?void 0:c[1],e=void(Fn.uri_params[u.toLowerCase()]=c)),null===e&&(r=i),e}function ye(){var e,t,n;if(n=r,null!==(t=we()))for(e=[];null!==t;)e.push(t),t=we();else e=null;return null!==e&&(e=e.join("")),null===e&&(r=n),e}function be(){var e,t,n;if(n=r,null!==(t=we()))for(e=[];null!==t;)e.push(t),t=we();else e=null;return null!==e&&(e=e.join("")),null===e&&(r=n),e}function we(){var e;return null===(e=Ie())&&null===(e=v())&&(e=C()),e}function Ie(){var e;return 91===t.charCodeAt(r)?(e="[",r++):(e=null,l('"["')),null===e&&(93===t.charCodeAt(r)?(e="]",r++):(e=null,l('"]"')),null===e&&(47===t.charCodeAt(r)?(e="/",r++):(e=null,l('"/"')),null===e&&(58===t.charCodeAt(r)?(e=":",r++):(e=null,l('":"')),null===e&&(38===t.charCodeAt(r)?(e="&",r++):(e=null,l('"&"')),null===e&&(43===t.charCodeAt(r)?(e="+",r++):(e=null,l('"+"')),null===e&&(36===t.charCodeAt(r)?(e="$",r++):(e=null,l('"$"')))))))),e}function Oe(){var e,n,s,i,o,a,u;if(a=r,63===t.charCodeAt(r)?(e="?",r++):(e=null,l('"?"')),null!==e)if(null!==(n=Ne())){for(s=[],u=r,38===t.charCodeAt(r)?(i="&",r++):(i=null,l('"&"')),null!==i&&null!==(o=Ne())?i=[i,o]:(i=null,r=u);null!==i;)s.push(i),u=r,38===t.charCodeAt(r)?(i="&",r++):(i=null,l('"&"')),null!==i&&null!==(o=Ne())?i=[i,o]:(i=null,r=u);null!==s?e=[e,n,s]:(e=null,r=a)}else e=null,r=a;else e=null,r=a;return e}function Ne(){var e,n,s,i,o,a,u;return i=r,o=r,null!==(e=De())?(61===t.charCodeAt(r)?(n="=",r++):(n=null,l('"="')),null!==n&&null!==(s=Pe())?e=[e,n,s]:(e=null,r=o)):(e=null,r=o),null!==e&&(a=e[0],u=e[2],a=a.join("").toLowerCase(),u=u.join(""),Fn.uri_headers||(Fn.uri_headers={}),e=void(Fn.uri_headers[a]?Fn.uri_headers[a].push(u):Fn.uri_headers[a]=[u])),null===e&&(r=i),e}function De(){var e,t;if(null===(t=xe())&&null===(t=v())&&(t=C()),null!==t)for(e=[];null!==t;)e.push(t),null===(t=xe())&&null===(t=v())&&(t=C());else e=null;return e}function Pe(){var e,t;for(e=[],null===(t=xe())&&null===(t=v())&&(t=C());null!==t;)e.push(t),null===(t=xe())&&null===(t=v())&&(t=C());return e}function xe(){var e;return 91===t.charCodeAt(r)?(e="[",r++):(e=null,l('"["')),null===e&&(93===t.charCodeAt(r)?(e="]",r++):(e=null,l('"]"')),null===e&&(47===t.charCodeAt(r)?(e="/",r++):(e=null,l('"/"')),null===e&&(63===t.charCodeAt(r)?(e="?",r++):(e=null,l('"?"')),null===e&&(58===t.charCodeAt(r)?(e=":",r++):(e=null,l('":"')),null===e&&(43===t.charCodeAt(r)?(e="+",r++):(e=null,l('"+"')),null===e&&(36===t.charCodeAt(r)?(e="$",r++):(e=null,l('"$"')))))))),e}function Le(){var e,t,n,s,i,o;return o=r,null!==(e=at())&&null!==(t=p())&&null!==(n=Ue())&&null!==(s=p())&&null!==(i=Qe())?e=[e,t,n,s,i]:(e=null,r=o),e}function Ue(){var e;return null===(e=X())&&(e=ke()),e}function ke(){var e,n,s,i;return i=r,null!==(e=Ke())?(58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null!==n?(null===(s=Me())&&(s=qe()),null!==s?e=[e,n,s]:(e=null,r=i)):(e=null,r=i)):(e=null,r=i),e}function Me(){var e,n,s,i,o;return i=r,null===(e=$e())&&(e=Fe()),null!==e?(o=r,63===t.charCodeAt(r)?(n="?",r++):(n=null,l('"?"')),null!==n&&null!==(s=Ye())?n=[n,s]:(n=null,r=o),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,r=i)):(e=null,r=i),e}function $e(){var e,n,s,i;return i=r,"//"===t.substr(r,2)?(e="//",r+=2):(e=null,l('"//"')),null!==e&&null!==(n=ze())&&null!==(s=null!==(s=Fe())?s:"")?e=[e,n,s]:(e=null,r=i),e}function Fe(){var e,n,s;return s=r,47===t.charCodeAt(r)?(e="/",r++):(e=null,l('"/"')),null!==e&&null!==(n=Be())?e=[e,n]:(e=null,r=s),e}function qe(){var e,t,n,s;if(s=r,null!==(e=je())){for(t=[],n=He();null!==n;)t.push(n),n=He();null!==t?e=[e,t]:(e=null,r=s)}else e=null,r=s;return e}function He(){var e;return null===(e=T())&&null===(e=v())&&(e=C()),e}function je(){var e;return null===(e=v())&&null===(e=C())&&(59===t.charCodeAt(r)?(e=";",r++):(e=null,l('";"')),null===e&&(63===t.charCodeAt(r)?(e="?",r++):(e=null,l('"?"')),null===e&&(58===t.charCodeAt(r)?(e=":",r++):(e=null,l('":"')),null===e&&(64===t.charCodeAt(r)?(e="@",r++):(e=null,l('"@"')),null===e&&(38===t.charCodeAt(r)?(e="&",r++):(e=null,l('"&"')),null===e&&(61===t.charCodeAt(r)?(e="=",r++):(e=null,l('"="')),null===e&&(43===t.charCodeAt(r)?(e="+",r++):(e=null,l('"+"')),null===e&&(36===t.charCodeAt(r)?(e="$",r++):(e=null,l('"$"')),null===e&&(44===t.charCodeAt(r)?(e=",",r++):(e=null,l('","'))))))))))),e}function Be(){var e,n,s,i,o,a;if(o=r,null!==(e=We())){for(n=[],a=r,47===t.charCodeAt(r)?(s="/",r++):(s=null,l('"/"')),null!==s&&null!==(i=We())?s=[s,i]:(s=null,r=a);null!==s;)n.push(s),a=r,47===t.charCodeAt(r)?(s="/",r++):(s=null,l('"/"')),null!==s&&null!==(i=We())?s=[s,i]:(s=null,r=a);null!==n?e=[e,n]:(e=null,r=o)}else e=null,r=o;return e}function We(){var e,n,s,i,o,a;for(o=r,e=[],n=Ve();null!==n;)e.push(n),n=Ve();if(null!==e){for(n=[],a=r,59===t.charCodeAt(r)?(s=";",r++):(s=null,l('";"')),null!==s&&null!==(i=Ge())?s=[s,i]:(s=null,r=a);null!==s;)n.push(s),a=r,59===t.charCodeAt(r)?(s=";",r++):(s=null,l('";"')),null!==s&&null!==(i=Ge())?s=[s,i]:(s=null,r=a);null!==n?e=[e,n]:(e=null,r=o)}else e=null,r=o;return e}function Ge(){var e,t;for(e=[],t=Ve();null!==t;)e.push(t),t=Ve();return e}function Ve(){var e;return null===(e=v())&&null===(e=C())&&(58===t.charCodeAt(r)?(e=":",r++):(e=null,l('":"')),null===e&&(64===t.charCodeAt(r)?(e="@",r++):(e=null,l('"@"')),null===e&&(38===t.charCodeAt(r)?(e="&",r++):(e=null,l('"&"')),null===e&&(61===t.charCodeAt(r)?(e="=",r++):(e=null,l('"="')),null===e&&(43===t.charCodeAt(r)?(e="+",r++):(e=null,l('"+"')),null===e&&(36===t.charCodeAt(r)?(e="$",r++):(e=null,l('"$"')),null===e&&(44===t.charCodeAt(r)?(e=",",r++):(e=null,l('","'))))))))),e}function Ke(){var e,n,s,i,o;if(i=r,o=r,null!==(e=c())){for(n=[],null===(s=c())&&null===(s=u())&&(43===t.charCodeAt(r)?(s="+",r++):(s=null,l('"+"')),null===s&&(45===t.charCodeAt(r)?(s="-",r++):(s=null,l('"-"')),null===s&&(46===t.charCodeAt(r)?(s=".",r++):(s=null,l('"."')))));null!==s;)n.push(s),null===(s=c())&&null===(s=u())&&(43===t.charCodeAt(r)?(s="+",r++):(s=null,l('"+"')),null===s&&(45===t.charCodeAt(r)?(s="-",r++):(s=null,l('"-"')),null===s&&(46===t.charCodeAt(r)?(s=".",r++):(s=null,l('"."')))));null!==n?e=[e,n]:(e=null,r=o)}else e=null,r=o;return null!==e&&(e=function(e){Fn.scheme=t.substring(r,e)}(i)),null===e&&(r=i),e}function ze(){var e;return null===(e=Je())&&(e=Xe()),e}function Je(){var e,n,s,i;return s=r,i=r,null!==(e=ee())?(64===t.charCodeAt(r)?(n="@",r++):(n=null,l('"@"')),null!==n?e=[e,n]:(e=null,r=i)):(e=null,r=i),null!==(e=null!==e?e:"")&&null!==(n=re())?e=[e,n]:(e=null,r=s),e=null!==e?e:""}function Xe(){var e,n;if(null===(n=v())&&null===(n=C())&&(36===t.charCodeAt(r)?(n="$",r++):(n=null,l('"$"')),null===n&&(44===t.charCodeAt(r)?(n=",",r++):(n=null,l('","')),null===n&&(59===t.charCodeAt(r)?(n=";",r++):(n=null,l('";"')),null===n&&(58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null===n&&(64===t.charCodeAt(r)?(n="@",r++):(n=null,l('"@"')),null===n&&(38===t.charCodeAt(r)?(n="&",r++):(n=null,l('"&"')),null===n&&(61===t.charCodeAt(r)?(n="=",r++):(n=null,l('"="')),null===n&&(43===t.charCodeAt(r)?(n="+",r++):(n=null,l('"+"')))))))))),null!==n)for(e=[];null!==n;)e.push(n),null===(n=v())&&null===(n=C())&&(36===t.charCodeAt(r)?(n="$",r++):(n=null,l('"$"')),null===n&&(44===t.charCodeAt(r)?(n=",",r++):(n=null,l('","')),null===n&&(59===t.charCodeAt(r)?(n=";",r++):(n=null,l('";"')),null===n&&(58===t.charCodeAt(r)?(n=":",r++):(n=null,l('":"')),null===n&&(64===t.charCodeAt(r)?(n="@",r++):(n=null,l('"@"')),null===n&&(38===t.charCodeAt(r)?(n="&",r++):(n=null,l('"&"')),null===n&&(61===t.charCodeAt(r)?(n="=",r++):(n=null,l('"="')),null===n&&(43===t.charCodeAt(r)?(n="+",r++):(n=null,l('"+"'))))))))));else e=null;return e}function Ye(){var e,t;for(e=[],t=He();null!==t;)e.push(t),t=He();return e}function Qe(){var e,n,s,i,o,a,c,h;if(c=r,h=r,"sip"===t.substr(r,3).toLowerCase()?(e=t.substr(r,3),r+=3):(e=null,l('"SIP"')),null!==e)if(47===t.charCodeAt(r)?(n="/",r++):(n=null,l('"/"')),null!==n){if(null!==(i=u()))for(s=[];null!==i;)s.push(i),i=u();else s=null;if(null!==s)if(46===t.charCodeAt(r)?(i=".",r++):(i=null,l('"."')),null!==i){if(null!==(a=u()))for(o=[];null!==a;)o.push(a),a=u();else o=null;null!==o?e=[e,n,s,i,o]:(e=null,r=h)}else e=null,r=h;else e=null,r=h}else e=null,r=h;else e=null,r=h;return null!==e&&(e=function(e){Fn.sip_version=t.substring(r,e)}(c)),null===e&&(r=c),e}function Ze(){var e;return"INVITE"===t.substr(r,6)?(e="INVITE",r+=6):(e=null,l('"INVITE"')),e}function et(){var e;return"ACK"===t.substr(r,3)?(e="ACK",r+=3):(e=null,l('"ACK"')),e}function tt(){var e;return"OPTIONS"===t.substr(r,7)?(e="OPTIONS",r+=7):(e=null,l('"OPTIONS"')),e}function nt(){var e;return"BYE"===t.substr(r,3)?(e="BYE",r+=3):(e=null,l('"BYE"')),e}function st(){var e;return"CANCEL"===t.substr(r,6)?(e="CANCEL",r+=6):(e=null,l('"CANCEL"')),e}function rt(){var e;return"REGISTER"===t.substr(r,8)?(e="REGISTER",r+=8):(e=null,l('"REGISTER"')),e}function it(){var e;return"SUBSCRIBE"===t.substr(r,9)?(e="SUBSCRIBE",r+=9):(e=null,l('"SUBSCRIBE"')),e}function ot(){var e;return"NOTIFY"===t.substr(r,6)?(e="NOTIFY",r+=6):(e=null,l('"NOTIFY"')),e}function lt(){var e;return"REFER"===t.substr(r,5)?(e="REFER",r+=5):(e=null,l('"REFER"')),e}function at(){var e,n;return n=r,null===(e=Ze())&&null===(e=et())&&null===(e=tt())&&null===(e=nt())&&null===(e=st())&&null===(e=rt())&&null===(e=it())&&null===(e=ot())&&null===(e=lt())&&(e=O()),null!==e&&(e=function(e){return Fn.method=t.substring(r,e),Fn.method}(n)),null===e&&(r=n),e}function ut(){var e,t,n,s,i,o;return o=r,null!==(e=Qe())&&null!==(t=p())&&null!==(n=ct())&&null!==(s=p())&&null!==(i=dt())?e=[e,t,n,s,i]:(e=null,r=o),e}function ct(){var e,t,n;return t=r,null!==(e=ht())&&(n=e,e=void(Fn.status_code=parseInt(n.join("")))),null===e&&(r=t),e}function ht(){var e,t,n,s;return s=r,null!==(e=u())&&null!==(t=u())&&null!==(n=u())?e=[e,t,n]:(e=null,r=s),e}function dt(){var e,n,s;for(s=r,e=[],null===(n=T())&&null===(n=v())&&null===(n=C())&&null===(n=w())&&null===(n=I())&&null===(n=p())&&(n=m());null!==n;)e.push(n),null===(n=T())&&null===(n=v())&&null===(n=C())&&null===(n=w())&&null===(n=I())&&null===(n=p())&&(n=m());return null!==e&&(e=function(e){Fn.reason_phrase=t.substring(r,e)}(s)),null===e&&(r=s),e}function ft(){var e,t,n,s,i,o,l;if(i=r,o=r,null===(e=J())&&(e=_t()),null!==e){for(t=[],l=r,null!==(n=q())&&null!==(s=mt())?n=[n,s]:(n=null,r=l);null!==n;)t.push(n),l=r,null!==(n=q())&&null!==(s=mt())?n=[n,s]:(n=null,r=l);null!==t?e=[e,t]:(e=null,r=o)}else e=null,r=o;return null!==e&&(e=function(e){var t;Fn.multi_header||(Fn.multi_header=[]);try{t=new $n(Fn.uri,Fn.display_name,Fn.params),delete Fn.uri,delete Fn.display_name,delete Fn.params}catch(e){t=null}Fn.multi_header.push({possition:r,offset:e,parsed:t})}(i)),null===e&&(r=i),e}function _t(){var e,t,n,s,i;return i=r,null!==(e=null!==(e=pt())?e:"")&&null!==(t=$())&&null!==(n=X())&&null!==(s=M())?e=[e,t,n,s]:(e=null,r=i),e}function pt(){var e,t,n,s,i,o,l,a;if(i=r,o=r,null!==(e=O())){for(t=[],l=r,null!==(n=S())&&null!==(s=O())?n=[n,s]:(n=null,r=l);null!==n;)t.push(n),l=r,null!==(n=S())&&null!==(s=O())?n=[n,s]:(n=null,r=l);null!==t?e=[e,t]:(e=null,r=o)}else e=null,r=o;return null===e&&(e=V()),null!==e&&(a=e,e=void(Fn.display_name="string"==typeof a?a:a[1].reduce((function(e,t){return e+t[0]+t[1]}),a[0]))),null===e&&(r=i),e}function mt(){var e;return null===(e=gt())&&null===(e=Tt())&&(e=Ct()),e}function gt(){var e,n,s,i,o,a;return i=r,o=r,"q"===t.substr(r,1).toLowerCase()?(e=t.substr(r,1),r++):(e=null,l('"q"')),null!==e&&null!==(n=L())&&null!==(s=Et())?e=[e,n,s]:(e=null,r=o),null!==e&&(a=e[2],Fn.params||(Fn.params={}),e=void(Fn.params.q=a)),null===e&&(r=i),e}function Tt(){var e,n,s,i,o,a;return i=r,o=r,"expires"===t.substr(r,7).toLowerCase()?(e=t.substr(r,7),r+=7):(e=null,l('"expires"')),null!==e&&null!==(n=L())&&null!==(s=vt())?e=[e,n,s]:(e=null,r=o),null!==e&&(a=e[2],Fn.params||(Fn.params={}),e=void(Fn.params.expires=a)),null===e&&(r=i),e}function vt(){var e,t,n;if(n=r,null!==(t=u()))for(e=[];null!==t;)e.push(t),t=u();else e=null;return null!==e&&(e=parseInt(e.join(""))),null===e&&(r=n),e}function Et(){var e,n,s,i,o,a,c,h;return a=r,c=r,48===t.charCodeAt(r)?(e="0",r++):(e=null,l('"0"')),null!==e?(h=r,46===t.charCodeAt(r)?(n=".",r++):(n=null,l('"."')),null!==n&&null!==(s=null!==(s=u())?s:"")&&null!==(i=null!==(i=u())?i:"")&&null!==(o=null!==(o=u())?o:"")?n=[n,s,i,o]:(n=null,r=h),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,r=c)):(e=null,r=c),null!==e&&(e=function(e){return parseFloat(t.substring(r,e))}(a)),null===e&&(r=a),e}function Ct(){var e,t,n,s,i,o,l,a;return s=r,i=r,null!==(e=O())?(o=r,null!==(t=L())&&null!==(n=St())?t=[t,n]:(t=null,r=o),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,r=i)):(e=null,r=i),null!==e&&(l=e[0],a=e[1],Fn.params||(Fn.params={}),a=void 0===a?void 0:a[1],e=void(Fn.params[l.toLowerCase()]=a)),null===e&&(r=s),e}function St(){var e;return null===(e=O())&&null===(e=ie())&&(e=G()),e}function At(){var e;return"render"===t.substr(r,6).toLowerCase()?(e=t.substr(r,6),r+=6):(e=null,l('"render"')),null===e&&("session"===t.substr(r,7).toLowerCase()?(e=t.substr(r,7),r+=7):(e=null,l('"session"')),null===e&&("icon"===t.substr(r,4).toLowerCase()?(e=t.substr(r,4),r+=4):(e=null,l('"icon"')),null===e&&("alert"===t.substr(r,5).toLowerCase()?(e=t.substr(r,5),r+=5):(e=null,l('"alert"')),null===e&&(e=O())))),e}function Rt(){var e;return null===(e=yt())&&(e=Ct()),e}function yt(){var e,n,s,i;return i=r,"handling"===t.substr(r,8).toLowerCase()?(e=t.substr(r,8),r+=8):(e=null,l('"handling"')),null!==e&&null!==(n=L())?("optional"===t.substr(r,8).toLowerCase()?(s=t.substr(r,8),r+=8):(s=null,l('"optional"')),null===s&&("required"===t.substr(r,8).toLowerCase()?(s=t.substr(r,8),r+=8):(s=null,l('"required"')),null===s&&(s=O())),null!==s?e=[e,n,s]:(e=null,r=i)):(e=null,r=i),e}function bt(){var e,t,n,s,i,o,l,a;if(l=r,null!==(e=wt()))if(null!==(t=x()))if(null!==(n=Pt())){for(s=[],a=r,null!==(i=q())&&null!==(o=xt())?i=[i,o]:(i=null,r=a);null!==i;)s.push(i),a=r,null!==(i=q())&&null!==(o=xt())?i=[i,o]:(i=null,r=a);null!==s?e=[e,t,n,s]:(e=null,r=l)}else e=null,r=l;else e=null,r=l;else e=null,r=l;return e}function wt(){var e;return null===(e=It())&&(e=Ot()),e}function It(){var e;return"text"===t.substr(r,4).toLowerCase()?(e=t.substr(r,4),r+=4):(e=null,l('"text"')),null===e&&("image"===t.substr(r,5).toLowerCase()?(e=t.substr(r,5),r+=5):(e=null,l('"image"')),null===e&&("audio"===t.substr(r,5).toLowerCase()?(e=t.substr(r,5),r+=5):(e=null,l('"audio"')),null===e&&("video"===t.substr(r,5).toLowerCase()?(e=t.substr(r,5),r+=5):(e=null,l('"video"')),null===e&&("application"===t.substr(r,11).toLowerCase()?(e=t.substr(r,11),r+=11):(e=null,l('"application"')),null===e&&(e=Nt()))))),e}function Ot(){var e;return"message"===t.substr(r,7).toLowerCase()?(e=t.substr(r,7),r+=7):(e=null,l('"message"')),null===e&&("multipart"===t.substr(r,9).toLowerCase()?(e=t.substr(r,9),r+=9):(e=null,l('"multipart"')),null===e&&(e=Nt())),e}function Nt(){var e;return null===(e=O())&&(e=Dt()),e}function Dt(){var e,n,s;return s=r,"x-"===t.substr(r,2).toLowerCase()?(e=t.substr(r,2),r+=2):(e=null,l('"x-"')),null!==e&&null!==(n=O())?e=[e,n]:(e=null,r=s),e}function Pt(){var e;return null===(e=Nt())&&(e=O()),e}function xt(){var e,t,n,s;return s=r,null!==(e=O())&&null!==(t=L())&&null!==(n=Lt())?e=[e,t,n]:(e=null,r=s),e}function Lt(){var e;return null===(e=O())&&(e=G()),e}function Ut(){var e,t,n,s;if(n=r,null!==(t=u()))for(e=[];null!==t;)e.push(t),t=u();else e=null;return null!==e&&(s=e,e=void(Fn.value=parseInt(s.join("")))),null===e&&(r=n),e}function kt(){var e,n,s,i,o,a;if(o=r,null!==(e=N())){for(n=[],a=r,46===t.charCodeAt(r)?(s=".",r++):(s=null,l('"."')),null!==s&&null!==(i=N())?s=[s,i]:(s=null,r=a);null!==s;)n.push(s),a=r,46===t.charCodeAt(r)?(s=".",r++):(s=null,l('"."')),null!==s&&null!==(i=N())?s=[s,i]:(s=null,r=a);null!==n?e=[e,n]:(e=null,r=o)}else e=null,r=o;return e}function Mt(){var e;return null===(e=$t())&&(e=Ct()),e}function $t(){var e,n,s,i,o,a;return i=r,o=r,"tag"===t.substr(r,3).toLowerCase()?(e=t.substr(r,3),r+=3):(e=null,l('"tag"')),null!==e&&null!==(n=L())&&null!==(s=O())?e=[e,n,s]:(e=null,r=o),null!==e&&(a=e[2],e=void(Fn.tag=a)),null===e&&(r=i),e}function Ft(){var e,n,s,i,o,a,u,c;if(u=r,"digest"===t.substr(r,6).toLowerCase()?(e=t.substr(r,6),r+=6):(e=null,l('"Digest"')),null!==e)if(null!==(n=S()))if(null!==(s=jt())){for(i=[],c=r,null!==(o=F())&&null!==(a=jt())?o=[o,a]:(o=null,r=c);null!==o;)i.push(o),c=r,null!==(o=F())&&null!==(a=jt())?o=[o,a]:(o=null,r=c);null!==i?e=[e,n,s,i]:(e=null,r=u)}else e=null,r=u;else e=null,r=u;else e=null,r=u;return null===e&&(e=qt()),e}function qt(){var e,t,n,s,i,o,l,a;if(l=r,null!==(e=O()))if(null!==(t=S()))if(null!==(n=Ht())){for(s=[],a=r,null!==(i=F())&&null!==(o=Ht())?i=[i,o]:(i=null,r=a);null!==i;)s.push(i),a=r,null!==(i=F())&&null!==(o=Ht())?i=[i,o]:(i=null,r=a);null!==s?e=[e,t,n,s]:(e=null,r=l)}else e=null,r=l;else e=null,r=l;else e=null,r=l;return e}function Ht(){var e,t,n,s;return s=r,null!==(e=O())&&null!==(t=L())?(null===(n=O())&&(n=G()),null!==n?e=[e,t,n]:(e=null,r=s)):(e=null,r=s),e}function jt(){var e;return null===(e=Bt())&&null===(e=Gt())&&null===(e=Kt())&&null===(e=Jt())&&null===(e=Xt())&&null===(e=Yt())&&null===(e=Qt())&&(e=Ht()),e}function Bt(){var e,n,s,i;return i=r,"realm"===t.substr(r,5).toLowerCase()?(e=t.substr(r,5),r+=5):(e=null,l('"realm"')),null!==e&&null!==(n=L())&&null!==(s=Wt())?e=[e,n,s]:(e=null,r=i),e}function Wt(){var e,t,n;return t=r,null!==(e=V())&&(n=e,e=void(Fn.realm=n)),null===e&&(r=t),e}function Gt(){var e,n,s,i,o,a,u,c,h;if(c=r,"domain"===t.substr(r,6).toLowerCase()?(e=t.substr(r,6),r+=6):(e=null,l('"domain"')),null!==e)if(null!==(n=L()))if(null!==(s=j()))if(null!==(i=Vt())){if(o=[],h=r,null!==(u=p()))for(a=[];null!==u;)a.push(u),u=p();else a=null;for(null!==a&&null!==(u=Vt())?a=[a,u]:(a=null,r=h);null!==a;){if(o.push(a),h=r,null!==(u=p()))for(a=[];null!==u;)a.push(u),u=p();else a=null;null!==a&&null!==(u=Vt())?a=[a,u]:(a=null,r=h)}null!==o&&null!==(a=B())?e=[e,n,s,i,o,a]:(e=null,r=c)}else e=null,r=c;else e=null,r=c;else e=null,r=c;else e=null,r=c;return e}function Vt(){var e;return null===(e=ke())&&(e=Fe()),e}function Kt(){var e,n,s,i;return i=r,"nonce"===t.substr(r,5).toLowerCase()?(e=t.substr(r,5),r+=5):(e=null,l('"nonce"')),null!==e&&null!==(n=L())&&null!==(s=zt())?e=[e,n,s]:(e=null,r=i),e}function zt(){var e,t,n;return t=r,null!==(e=V())&&(n=e,e=void(Fn.nonce=n)),null===e&&(r=t),e}function Jt(){var e,n,s,i,o,a;return i=r,o=r,"opaque"===t.substr(r,6).toLowerCase()?(e=t.substr(r,6),r+=6):(e=null,l('"opaque"')),null!==e&&null!==(n=L())&&null!==(s=V())?e=[e,n,s]:(e=null,r=o),null!==e&&(a=e[2],e=void(Fn.opaque=a)),null===e&&(r=i),e}function Xt(){var e,n,s,i,o;return i=r,"stale"===t.substr(r,5).toLowerCase()?(e=t.substr(r,5),r+=5):(e=null,l('"stale"')),null!==e&&null!==(n=L())?(o=r,"true"===t.substr(r,4).toLowerCase()?(s=t.substr(r,4),r+=4):(s=null,l('"true"')),null!==s&&(s=void(Fn.stale=!0)),null===s&&(r=o),null===s&&(o=r,"false"===t.substr(r,5).toLowerCase()?(s=t.substr(r,5),r+=5):(s=null,l('"false"')),null!==s&&(s=void(Fn.stale=!1)),null===s&&(r=o)),null!==s?e=[e,n,s]:(e=null,r=i)):(e=null,r=i),e}function Yt(){var e,n,s,i,o,a;return i=r,o=r,"algorithm"===t.substr(r,9).toLowerCase()?(e=t.substr(r,9),r+=9):(e=null,l('"algorithm"')),null!==e&&null!==(n=L())?("md5"===t.substr(r,3).toLowerCase()?(s=t.substr(r,3),r+=3):(s=null,l('"MD5"')),null===s&&("md5-sess"===t.substr(r,8).toLowerCase()?(s=t.substr(r,8),r+=8):(s=null,l('"MD5-sess"')),null===s&&(s=O())),null!==s?e=[e,n,s]:(e=null,r=o)):(e=null,r=o),null!==e&&(a=e[2],e=void(Fn.algorithm=a.toUpperCase())),null===e&&(r=i),e}function Qt(){var e,n,s,i,o,a,u,c,h,d;if(c=r,"qop"===t.substr(r,3).toLowerCase()?(e=t.substr(r,3),r+=3):(e=null,l('"qop"')),null!==e)if(null!==(n=L()))if(null!==(s=j())){if(h=r,null!==(i=Zt())){for(o=[],d=r,44===t.charCodeAt(r)?(a=",",r++):(a=null,l('","')),null!==a&&null!==(u=Zt())?a=[a,u]:(a=null,r=d);null!==a;)o.push(a),d=r,44===t.charCodeAt(r)?(a=",",r++):(a=null,l('","')),null!==a&&null!==(u=Zt())?a=[a,u]:(a=null,r=d);null!==o?i=[i,o]:(i=null,r=h)}else i=null,r=h;null!==i&&null!==(o=B())?e=[e,n,s,i,o]:(e=null,r=c)}else e=null,r=c;else e=null,r=c;else e=null,r=c;return e}function Zt(){var e,n,s;return n=r,"auth-int"===t.substr(r,8).toLowerCase()?(e=t.substr(r,8),r+=8):(e=null,l('"auth-int"')),null===e&&("auth"===t.substr(r,4).toLowerCase()?(e=t.substr(r,4),r+=4):(e=null,l('"auth"')),null===e&&(e=O())),null!==e&&(s=e,Fn.qop||(Fn.qop=[]),e=void Fn.qop.push(s.toLowerCase())),null===e&&(r=n),e}function en(){var e,t,n,s,i,o,l;if(i=r,o=r,null!==(e=_t())){for(t=[],l=r,null!==(n=q())&&null!==(s=Ct())?n=[n,s]:(n=null,r=l);null!==n;)t.push(n),l=r,null!==(n=q())&&null!==(s=Ct())?n=[n,s]:(n=null,r=l);null!==t?e=[e,t]:(e=null,r=o)}else e=null,r=o;return null!==e&&(e=function(e){var t;Fn.multi_header||(Fn.multi_header=[]);try{t=new $n(Fn.uri,Fn.display_name,Fn.params),delete Fn.uri,delete Fn.display_name,delete Fn.params}catch(e){t=null}Fn.multi_header.push({possition:r,offset:e,parsed:t})}(i)),null===e&&(r=i),e}function tn(){var e;return null===(e=nn())&&(e=Ct()),e}function nn(){var e,n,s,i,o,a,c;if(o=r,a=r,"cause"===t.substr(r,5).toLowerCase()?(e=t.substr(r,5),r+=5):(e=null,l('"cause"')),null!==e)if(null!==(n=L())){if(null!==(i=u()))for(s=[];null!==i;)s.push(i),i=u();else s=null;null!==s?e=[e,n,s]:(e=null,r=a)}else e=null,r=a;else e=null,r=a;return null!==e&&(c=e[2],e=void(Fn.cause=parseInt(c.join("")))),null===e&&(r=o),e}function sn(){var e,t,n,s,i,o;if(i=r,null!==(e=_t())){for(t=[],o=r,null!==(n=q())&&null!==(s=Ct())?n=[n,s]:(n=null,r=o);null!==n;)t.push(n),o=r,null!==(n=q())&&null!==(s=Ct())?n=[n,s]:(n=null,r=o);null!==t?e=[e,t]:(e=null,r=i)}else e=null,r=i;return e}function rn(){var e,n;return n=r,"active"===t.substr(r,6).toLowerCase()?(e=t.substr(r,6),r+=6):(e=null,l('"active"')),null===e&&("pending"===t.substr(r,7).toLowerCase()?(e=t.substr(r,7),r+=7):(e=null,l('"pending"')),null===e&&("terminated"===t.substr(r,10).toLowerCase()?(e=t.substr(r,10),r+=10):(e=null,l('"terminated"')),null===e&&(e=O()))),null!==e&&(e=function(e){Fn.state=t.substring(r,e)}(n)),null===e&&(r=n),e}function on(){var e,n,s,i,o,a,u,c;return i=r,o=r,"reason"===t.substr(r,6).toLowerCase()?(e=t.substr(r,6),r+=6):(e=null,l('"reason"')),null!==e&&null!==(n=L())&&null!==(s=ln())?e=[e,n,s]:(e=null,r=o),null!==e&&(e=void(void 0!==(a=e[2])&&(Fn.reason=a))),null===e&&(r=i),null===e&&(i=r,o=r,"expires"===t.substr(r,7).toLowerCase()?(e=t.substr(r,7),r+=7):(e=null,l('"expires"')),null!==e&&null!==(n=L())&&null!==(s=vt())?e=[e,n,s]:(e=null,r=o),null!==e&&(e=void(void 0!==(c=e[2])&&(Fn.expires=c))),null===e&&(r=i),null===e&&(i=r,o=r,"retry_after"===t.substr(r,11).toLowerCase()?(e=t.substr(r,11),r+=11):(e=null,l('"retry_after"')),null!==e&&null!==(n=L())&&null!==(s=vt())?e=[e,n,s]:(e=null,r=o),null!==e&&(e=void(void 0!==(u=e[2])&&(Fn.retry_after=u))),null===e&&(r=i),null===e&&(e=Ct()))),e}function ln(){var e;return"deactivated"===t.substr(r,11).toLowerCase()?(e=t.substr(r,11),r+=11):(e=null,l('"deactivated"')),null===e&&("probation"===t.substr(r,9).toLowerCase()?(e=t.substr(r,9),r+=9):(e=null,l('"probation"')),null===e&&("rejected"===t.substr(r,8).toLowerCase()?(e=t.substr(r,8),r+=8):(e=null,l('"rejected"')),null===e&&("timeout"===t.substr(r,7).toLowerCase()?(e=t.substr(r,7),r+=7):(e=null,l('"timeout"')),null===e&&("giveup"===t.substr(r,6).toLowerCase()?(e=t.substr(r,6),r+=6):(e=null,l('"giveup"')),null===e&&("noresource"===t.substr(r,10).toLowerCase()?(e=t.substr(r,10),r+=10):(e=null,l('"noresource"')),null===e&&("invariant"===t.substr(r,9).toLowerCase()?(e=t.substr(r,9),r+=9):(e=null,l('"invariant"')),null===e&&(e=O()))))))),e}function an(){var e;return null===(e=$t())&&(e=Ct()),e}function un(){var e,t,n,s,i,o,l,a;if(l=r,null!==(e=gn()))if(null!==(t=S()))if(null!==(n=En())){for(s=[],a=r,null!==(i=q())&&null!==(o=cn())?i=[i,o]:(i=null,r=a);null!==i;)s.push(i),a=r,null!==(i=q())&&null!==(o=cn())?i=[i,o]:(i=null,r=a);null!==s?e=[e,t,n,s]:(e=null,r=l)}else e=null,r=l;else e=null,r=l;else e=null,r=l;return e}function cn(){var e;return null===(e=hn())&&null===(e=dn())&&null===(e=fn())&&null===(e=_n())&&null===(e=pn())&&(e=Ct()),e}function hn(){var e,n,s,i,o,a;return i=r,o=r,"ttl"===t.substr(r,3).toLowerCase()?(e=t.substr(r,3),r+=3):(e=null,l('"ttl"')),null!==e&&null!==(n=L())&&null!==(s=An())?e=[e,n,s]:(e=null,r=o),null!==e&&(a=e[2],e=void(Fn.ttl=a)),null===e&&(r=i),e}function dn(){var e,n,s,i,o,a;return i=r,o=r,"maddr"===t.substr(r,5).toLowerCase()?(e=t.substr(r,5),r+=5):(e=null,l('"maddr"')),null!==e&&null!==(n=L())&&null!==(s=ie())?e=[e,n,s]:(e=null,r=o),null!==e&&(a=e[2],e=void(Fn.maddr=a)),null===e&&(r=i),e}function fn(){var e,n,s,i,o,a;return i=r,o=r,"received"===t.substr(r,8).toLowerCase()?(e=t.substr(r,8),r+=8):(e=null,l('"received"')),null!==e&&null!==(n=L())?(null===(s=fe())&&(s=ce()),null!==s?e=[e,n,s]:(e=null,r=o)):(e=null,r=o),null!==e&&(a=e[2],e=void(Fn.received=a)),null===e&&(r=i),e}function _n(){var e,n,s,i,o,a;return i=r,o=r,"branch"===t.substr(r,6).toLowerCase()?(e=t.substr(r,6),r+=6):(e=null,l('"branch"')),null!==e&&null!==(n=L())&&null!==(s=O())?e=[e,n,s]:(e=null,r=o),null!==e&&(a=e[2],e=void(Fn.branch=a)),null===e&&(r=i),e}function pn(){var e,n,s,i,o;return i=r,"rport"===t.substr(r,5).toLowerCase()?(e=t.substr(r,5),r+=5):(e=null,l('"rport"')),null!==e?(o=r,null!==(n=L())&&null!==(s=mn())?n=[n,s]:(n=null,r=o),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,r=i)):(e=null,r=i),e}function mn(){var e,t,n,s,i,o,l,a;return o=r,l=r,null!==(e=null!==(e=u())?e:"")&&null!==(t=null!==(t=u())?t:"")&&null!==(n=null!==(n=u())?n:"")&&null!==(s=null!==(s=u())?s:"")&&null!==(i=null!==(i=u())?i:"")?e=[e,t,n,s,i]:(e=null,r=l),null!==e&&(a=e,e=void(Fn.rport=parseInt(a.join("")))),null===e&&(r=o),e}function gn(){var e,t,n,s,i,o;return o=r,null!==(e=Tn())&&null!==(t=x())&&null!==(n=O())&&null!==(s=x())&&null!==(i=vn())?e=[e,t,n,s,i]:(e=null,r=o),e}function Tn(){var e,n,s;return n=r,"sip"===t.substr(r,3).toLowerCase()?(e=t.substr(r,3),r+=3):(e=null,l('"SIP"')),null===e&&(e=O()),null!==e&&(s=e,e=void(Fn.protocol=s)),null===e&&(r=n),e}function vn(){var e,n,s;return n=r,"udp"===t.substr(r,3).toLowerCase()?(e=t.substr(r,3),r+=3):(e=null,l('"UDP"')),null===e&&("tcp"===t.substr(r,3).toLowerCase()?(e=t.substr(r,3),r+=3):(e=null,l('"TCP"')),null===e&&("tls"===t.substr(r,3).toLowerCase()?(e=t.substr(r,3),r+=3):(e=null,l('"TLS"')),null===e&&("sctp"===t.substr(r,4).toLowerCase()?(e=t.substr(r,4),r+=4):(e=null,l('"SCTP"')),null===e&&(e=O())))),null!==e&&(s=e,e=void(Fn.transport=s)),null===e&&(r=n),e}function En(){var e,t,n,s,i;return s=r,null!==(e=Cn())?(i=r,null!==(t=H())&&null!==(n=Sn())?t=[t,n]:(t=null,r=i),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,r=s)):(e=null,r=s),e}function Cn(){var e,n;return n=r,null===(e=fe())&&null===(e=ue())&&(e=oe()),null!==e&&(e=function(e){Fn.host=t.substring(r,e)}(n)),null===e&&(r=n),e}function Sn(){var e,t,n,s,i,o,l,a;return o=r,l=r,null!==(e=null!==(e=u())?e:"")&&null!==(t=null!==(t=u())?t:"")&&null!==(n=null!==(n=u())?n:"")&&null!==(s=null!==(s=u())?s:"")&&null!==(i=null!==(i=u())?i:"")?e=[e,t,n,s,i]:(e=null,r=l),null!==e&&(a=e,e=void(Fn.port=parseInt(a.join("")))),null===e&&(r=o),e}function An(){var e,t,n,s,i;return s=r,i=r,null!==(e=u())&&null!==(t=null!==(t=u())?t:"")&&null!==(n=null!==(n=u())?n:"")?e=[e,t,n]:(e=null,r=i),null!==e&&(e=parseInt(e.join(""))),null===e&&(r=s),e}function Rn(){var e,t,n;return t=r,null!==(e=vt())&&(n=e,e=void(Fn.expires=n)),null===e&&(r=t),e}function yn(){var e;return null===(e=bn())&&(e=Ct()),e}function bn(){var e,n,s,i,o,a;return i=r,o=r,"refresher"===t.substr(r,9).toLowerCase()?(e=t.substr(r,9),r+=9):(e=null,l('"refresher"')),null!==e&&null!==(n=L())?("uac"===t.substr(r,3).toLowerCase()?(s=t.substr(r,3),r+=3):(s=null,l('"uac"')),null===s&&("uas"===t.substr(r,3).toLowerCase()?(s=t.substr(r,3),r+=3):(s=null,l('"uas"'))),null!==s?e=[e,n,s]:(e=null,r=o)):(e=null,r=o),null!==e&&(a=e[2],e=void(Fn.refresher=a.toLowerCase())),null===e&&(r=i),e}function wn(){var e,t;for(e=[],null===(t=b())&&null===(t=I())&&(t=S());null!==t;)e.push(t),null===(t=b())&&null===(t=I())&&(t=S());return e}function In(){var e,n,s,i,o,a,u,c,h,d,f;return d=r,f=r,null!==(e=Nn())?(45===t.charCodeAt(r)?(n="-",r++):(n=null,l('"-"')),null!==n&&null!==(s=On())?(45===t.charCodeAt(r)?(i="-",r++):(i=null,l('"-"')),null!==i&&null!==(o=On())?(45===t.charCodeAt(r)?(a="-",r++):(a=null,l('"-"')),null!==a&&null!==(u=On())?(45===t.charCodeAt(r)?(c="-",r++):(c=null,l('"-"')),null!==c&&null!==(h=Dn())?e=[e,n,s,i,o,a,u,c,h]:(e=null,r=f)):(e=null,r=f)):(e=null,r=f)):(e=null,r=f)):(e=null,r=f),null!==e&&(e=function(e,n){Fn=t.substring(r+5,e)}(d,e[0])),null===e&&(r=d),e}function On(){var e,t,n,s,i;return i=r,null!==(e=h())&&null!==(t=h())&&null!==(n=h())&&null!==(s=h())?e=[e,t,n,s]:(e=null,r=i),e}function Nn(){var e,t,n;return n=r,null!==(e=On())&&null!==(t=On())?e=[e,t]:(e=null,r=n),e}function Dn(){var e,t,n,s;return s=r,null!==(e=On())&&null!==(t=On())&&null!==(n=On())?e=[e,t,n]:(e=null,r=s),e}function Pn(){var e,n,s,i,o,a;return i=r,o=r,null!==(e=D())?(a=r,64===t.charCodeAt(r)?(n="@",r++):(n=null,l('"@"')),null!==n&&null!==(s=D())?n=[n,s]:(n=null,r=a),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,r=o)):(e=null,r=o),null!==e&&(e=function(e){Fn.call_id=t.substring(r,e)}(i)),null===e&&(r=i),e}function xn(){var e;return null===(e=Ln())&&null===(e=Un())&&null===(e=kn())&&(e=Ct()),e}function Ln(){var e,n,s,i,o,a;return i=r,o=r,"to-tag"===t.substr(r,6)?(e="to-tag",r+=6):(e=null,l('"to-tag"')),null!==e&&null!==(n=L())&&null!==(s=O())?e=[e,n,s]:(e=null,r=o),null!==e&&(a=e[2],e=void(Fn.to_tag=a)),null===e&&(r=i),e}function Un(){var e,n,s,i,o,a;return i=r,o=r,"from-tag"===t.substr(r,8)?(e="from-tag",r+=8):(e=null,l('"from-tag"')),null!==e&&null!==(n=L())&&null!==(s=O())?e=[e,n,s]:(e=null,r=o),null!==e&&(a=e[2],e=void(Fn.from_tag=a)),null===e&&(r=i),e}function kn(){var e,n;return n=r,"early-only"===t.substr(r,10)?(e="early-only",r+=10):(e=null,l('"early-only"')),null!==e&&(e=void(Fn.early_only=!0)),null===e&&(r=n),e}var Mn=Sr(),$n=Er(),Fn={};if(null===s[n]()||r!==t.length){var qn=Math.max(r,i),Hn=qn<t.length?t.charAt(qn):null,jn=function(){for(var e=1,n=1,s=!1,o=0;o<Math.max(r,i);o++){var l=t.charAt(o);"\n"===l?(s||e++,n=1,s=!1):"\r"===l||"\u2028"===l||"\u2029"===l?(e++,n=1,s=!0):(n++,s=!1)}return{line:e,column:n}}();return new this.SyntaxError(function(e){e.sort();for(var t=null,n=[],s=0;s<e.length;s++)e[s]!==t&&(n.push(e[s]),t=e[s]);return n}(o),Hn,qn,jn.line,jn.column),-1}return Fn},toSource:function(){return this._source},SyntaxError:function(t,n,s,r,i){this.name="SyntaxError",this.expected=t,this.found=n,this.message=function(t,n){var s;switch(t.length){case 0:s="end of input";break;case 1:s=t[0];break;default:s=t.slice(0,t.length-1).join(", ")+" or "+t[t.length-1]}return"Expected "+s+" but "+(n?e(n):"end of input")+" found."}(t,n),this.offset=s,this.line=r,this.column=i}};return t.SyntaxError.prototype=Error.prototype,t}()),fr}function Sr(){if(mr)return pr;mr=1;const e=or,t=Ar(),n=Cr();return pr=class s{static parse(e){return-1!==(e=n.parse(e,"SIP_URI"))?e:void 0}constructor(t,n,s,r,i={},o={}){if(!s)throw new TypeError('missing or invalid "host" parameter');this._parameters={},this._headers={},this._scheme=t||e.SIP,this._user=n,this._host=s,this._port=r;for(const e in i)Object.prototype.hasOwnProperty.call(i,e)&&this.setParam(e,i[e]);for(const e in o)Object.prototype.hasOwnProperty.call(o,e)&&this.setHeader(e,o[e])}get scheme(){return this._scheme}set scheme(e){this._scheme=e.toLowerCase()}get user(){return this._user}set user(e){this._user=e}get host(){return this._host}set host(e){this._host=e.toLowerCase()}get port(){return this._port}set port(e){this._port=0===e?e:parseInt(e,10)||null}setParam(e,t){e&&(this._parameters[e.toLowerCase()]=null==t?null:t.toString())}getParam(e){if(e)return this._parameters[e.toLowerCase()]}hasParam(e){if(e)return!!this._parameters.hasOwnProperty(e.toLowerCase())}deleteParam(e){if(e=e.toLowerCase(),this._parameters.hasOwnProperty(e)){const t=this._parameters[e];return delete this._parameters[e],t}}clearParams(){this._parameters={}}setHeader(e,n){this._headers[t.headerize(e)]=Array.isArray(n)?n:[n]}getHeader(e){if(e)return this._headers[t.headerize(e)]}hasHeader(e){if(e)return!!this._headers.hasOwnProperty(t.headerize(e))}deleteHeader(e){if(e=t.headerize(e),this._headers.hasOwnProperty(e)){const t=this._headers[e];return delete this._headers[e],t}}clearHeaders(){this._headers={}}clone(){return new s(this._scheme,this._user,this._host,this._port,JSON.parse(JSON.stringify(this._parameters)),JSON.parse(JSON.stringify(this._headers)))}toString(){const e=[];let n=`${this._scheme}:`;this._user&&(n+=`${t.escapeUser(this._user)}@`),n+=this._host,(this._port||0===this._port)&&(n+=`:${this._port}`);for(const e in this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,e)&&(n+=`;${e}`,null!==this._parameters[e]&&(n+=`=${this._parameters[e]}`));for(const t in this._headers)if(Object.prototype.hasOwnProperty.call(this._headers,t))for(const n of this._headers[t])e.push(`${t}=${n}`);return e.length>0&&(n+=`?${e.join("&")}`),n}toAor(e){let n=`${this._scheme}:`;return this._user&&(n+=`${t.escapeUser(this._user)}@`),n+=this._host,e&&(this._port||0===this._port)&&(n+=`:${this._port}`),n}},pr}function Ar(){if(gr)return vr;gr=1;const e=or,t=Sr(),n=Cr();vr.str_utf8_length=e=>unescape(encodeURIComponent(e)).length;const s=vr.isFunction=e=>void 0!==e&&"[object Function]"===Object.prototype.toString.call(e);vr.isString=e=>void 0!==e&&"[object String]"===Object.prototype.toString.call(e),vr.isDecimal=e=>!isNaN(e)&&parseFloat(e)===parseInt(e,10),vr.isEmpty=e=>null===e||""===e||void 0===e||Array.isArray(e)&&0===e.length||"number"==typeof e&&isNaN(e),vr.hasMethods=function(e,...t){for(const n of t)if(s(e[n]))return!1;return!0};const r=vr.createRandomToken=(e,t=32)=>{let n,s,r="";for(n=0;n<e;n++)s=Math.random()*t|0,r+=s.toString(t);return r};vr.newTag=()=>r(10),vr.newUUID=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),vr.hostType=e=>{if(e)return-1!==(e=n.parse(e,"host"))?e.host_type:void 0};const i=vr.escapeUser=e=>encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/");return vr.normalizeTarget=(n,s)=>{if(n){if(n instanceof t)return n;if("string"==typeof n){const r=n.split("@");let o,l,a;switch(r.length){case 1:if(!s)return;o=n,l=s;break;case 2:o=r[0],l=r[1];break;default:o=r.slice(0,r.length-1).join("@"),l=r[r.length-1]}return o=o.replace(/^(sips?|tel):/i,""),/^[-.()]*\+?[0-9\-.()]+$/.test(o)&&(o=o.replace(/[-.()]/g,"")),n=`${e.SIP}:${i(o)}@${l}`,(a=t.parse(n))?a:void 0}}else;},vr.headerize=e=>{const t={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},n=e.toLowerCase().replace(/_/g,"-").split("-");let s="";const r=n.length;let i;for(i=0;i<r;i++)0!==i&&(s+="-"),s+=n[i].charAt(0).toUpperCase()+n[i].substring(1);return t[s]&&(s=t[s]),s},vr.sipErrorCause=t=>{for(const n in e.SIP_ERROR_CAUSES)if(-1!==e.SIP_ERROR_CAUSES[n].indexOf(t))return e.causes[n];return e.causes.SIP_FAILURE_CODE},vr.getRandomTestNetIP=()=>{return`192.0.2.${e=1,t=254,Math.floor(Math.random()*(t-e+1)+e)}`;var e,t},vr.calculateMD5=e=>{function t(e,t){return e<<t|e>>>32-t}function n(e,t){const n=2147483648&e,s=2147483648&t,r=1073741824&e,i=1073741824&t,o=(1073741823&e)+(1073741823&t);return r&i?2147483648^o^n^s:r|i?1073741824&o?3221225472^o^n^s:1073741824^o^n^s:o^n^s}function s(e,s,r,i,o,l,a){return e=n(e,n(n(function(e,t,n){return e&t|~e&n}(s,r,i),o),a)),n(t(e,l),s)}function r(e,s,r,i,o,l,a){return e=n(e,n(n(function(e,t,n){return e&n|t&~n}(s,r,i),o),a)),n(t(e,l),s)}function i(e,s,r,i,o,l,a){return e=n(e,n(n(function(e,t,n){return e^t^n}(s,r,i),o),a)),n(t(e,l),s)}function o(e,s,r,i,o,l,a){return e=n(e,n(n(function(e,t,n){return t^(e|~n)}(s,r,i),o),a)),n(t(e,l),s)}function l(e){let t,n,s="",r="";for(n=0;n<=3;n++)t=e>>>8*n&255,r=`0${t.toString(16)}`,s+=r.substr(r.length-2,2);return s}let a,u,c,h,d,f,_,p,m,g=[];for(e=function(e){e=e.replace(/\r\n/g,"\n");let t="";for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);s<128?t+=String.fromCharCode(s):s>127&&s<2048?(t+=String.fromCharCode(s>>6|192),t+=String.fromCharCode(63&s|128)):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128),t+=String.fromCharCode(63&s|128))}return t}(e),g=function(e){let t;const n=e.length,s=n+8,r=16*((s-s%64)/64+1),i=new Array(r-1);let o=0,l=0;for(;l<n;)t=(l-l%4)/4,o=l%4*8,i[t]=i[t]|e.charCodeAt(l)<<o,l++;return t=(l-l%4)/4,o=l%4*8,i[t]=i[t]|128<<o,i[r-2]=n<<3,i[r-1]=n>>>29,i}(e),f=1732584193,_=4023233417,p=2562383102,m=271733878,a=0;a<g.length;a+=16)u=f,c=_,h=p,d=m,f=s(f,_,p,m,g[a+0],7,3614090360),m=s(m,f,_,p,g[a+1],12,3905402710),p=s(p,m,f,_,g[a+2],17,606105819),_=s(_,p,m,f,g[a+3],22,3250441966),f=s(f,_,p,m,g[a+4],7,4118548399),m=s(m,f,_,p,g[a+5],12,1200080426),p=s(p,m,f,_,g[a+6],17,2821735955),_=s(_,p,m,f,g[a+7],22,4249261313),f=s(f,_,p,m,g[a+8],7,1770035416),m=s(m,f,_,p,g[a+9],12,2336552879),p=s(p,m,f,_,g[a+10],17,4294925233),_=s(_,p,m,f,g[a+11],22,2304563134),f=s(f,_,p,m,g[a+12],7,1804603682),m=s(m,f,_,p,g[a+13],12,4254626195),p=s(p,m,f,_,g[a+14],17,2792965006),_=s(_,p,m,f,g[a+15],22,1236535329),f=r(f,_,p,m,g[a+1],5,4129170786),m=r(m,f,_,p,g[a+6],9,3225465664),p=r(p,m,f,_,g[a+11],14,643717713),_=r(_,p,m,f,g[a+0],20,3921069994),f=r(f,_,p,m,g[a+5],5,3593408605),m=r(m,f,_,p,g[a+10],9,38016083),p=r(p,m,f,_,g[a+15],14,3634488961),_=r(_,p,m,f,g[a+4],20,3889429448),f=r(f,_,p,m,g[a+9],5,568446438),m=r(m,f,_,p,g[a+14],9,3275163606),p=r(p,m,f,_,g[a+3],14,4107603335),_=r(_,p,m,f,g[a+8],20,1163531501),f=r(f,_,p,m,g[a+13],5,2850285829),m=r(m,f,_,p,g[a+2],9,4243563512),p=r(p,m,f,_,g[a+7],14,1735328473),_=r(_,p,m,f,g[a+12],20,2368359562),f=i(f,_,p,m,g[a+5],4,4294588738),m=i(m,f,_,p,g[a+8],11,2272392833),p=i(p,m,f,_,g[a+11],16,1839030562),_=i(_,p,m,f,g[a+14],23,4259657740),f=i(f,_,p,m,g[a+1],4,2763975236),m=i(m,f,_,p,g[a+4],11,1272893353),p=i(p,m,f,_,g[a+7],16,4139469664),_=i(_,p,m,f,g[a+10],23,3200236656),f=i(f,_,p,m,g[a+13],4,681279174),m=i(m,f,_,p,g[a+0],11,3936430074),p=i(p,m,f,_,g[a+3],16,3572445317),_=i(_,p,m,f,g[a+6],23,76029189),f=i(f,_,p,m,g[a+9],4,3654602809),m=i(m,f,_,p,g[a+12],11,3873151461),p=i(p,m,f,_,g[a+15],16,530742520),_=i(_,p,m,f,g[a+2],23,3299628645),f=o(f,_,p,m,g[a+0],6,4096336452),m=o(m,f,_,p,g[a+7],10,1126891415),p=o(p,m,f,_,g[a+14],15,2878612391),_=o(_,p,m,f,g[a+5],21,4237533241),f=o(f,_,p,m,g[a+12],6,1700485571),m=o(m,f,_,p,g[a+3],10,2399980690),p=o(p,m,f,_,g[a+10],15,4293915773),_=o(_,p,m,f,g[a+1],21,2240044497),f=o(f,_,p,m,g[a+8],6,1873313359),m=o(m,f,_,p,g[a+15],10,4264355552),p=o(p,m,f,_,g[a+6],15,2734768916),_=o(_,p,m,f,g[a+13],21,1309151649),f=o(f,_,p,m,g[a+4],6,4149444226),m=o(m,f,_,p,g[a+11],10,3174756917),p=o(p,m,f,_,g[a+2],15,718787259),_=o(_,p,m,f,g[a+9],21,3951481745),f=n(f,u),_=n(_,c),p=n(p,h),m=n(m,d);return(l(f)+l(_)+l(p)+l(m)).toLowerCase()},vr.closeMediaStream=e=>{if(e)try{let t;if(e.getTracks){t=e.getTracks();for(const e of t)e.stop()}else{t=e.getAudioTracks();for(const e of t)e.stop();t=e.getVideoTracks();for(const e of t)e.stop()}}catch(t){"function"!=typeof e.stop&&"object"!=typeof e.stop||e.stop()}},vr.cloneArray=e=>e&&e.slice()||[],vr.cloneObject=(e,t={})=>e&&Object.assign({},e)||t,vr}function Rr(){}function yr(){yr.init.call(this)}function br(e){return void 0===e._maxListeners?yr.defaultMaxListeners:e._maxListeners}function wr(e,t,n,s){var r,i,o,l;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((i=e._events)?(i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),o=i[t]):(i=e._events=new Rr,e._eventsCount=0),o){if("function"==typeof o?o=i[t]=s?[n,o]:[o,n]:s?o.unshift(n):o.push(n),!o.warned&&(r=br(e))&&r>0&&o.length>r){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,l=a,"function"==typeof console.warn?console.warn(l):console.log(l)}}else o=i[t]=n,++e._eventsCount;return e}function Ir(e,t,n){var s=!1;function r(){e.removeListener(t,r),s||(s=!0,n.apply(e,arguments))}return r.listener=n,r}function Or(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function Nr(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}Rr.prototype=Object.create(null),yr.EventEmitter=yr,yr.usingDomains=!1,yr.prototype.domain=void 0,yr.prototype._events=void 0,yr.prototype._maxListeners=void 0,yr.defaultMaxListeners=10,yr.init=function(){this.domain=null,yr.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Rr,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},yr.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},yr.prototype.getMaxListeners=function(){return br(this)},yr.prototype.emit=function(e){var t,n,s,r,i,o,l,a="error"===e;if(o=this._events)a=a&&null==o.error;else if(!a)return!1;if(l=this.domain,a){if(t=arguments[1],!l){if(t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=l,t.domainThrown=!1,l.emit("error",t),!1}if(!(n=o[e]))return!1;var c="function"==typeof n;switch(s=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var s=e.length,r=Nr(e,s),i=0;i<s;++i)r[i].call(n)}(n,c,this);break;case 2:!function(e,t,n,s){if(t)e.call(n,s);else for(var r=e.length,i=Nr(e,r),o=0;o<r;++o)i[o].call(n,s)}(n,c,this,arguments[1]);break;case 3:!function(e,t,n,s,r){if(t)e.call(n,s,r);else for(var i=e.length,o=Nr(e,i),l=0;l<i;++l)o[l].call(n,s,r)}(n,c,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,s,r,i){if(t)e.call(n,s,r,i);else for(var o=e.length,l=Nr(e,o),a=0;a<o;++a)l[a].call(n,s,r,i)}(n,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(s-1),i=1;i<s;i++)r[i-1]=arguments[i];!function(e,t,n,s){if(t)e.apply(n,s);else for(var r=e.length,i=Nr(e,r),o=0;o<r;++o)i[o].apply(n,s)}(n,c,this,r)}return!0},yr.prototype.addListener=function(e,t){return wr(this,e,t,!1)},yr.prototype.on=yr.prototype.addListener,yr.prototype.prependListener=function(e,t){return wr(this,e,t,!0)},yr.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Ir(this,e,t)),this},yr.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Ir(this,e,t)),this},yr.prototype.removeListener=function(e,t){var n,s,r,i,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(s=this._events))return this;if(!(n=s[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new Rr:(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,i=n.length;i-- >0;)if(n[i]===t||n[i].listener&&n[i].listener===t){o=n[i].listener,r=i;break}if(r<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new Rr,this;delete s[e]}else!function(e,t){for(var n=t,s=n+1,r=e.length;s<r;n+=1,s+=1)e[n]=e[s];e.pop()}(n,r);s.removeListener&&this.emit("removeListener",e,o||t)}return this},yr.prototype.off=function(e,t){return this.removeListener(e,t)},yr.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new Rr,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new Rr:delete n[e]),this;if(0===arguments.length){for(var s,r=Object.keys(n),i=0;i<r.length;++i)"removeListener"!==(s=r[i])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=new Rr,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},yr.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},yr.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Or.call(e,t)},yr.prototype.listenerCount=Or,yr.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var Dr=d(Object.freeze({__proto__:null,default:yr,EventEmitter:yr})),Pr={},xr={},Lr={},Ur={get exports(){return Lr},set exports(e){Lr=e}}.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(Ur).forEach((function(e){Ur[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,s){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var i=e.push?{}:r?n[e.name]:n;!function(e,n,s,r){if(r&&!s)n[r]=t(e[1]);else for(var i=0;i<s.length;i+=1)null!=e[i+1]&&(n[s[i]]=t(e[i+1]))}(s.match(e.reg),i,e.names,e.name),e.push&&n[e.push].push(i)},s=Lr,r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},i=[],o=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach((function(e){var t=e[0],r=e.slice(2);"m"===t&&(i.push({rtp:[],fmtp:[]}),o=i[i.length-1]);for(var l=0;l<(s[t]||[]).length;l+=1){var a=s[t][l];if(a.reg.test(r))return n(a,o,r)}})),t.media=i,t};var i=function(e,n){var s=n.split(/=(.+)/,2);return 2===s.length?e[s[0]]=t(s[1]):1===s.length&&n.length>1&&(e[s[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(i,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],s=e.split(" ").map(t),r=0;r<s.length;r+=3)n.push({component:s[r],ip:s[r+1],port:s[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(i,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var n,s=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),s=!0),{scid:n,paused:s}}))}))}}(xr);var kr=Lr,Mr=/%[sdv%]/g,$r=function(e){var t=1,n=arguments,s=n.length;return e.replace(Mr,(function(e){if(t>=s)return e;var r=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}}))},Fr=function(e,t,n){var s=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var r=0;r<t.names.length;r+=1){var i=t.names[r];t.name?s.push(n[t.name][i]):s.push(n[t.names[r]])}else s.push(n[t.name]);return $r.apply(null,s)},qr=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Hr=["i","c","b","a"],jr=xr,Br=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var n=t.outerOrder||qr,s=t.innerOrder||Hr,r=[];return n.forEach((function(t){kr[t].forEach((function(n){n.name in e&&null!=e[n.name]?r.push(Fr(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){r.push(Fr(t,n,e))}))}))})),e.media.forEach((function(e){r.push(Fr("m",kr.m[0],e)),s.forEach((function(t){kr[t].forEach((function(n){n.name in e&&null!=e[n.name]?r.push(Fr(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){r.push(Fr(t,n,e))}))}))}))})),r.join("\r\n")+"\r\n"};Pr.write=Br;var Wr=Pr.parse=jr.parse;Pr.parseParams=jr.parseParams,Pr.parseFmtpConfig=jr.parseFmtpConfig,Pr.parsePayloads=jr.parsePayloads,Pr.parseRemoteCandidates=jr.parseRemoteCandidates,Pr.parseImageAttributes=jr.parseImageAttributes,Pr.parseSimulcastStreamList=jr.parseSimulcastStreamList;var Gr={};var Vr=function(e){function t(e){let s,r,i,o=null;function l(...e){if(!l.enabled)return;const n=l,r=Number(new Date),i=r-(s||r);n.diff=i,n.prev=s,n.curr=r,s=r,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((s,r)=>{if("%%"===s)return"%";o++;const i=t.formatters[r];if("function"==typeof i){const t=e[o];s=i.call(n,t),e.splice(o,1),o--}return s})),t.formatArgs.call(n,e);(n.log||t.log).apply(n,e)}return l.namespace=e,l.useColors=t.useColors(),l.color=t.selectColor(e),l.extend=n,l.destroy=t.destroy,Object.defineProperty(l,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(r!==t.namespaces&&(r=t.namespaces,i=t.enabled(e)),i),set:e=>{o=e}}),"function"==typeof t.init&&t.init(l),l}function n(e,n){const s=t(this.namespace+(void 0===n?":":n)+e);return s.log=this.log,s}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(r),...t.skips.map(r).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const s=("string"==typeof e?e:"").split(/[\s,]+/),r=s.length;for(n=0;n<r;n++)s[n]&&("-"===(e=s[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,s;for(n=0,s=t.skips.length;n<s;n++)if(t.skips[n].test(e))return!1;for(n=0,s=t.names.length;n<s;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=s.default,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t};!function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let s=0,r=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(s++,"%c"===e&&(r=s))})),t.splice(r,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=Vr(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}({get exports(){return Gr},set exports(e){Gr=e}},Gr);const Kr=Pr,zr=or,Jr=Ar(),Xr=Er(),Yr=Cr(),Qr=Gr("JsSIP:SIPMessage");class Zr{constructor(e,t,n,s,r,i){if(!e||!t||!n)return null;s=s||{},this.ua=n,this.headers={},this.method=e,this.ruri=t,this.body=i,this.extraHeaders=Jr.cloneArray(r),s.route_set?this.setHeader("route",s.route_set):n.configuration.use_preloaded_route&&this.setHeader("route",`<${n.transport.sip_uri};lr>`),this.setHeader("via",""),this.setHeader("max-forwards",zr.MAX_FORWARDS);const o=s.to_uri||t,l=s.to_tag?{tag:s.to_tag}:null,a=void 0!==s.to_display_name?s.to_display_name:null;this.to=new Xr(o,a,l),this.setHeader("to",this.to.toString());const u=s.from_uri||n.configuration.uri,c={tag:s.from_tag||Jr.newTag()};let h;h=void 0!==s.from_display_name?s.from_display_name:n.configuration.display_name?n.configuration.display_name:null,this.from=new Xr(u,h,c),this.setHeader("from",this.from.toString());const d=s.call_id||n.configuration.jssip_id+Jr.createRandomToken(15);this.call_id=d,this.setHeader("call-id",d);const f=s.cseq||Math.floor(1e4*Math.random());this.cseq=f,this.setHeader("cseq",`${f} ${e}`)}setHeader(e,t){const n=new RegExp(`^\\s*${e}\\s*:`,"i");for(let e=0;e<this.extraHeaders.length;e++)n.test(this.extraHeaders[e])&&this.extraHeaders.splice(e,1);this.headers[Jr.headerize(e)]=Array.isArray(t)?t:[t]}getHeader(e){const t=this.headers[Jr.headerize(e)];if(t){if(t[0])return t[0]}else{const t=new RegExp(`^\\s*${e}\\s*:`,"i");for(const e of this.extraHeaders)if(t.test(e))return e.substring(e.indexOf(":")+1).trim()}}getHeaders(e){const t=this.headers[Jr.headerize(e)],n=[];if(t){for(const e of t)n.push(e);return n}{const t=new RegExp(`^\\s*${e}\\s*:`,"i");for(const e of this.extraHeaders)t.test(e)&&n.push(e.substring(e.indexOf(":")+1).trim());return n}}hasHeader(e){if(this.headers[Jr.headerize(e)])return!0;{const t=new RegExp(`^\\s*${e}\\s*:`,"i");for(const e of this.extraHeaders)if(t.test(e))return!0}return!1}parseSDP(e){return!e&&this.sdp||(this.sdp=Kr.parse(this.body||"")),this.sdp}toString(){let e=`${this.method} ${this.ruri} SIP/2.0\r\n`;for(const t in this.headers)if(Object.prototype.hasOwnProperty.call(this.headers,t))for(const n of this.headers[t])e+=`${t}: ${n}\r\n`;for(const t of this.extraHeaders)e+=`${t.trim()}\r\n`;const t=[];switch(this.method){case zr.REGISTER:t.push("path","gruu");break;case zr.INVITE:this.ua.configuration.session_timers&&t.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&t.push("gruu"),t.push("ice","replaces");break;case zr.UPDATE:this.ua.configuration.session_timers&&t.push("timer"),t.push("ice")}t.push("outbound");const n=this.ua.configuration.user_agent||zr.USER_AGENT;if(e+=`Allow: ${zr.ALLOWED_METHODS}\r\n`,e+=`Supported: ${t}\r\n`,e+=`User-Agent: ${n}\r\n`,this.body){e+=`Content-Length: ${Jr.str_utf8_length(this.body)}\r\n\r\n`,e+=this.body}else e+="Content-Length: 0\r\n\r\n";return e}clone(){const e=new Zr(this.method,this.ruri,this.ua);return Object.keys(this.headers).forEach((function(t){e.headers[t]=this.headers[t].slice()}),this),e.body=this.body,e.extraHeaders=Jr.cloneArray(this.extraHeaders),e.to=this.to,e.from=this.from,e.call_id=this.call_id,e.cseq=this.cseq,e}}class ei extends Zr{constructor(e,t,n,s,r){super(zr.INVITE,e,t,n,s,r),this.transaction=null}cancel(e){this.transaction.cancel(e)}clone(){const e=new ei(this.ruri,this.ua);return Object.keys(this.headers).forEach((function(t){e.headers[t]=this.headers[t].slice()}),this),e.body=this.body,e.extraHeaders=Jr.cloneArray(this.extraHeaders),e.to=this.to,e.from=this.from,e.call_id=this.call_id,e.cseq=this.cseq,e.transaction=this.transaction,e}}class ti{constructor(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}addHeader(e,t){const n={raw:t};e=Jr.headerize(e),this.headers[e]?this.headers[e].push(n):this.headers[e]=[n]}getHeader(e){const t=this.headers[Jr.headerize(e)];if(t)return t[0]?t[0].raw:void 0}getHeaders(e){const t=this.headers[Jr.headerize(e)],n=[];if(!t)return[];for(const e of t)n.push(e.raw);return n}hasHeader(e){return!!this.headers[Jr.headerize(e)]}parseHeader(e,t=0){if(e=Jr.headerize(e),!this.headers[e])return void Qr(`header "${e}" not present`);if(t>=this.headers[e].length)return void Qr(`not so many "${e}" headers present`);const n=this.headers[e][t],s=n.raw;if(n.parsed)return n.parsed;const r=Yr.parse(s,e.replace(/-/g,"_"));return-1===r?(this.headers[e].splice(t,1),void Qr(`error parsing "${e}" header field with value "${s}"`)):(n.parsed=r,r)}s(e,t){return this.parseHeader(e,t)}setHeader(e,t){const n={raw:t};this.headers[Jr.headerize(e)]=[n]}parseSDP(e){return!e&&this.sdp||(this.sdp=Kr.parse(this.body||"")),this.sdp}toString(){return this.data}}var ni={OutgoingRequest:Zr,InitialOutgoingInviteRequest:ei,IncomingRequest:class extends ti{constructor(e){super(),this.ua=e,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}reply(e,t,n,s,r,i){const o=[];let l=this.getHeader("To");if(t=t||null,!(e=e||null)||e<100||e>699)throw new TypeError(`Invalid status_code: ${e}`);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError(`Invalid reason_phrase: ${t}`);t=t||zr.REASON_PHRASE[e]||"",n=Jr.cloneArray(n);let a=`SIP/2.0 ${e} ${t}\r\n`;if(this.method===zr.INVITE&&e>100&&e<=200){const e=this.getHeaders("record-route");for(const t of e)a+=`Record-Route: ${t}\r\n`}const u=this.getHeaders("via");for(const e of u)a+=`Via: ${e}\r\n`;!this.to_tag&&e>100?l+=`;tag=${Jr.newTag()}`:this.to_tag&&!this.s("to").hasParam("tag")&&(l+=`;tag=${this.to_tag}`),a+=`To: ${l}\r\n`,a+=`From: ${this.getHeader("From")}\r\n`,a+=`Call-ID: ${this.call_id}\r\n`,a+=`CSeq: ${this.cseq} ${this.method}\r\n`;for(const e of n)a+=`${e.trim()}\r\n`;switch(this.method){case zr.INVITE:this.ua.configuration.session_timers&&o.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&o.push("gruu"),o.push("ice","replaces");break;case zr.UPDATE:this.ua.configuration.session_timers&&o.push("timer"),s&&o.push("ice"),o.push("replaces")}if(o.push("outbound"),this.method===zr.OPTIONS?(a+=`Allow: ${zr.ALLOWED_METHODS}\r\n`,a+=`Accept: ${zr.ACCEPTED_BODY_TYPES}\r\n`):405===e?a+=`Allow: ${zr.ALLOWED_METHODS}\r\n`:415===e&&(a+=`Accept: ${zr.ACCEPTED_BODY_TYPES}\r\n`),a+=`Supported: ${o}\r\n`,s){a+="Content-Type: application/sdp\r\n",a+=`Content-Length: ${Jr.str_utf8_length(s)}\r\n\r\n`,a+=s}else a+="Content-Length: 0\r\n\r\n";this.server_transaction.receiveResponse(e,a,r,i)}reply_sl(e=null,t=null){const n=this.getHeaders("via");if(!e||e<100||e>699)throw new TypeError(`Invalid status_code: ${e}`);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError(`Invalid reason_phrase: ${t}`);let s=`SIP/2.0 ${e} ${t=t||zr.REASON_PHRASE[e]||""}\r\n`;for(const e of n)s+=`Via: ${e}\r\n`;let r=this.getHeader("To");!this.to_tag&&e>100?r+=`;tag=${Jr.newTag()}`:this.to_tag&&!this.s("to").hasParam("tag")&&(r+=`;tag=${this.to_tag}`),s+=`To: ${r}\r\n`,s+=`From: ${this.getHeader("From")}\r\n`,s+=`Call-ID: ${this.call_id}\r\n`,s+=`CSeq: ${this.cseq} ${this.method}\r\n`,s+="Content-Length: 0\r\n\r\n",this.transport.send(s)}},IncomingResponse:class extends ti{constructor(){super(),this.headers={},this.status_code=null,this.reason_phrase=null}}};const si=Ar(),ri=Gr("JsSIP:DigestAuthentication"),ii=Gr("JsSIP:ERROR:DigestAuthentication");ii.log=console.warn.bind(console);const oi=500;var li={T1:oi,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4};const ai=Dr.EventEmitter,ui=or,ci=ni,hi=li,di=Gr("JsSIP:NonInviteClientTransaction"),fi=Gr("JsSIP:InviteClientTransaction"),_i=Gr("JsSIP:AckClientTransaction"),pi=Gr("JsSIP:NonInviteServerTransaction"),mi=Gr("JsSIP:InviteServerTransaction"),gi={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};var Ti={C:gi,NonInviteClientTransaction:class extends ai{constructor(e,t,n,s){super(),this.type=gi.NON_INVITE_CLIENT,this.id=`z9hG4bK${Math.floor(1e7*Math.random())}`,this.ua=e,this.transport=t,this.request=n,this.eventHandlers=s;let r=`SIP/2.0/${t.via_transport}`;r+=` ${e.configuration.via_host};branch=${this.id}`,this.request.setHeader("via",r),this.ua.newTransaction(this)}get C(){return gi}stateChanged(e){this.state=e,this.emit("stateChanged")}send(){this.stateChanged(gi.STATUS_TRYING),this.F=setTimeout((()=>{this.timer_F()}),hi.TIMER_F),this.transport.send(this.request)||this.onTransportError()}onTransportError(){di(`transport error occurred, deleting transaction ${this.id}`),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(gi.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onTransportError()}timer_F(){di(`Timer F expired for transaction ${this.id}`),this.stateChanged(gi.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout()}timer_K(){this.stateChanged(gi.STATUS_TERMINATED),this.ua.destroyTransaction(this)}receiveResponse(e){const t=e.status_code;if(t<200)switch(this.state){case gi.STATUS_TRYING:case gi.STATUS_PROCEEDING:this.stateChanged(gi.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(e)}else switch(this.state){case gi.STATUS_TRYING:case gi.STATUS_PROCEEDING:this.stateChanged(gi.STATUS_COMPLETED),clearTimeout(this.F),408===t?this.eventHandlers.onRequestTimeout():this.eventHandlers.onReceiveResponse(e),this.K=setTimeout((()=>{this.timer_K()}),hi.TIMER_K)}}},InviteClientTransaction:class extends ai{constructor(e,t,n,s){super(),this.type=gi.INVITE_CLIENT,this.id=`z9hG4bK${Math.floor(1e7*Math.random())}`,this.ua=e,this.transport=t,this.request=n,this.eventHandlers=s,n.transaction=this;let r=`SIP/2.0/${t.via_transport}`;r+=` ${e.configuration.via_host};branch=${this.id}`,this.request.setHeader("via",r),this.ua.newTransaction(this)}get C(){return gi}stateChanged(e){this.state=e,this.emit("stateChanged")}send(){this.stateChanged(gi.STATUS_CALLING),this.B=setTimeout((()=>{this.timer_B()}),hi.TIMER_B),this.transport.send(this.request)||this.onTransportError()}onTransportError(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==gi.STATUS_ACCEPTED&&(fi(`transport error occurred, deleting transaction ${this.id}`),this.eventHandlers.onTransportError()),this.stateChanged(gi.STATUS_TERMINATED),this.ua.destroyTransaction(this)}timer_M(){fi(`Timer M expired for transaction ${this.id}`),this.state===gi.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(gi.STATUS_TERMINATED),this.ua.destroyTransaction(this))}timer_B(){fi(`Timer B expired for transaction ${this.id}`),this.state===gi.STATUS_CALLING&&(this.stateChanged(gi.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout())}timer_D(){fi(`Timer D expired for transaction ${this.id}`),clearTimeout(this.B),this.stateChanged(gi.STATUS_TERMINATED),this.ua.destroyTransaction(this)}sendACK(e){const t=new ci.OutgoingRequest(ui.ACK,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});t.setHeader("from",this.request.getHeader("from")),t.setHeader("via",this.request.getHeader("via")),t.setHeader("to",e.getHeader("to")),this.D=setTimeout((()=>{this.timer_D()}),hi.TIMER_D),this.transport.send(t)}cancel(e){if(this.state!==gi.STATUS_PROCEEDING)return;const t=new ci.OutgoingRequest(ui.CANCEL,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});t.setHeader("from",this.request.getHeader("from")),t.setHeader("via",this.request.getHeader("via")),t.setHeader("to",this.request.getHeader("to")),e&&t.setHeader("reason",e),this.transport.send(t)}receiveResponse(e){const t=e.status_code;if(t>=100&&t<=199)switch(this.state){case gi.STATUS_CALLING:this.stateChanged(gi.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(e);break;case gi.STATUS_PROCEEDING:this.eventHandlers.onReceiveResponse(e)}else if(t>=200&&t<=299)switch(this.state){case gi.STATUS_CALLING:case gi.STATUS_PROCEEDING:this.stateChanged(gi.STATUS_ACCEPTED),this.M=setTimeout((()=>{this.timer_M()}),hi.TIMER_M),this.eventHandlers.onReceiveResponse(e);break;case gi.STATUS_ACCEPTED:this.eventHandlers.onReceiveResponse(e)}else if(t>=300&&t<=699)switch(this.state){case gi.STATUS_CALLING:case gi.STATUS_PROCEEDING:this.stateChanged(gi.STATUS_COMPLETED),this.sendACK(e),this.eventHandlers.onReceiveResponse(e);break;case gi.STATUS_COMPLETED:this.sendACK(e)}}},AckClientTransaction:class extends ai{constructor(e,t,n,s){super(),this.id=`z9hG4bK${Math.floor(1e7*Math.random())}`,this.transport=t,this.request=n,this.eventHandlers=s;let r=`SIP/2.0/${t.via_transport}`;r+=` ${e.configuration.via_host};branch=${this.id}`,this.request.setHeader("via",r)}get C(){return gi}send(){this.transport.send(this.request)||this.onTransportError()}onTransportError(){_i(`transport error occurred for transaction ${this.id}`),this.eventHandlers.onTransportError()}},NonInviteServerTransaction:class extends ai{constructor(e,t,n){super(),this.type=gi.NON_INVITE_SERVER,this.id=n.via_branch,this.ua=e,this.transport=t,this.request=n,this.last_response="",n.server_transaction=this,this.state=gi.STATUS_TRYING,e.newTransaction(this)}get C(){return gi}stateChanged(e){this.state=e,this.emit("stateChanged")}timer_J(){pi(`Timer J expired for transaction ${this.id}`),this.stateChanged(gi.STATUS_TERMINATED),this.ua.destroyTransaction(this)}onTransportError(){this.transportError||(this.transportError=!0,pi(`transport error occurred, deleting transaction ${this.id}`),clearTimeout(this.J),this.stateChanged(gi.STATUS_TERMINATED),this.ua.destroyTransaction(this))}receiveResponse(e,t,n,s){if(100===e)switch(this.state){case gi.STATUS_TRYING:this.stateChanged(gi.STATUS_PROCEEDING),this.transport.send(t)||this.onTransportError();break;case gi.STATUS_PROCEEDING:this.last_response=t,this.transport.send(t)?n&&n():(this.onTransportError(),s&&s())}else if(e>=200&&e<=699)switch(this.state){case gi.STATUS_TRYING:case gi.STATUS_PROCEEDING:this.stateChanged(gi.STATUS_COMPLETED),this.last_response=t,this.J=setTimeout((()=>{this.timer_J()}),hi.TIMER_J),this.transport.send(t)?n&&n():(this.onTransportError(),s&&s())}}},InviteServerTransaction:class extends ai{constructor(e,t,n){super(),this.type=gi.INVITE_SERVER,this.id=n.via_branch,this.ua=e,this.transport=t,this.request=n,this.last_response="",n.server_transaction=this,this.state=gi.STATUS_PROCEEDING,e.newTransaction(this),this.resendProvisionalTimer=null,n.reply(100)}get C(){return gi}stateChanged(e){this.state=e,this.emit("stateChanged")}timer_H(){mi(`Timer H expired for transaction ${this.id}`),this.state===gi.STATUS_COMPLETED&&mi("ACK not received, dialog will be terminated"),this.stateChanged(gi.STATUS_TERMINATED),this.ua.destroyTransaction(this)}timer_I(){this.stateChanged(gi.STATUS_TERMINATED),this.ua.destroyTransaction(this)}timer_L(){mi(`Timer L expired for transaction ${this.id}`),this.state===gi.STATUS_ACCEPTED&&(this.stateChanged(gi.STATUS_TERMINATED),this.ua.destroyTransaction(this))}onTransportError(){this.transportError||(this.transportError=!0,mi(`transport error occurred, deleting transaction ${this.id}`),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(gi.STATUS_TERMINATED),this.ua.destroyTransaction(this))}resend_provisional(){this.transport.send(this.last_response)||this.onTransportError()}receiveResponse(e,t,n,s){if(e>=100&&e<=199&&this.state===gi.STATUS_PROCEEDING)this.transport.send(t)||this.onTransportError(),this.last_response=t;if(e>100&&e<=199&&this.state===gi.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=setInterval((()=>{this.resend_provisional()}),hi.PROVISIONAL_RESPONSE_INTERVAL));else if(e>=200&&e<=299)switch(this.state){case gi.STATUS_PROCEEDING:this.stateChanged(gi.STATUS_ACCEPTED),this.last_response=t,this.L=setTimeout((()=>{this.timer_L()}),hi.TIMER_L),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case gi.STATUS_ACCEPTED:this.transport.send(t)?n&&n():(this.onTransportError(),s&&s())}else if(e>=300&&e<=699&&this.state===gi.STATUS_PROCEEDING)null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(t)?(this.stateChanged(gi.STATUS_COMPLETED),this.H=setTimeout((()=>{this.timer_H()}),hi.TIMER_H),n&&n()):(this.onTransportError(),s&&s())}},checkTransaction:function({_transactions:e},t){let n;switch(t.method){case ui.INVITE:if(n=e.ist[t.via_branch],n){if(n.state===gi.STATUS_PROCEEDING)n.transport.send(n.last_response);return!0}break;case ui.ACK:if(n=e.ist[t.via_branch],!n)return!1;if(n.state===gi.STATUS_ACCEPTED)return!1;if(n.state===gi.STATUS_COMPLETED)return n.state=gi.STATUS_CONFIRMED,n.I=setTimeout((()=>{n.timer_I()}),hi.TIMER_I),!0;break;case ui.CANCEL:return n=e.ist[t.via_branch],n?(t.reply_sl(200),n.state!==gi.STATUS_PROCEEDING):(t.reply_sl(481),!0);default:if(n=e.nist[t.via_branch],n){switch(n.state){case gi.STATUS_TRYING:break;case gi.STATUS_PROCEEDING:case gi.STATUS_COMPLETED:n.transport.send(n.last_response)}return!0}}}};const vi=or,Ei=class{constructor(e){this._credentials=e,this._cnonce=null,this._nc=0,this._ncHex="00000000",this._algorithm=null,this._realm=null,this._nonce=null,this._opaque=null,this._stale=null,this._qop=null,this._method=null,this._uri=null,this._ha1=null,this._response=null}get(e){switch(e){case"realm":return this._realm;case"ha1":return this._ha1;default:return void ii('get() | cannot get "%s" parameter',e)}}authenticate({method:e,ruri:t,body:n},s,r=null){if(this._algorithm=s.algorithm,this._realm=s.realm,this._nonce=s.nonce,this._opaque=s.opaque,this._stale=s.stale,this._algorithm){if("MD5"!==this._algorithm)return ii('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this._algorithm="MD5";if(!this._nonce)return ii("authenticate() | challenge without Digest nonce, authentication aborted"),!1;if(!this._realm)return ii("authenticate() | challenge without Digest realm, authentication aborted"),!1;if(!this._credentials.password){if(!this._credentials.ha1)return ii("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"),!1;if(this._credentials.realm!==this._realm)return ii('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]',this._credentials.realm,this._realm),!1}if(s.qop)if(s.qop.indexOf("auth-int")>-1)this._qop="auth-int";else{if(!(s.qop.indexOf("auth")>-1))return ii('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this._qop="auth"}else this._qop=null;this._method=e,this._uri=t,this._cnonce=r||si.createRandomToken(12),this._nc+=1;const i=Number(this._nc).toString(16);let o,l;return this._ncHex="00000000".substr(0,8-i.length)+i,4294967296===this._nc&&(this._nc=1,this._ncHex="00000001"),this._credentials.password?this._ha1=si.calculateMD5(`${this._credentials.username}:${this._realm}:${this._credentials.password}`):this._ha1=this._credentials.ha1,"auth"===this._qop?(o=`${this._method}:${this._uri}`,l=si.calculateMD5(o),ri('authenticate() | using qop=auth [a2:"%s"]',o),this._response=si.calculateMD5(`${this._ha1}:${this._nonce}:${this._ncHex}:${this._cnonce}:auth:${l}`)):"auth-int"===this._qop?(o=`${this._method}:${this._uri}:${si.calculateMD5(n||"")}`,l=si.calculateMD5(o),ri('authenticate() | using qop=auth-int [a2:"%s"]',o),this._response=si.calculateMD5(`${this._ha1}:${this._nonce}:${this._ncHex}:${this._cnonce}:auth-int:${l}`)):null===this._qop&&(o=`${this._method}:${this._uri}`,l=si.calculateMD5(o),ri('authenticate() | using qop=null [a2:"%s"]',o),this._response=si.calculateMD5(`${this._ha1}:${this._nonce}:${l}`)),ri("authenticate() | response generated"),!0}toString(){const e=[];if(!this._response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push(`algorithm=${this._algorithm}`),e.push(`username="${this._credentials.username}"`),e.push(`realm="${this._realm}"`),e.push(`nonce="${this._nonce}"`),e.push(`uri="${this._uri}"`),e.push(`response="${this._response}"`),this._opaque&&e.push(`opaque="${this._opaque}"`),this._qop&&(e.push(`qop=${this._qop}`),e.push(`cnonce="${this._cnonce}"`),e.push(`nc=${this._ncHex}`)),`Digest ${e.join(", ")}`}},Ci=Ti,Si=Gr("JsSIP:RequestSender"),Ai={onRequestTimeout:()=>{},onTransportError:()=>{},onReceiveResponse:()=>{},onAuthenticated:()=>{}};var Ri=class{constructor(e,t,n){this._ua=e,this._eventHandlers=n,this._method=t.method,this._request=t,this._auth=null,this._challenged=!1,this._staled=!1;for(const e in Ai)Object.prototype.hasOwnProperty.call(Ai,e)&&(this._eventHandlers[e]||(this._eventHandlers[e]=Ai[e]));e.status!==e.C.STATUS_USER_CLOSED||this._method===vi.BYE&&this._method===vi.ACK||this._eventHandlers.onTransportError()}send(){const e={onRequestTimeout:()=>{this._eventHandlers.onRequestTimeout()},onTransportError:()=>{this._eventHandlers.onTransportError()},onReceiveResponse:e=>{this._receiveResponse(e)}};switch(this._method){case"INVITE":this.clientTransaction=new Ci.InviteClientTransaction(this._ua,this._ua.transport,this._request,e);break;case"ACK":this.clientTransaction=new Ci.AckClientTransaction(this._ua,this._ua.transport,this._request,e);break;default:this.clientTransaction=new Ci.NonInviteClientTransaction(this._ua,this._ua.transport,this._request,e)}this._ua._configuration.authorization_jwt&&this._request.setHeader("Authorization",this._ua._configuration.authorization_jwt),this.clientTransaction.send()}_receiveResponse(e){let t,n;const s=e.status_code;if(401!==s&&407!==s||null===this._ua.configuration.password&&null===this._ua.configuration.ha1)this._eventHandlers.onReceiveResponse(e);else{if(401===e.status_code?(t=e.parseHeader("www-authenticate"),n="authorization"):(t=e.parseHeader("proxy-authenticate"),n="proxy-authorization"),!t)return Si(`${e.status_code} with wrong or missing challenge, cannot authenticate`),void this._eventHandlers.onReceiveResponse(e);if(!this._challenged||!this._staled&&!0===t.stale){if(this._auth||(this._auth=new Ei({username:this._ua.configuration.authorization_user,password:this._ua.configuration.password,realm:this._ua.configuration.realm,ha1:this._ua.configuration.ha1})),!this._auth.authenticate(this._request,t))return void this._eventHandlers.onReceiveResponse(e);this._challenged=!0,this._ua.set("realm",this._auth.get("realm")),this._ua.set("ha1",this._auth.get("ha1")),t.stale&&(this._staled=!0),this._request=this._request.clone(),this._request.cseq+=1,this._request.setHeader("cseq",`${this._request.cseq} ${this._method}`),this._request.setHeader(n,this._auth.toString()),this._eventHandlers.onAuthenticated(this._request),this.send()}else this._eventHandlers.onReceiveResponse(e)}}};const yi=Ar(),bi=or,wi=ni,Ii=Ri,Oi=Gr("JsSIP:Registrator");var Ni,Di,Pi,xi;function Li(){if(xi)return Pi;xi=1;const e=ni,t=or,n=Ti,s=function(){if(Di)return Ni;Di=1;const e=or,t=Ti,n=ao(),s=Ri,r={onRequestTimeout:()=>{},onTransportError:()=>{},onSuccessResponse:()=>{},onErrorResponse:()=>{},onAuthenticated:()=>{},onDialogError:()=>{}};return Ni=class{constructor(e,t,n){this._dialog=e,this._ua=e._ua,this._request=t,this._eventHandlers=n,this._reattempt=!1,this._reattemptTimer=null;for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&(this._eventHandlers[e]||(this._eventHandlers[e]=r[e]))}get request(){return this._request}send(){const n=new s(this._ua,this._request,{onRequestTimeout:()=>{this._eventHandlers.onRequestTimeout()},onTransportError:()=>{this._eventHandlers.onTransportError()},onAuthenticated:e=>{this._eventHandlers.onAuthenticated(e)},onReceiveResponse:e=>{this._receiveResponse(e)}});if(n.send(),(this._request.method===e.INVITE||this._request.method===e.UPDATE&&this._request.body)&&n.clientTransaction.state!==t.C.STATUS_TERMINATED){this._dialog.uac_pending_reply=!0;const e=()=>{n.clientTransaction.state!==t.C.STATUS_ACCEPTED&&n.clientTransaction.state!==t.C.STATUS_COMPLETED&&n.clientTransaction.state!==t.C.STATUS_TERMINATED||(n.clientTransaction.removeListener("stateChanged",e),this._dialog.uac_pending_reply=!1)};n.clientTransaction.on("stateChanged",e)}}_receiveResponse(t){408===t.status_code||481===t.status_code?this._eventHandlers.onDialogError(t):t.method===e.INVITE&&491===t.status_code?this._reattempt?t.status_code>=200&&t.status_code<300?this._eventHandlers.onSuccessResponse(t):t.status_code>=300&&this._eventHandlers.onErrorResponse(t):(this._request.cseq=this._dialog.local_seqnum+=1,this._reattemptTimer=setTimeout((()=>{this._dialog.owner.status!==n.C.STATUS_TERMINATED&&(this._reattempt=!0,this._request_sender.send())}),1e3)):t.status_code>=200&&t.status_code<300?this._eventHandlers.onSuccessResponse(t):t.status_code>=300&&this._eventHandlers.onErrorResponse(t)}},Ni}(),r=Ar(),i=Gr("JsSIP:Dialog"),o={STATUS_EARLY:1,STATUS_CONFIRMED:2};return Pi=class{static get C(){return o}constructor(t,n,s,r=o.STATUS_CONFIRMED){if(this._owner=t,this._ua=t._ua,this._uac_pending_reply=!1,this._uas_pending_reply=!1,!n.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};n instanceof e.IncomingResponse&&(r=n.status_code<200?o.STATUS_EARLY:o.STATUS_CONFIRMED);const l=n.parseHeader("contact");"UAS"===s?(this._id={call_id:n.call_id,local_tag:n.to_tag,remote_tag:n.from_tag,toString(){return this.call_id+this.local_tag+this.remote_tag}},this._state=r,this._remote_seqnum=n.cseq,this._local_uri=n.parseHeader("to").uri,this._remote_uri=n.parseHeader("from").uri,this._remote_target=l.uri,this._route_set=n.getHeaders("record-route"),this._ack_seqnum=this._remote_seqnum):"UAC"===s&&(this._id={call_id:n.call_id,local_tag:n.from_tag,remote_tag:n.to_tag,toString(){return this.call_id+this.local_tag+this.remote_tag}},this._state=r,this._local_seqnum=n.cseq,this._local_uri=n.parseHeader("from").uri,this._remote_uri=n.parseHeader("to").uri,this._remote_target=l.uri,this._route_set=n.getHeaders("record-route").reverse(),this._ack_seqnum=null),this._ua.newDialog(this),i(`new ${s} dialog created with status ${this._state===o.STATUS_EARLY?"EARLY":"CONFIRMED"}`)}get id(){return this._id}get local_seqnum(){return this._local_seqnum}set local_seqnum(e){this._local_seqnum=e}get owner(){return this._owner}get uac_pending_reply(){return this._uac_pending_reply}set uac_pending_reply(e){this._uac_pending_reply=e}get uas_pending_reply(){return this._uas_pending_reply}update(e,t){this._state=o.STATUS_CONFIRMED,i(`dialog ${this._id.toString()}  changed to CONFIRMED state`),"UAC"===t&&(this._route_set=e.getHeaders("record-route").reverse())}terminate(){i(`dialog ${this._id.toString()} deleted`),this._ua.destroyDialog(this)}sendRequest(e,t={}){const n=r.cloneArray(t.extraHeaders),i=r.cloneObject(t.eventHandlers),o=t.body||null,l=this._createRequest(e,n,o);i.onAuthenticated=()=>{this._local_seqnum+=1};return new s(this,l,i).send(),l}receiveRequest(e){this._checkInDialogRequest(e)&&(e.method===t.ACK&&null!==this._ack_seqnum?this._ack_seqnum=null:e.method===t.INVITE&&(this._ack_seqnum=e.cseq),this._owner.receiveRequest(e))}_createRequest(n,s,i){s=r.cloneArray(s),this._local_seqnum||(this._local_seqnum=Math.floor(1e4*Math.random()));const o=n===t.CANCEL||n===t.ACK?this._local_seqnum:this._local_seqnum+=1;return new e.OutgoingRequest(n,this._remote_target,this._ua,{cseq:o,call_id:this._id.call_id,from_uri:this._local_uri,from_tag:this._id.local_tag,to_uri:this._remote_uri,to_tag:this._id.remote_tag,route_set:this._route_set},s,i)}_checkInDialogRequest(e){if(this._remote_seqnum)if(e.cseq<this._remote_seqnum){if(e.method!==t.ACK)return e.reply(500),!1;if(null===this._ack_seqnum||e.cseq!==this._ack_seqnum)return!1}else e.cseq>this._remote_seqnum&&(this._remote_seqnum=e.cseq);else this._remote_seqnum=e.cseq;if(e.method===t.INVITE||e.method===t.UPDATE&&e.body){if(!0===this._uac_pending_reply)e.reply(491);else{if(!0===this._uas_pending_reply){const t=1+(10*Math.random()|0);return e.reply(500,null,[`Retry-After:${t}`]),!1}{this._uas_pending_reply=!0;const t=()=>{e.server_transaction.state!==n.C.STATUS_ACCEPTED&&e.server_transaction.state!==n.C.STATUS_COMPLETED&&e.server_transaction.state!==n.C.STATUS_TERMINATED||(e.server_transaction.removeListener("stateChanged",t),this._uas_pending_reply=!1)};e.server_transaction.on("stateChanged",t)}}e.hasHeader("contact")&&e.server_transaction.on("stateChanged",(()=>{e.server_transaction.state===n.C.STATUS_ACCEPTED&&(this._remote_target=e.parseHeader("contact").uri)}))}else e.method===t.NOTIFY&&e.hasHeader("contact")&&e.server_transaction.on("stateChanged",(()=>{e.server_transaction.state===n.C.STATUS_COMPLETED&&(this._remote_target=e.parseHeader("contact").uri)}));return!0}},Pi}var Ui={},ki={get exports(){return Ui},set exports(e){Ui=e}};const Mi=Dr.EventEmitter,$i=or,Fi=Tr,qi=Ar(),Hi=Gr("JsSIP:RTCSession:DTMF");Gr("JsSIP:ERROR:RTCSession:DTMF").log=console.warn.bind(console);const ji={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};ki.exports=class extends Mi{constructor(e){super(),this._session=e,this._direction=null,this._tone=null,this._duration=null,this._request=null}get tone(){return this._tone}get duration(){return this._duration}send(e,t={}){if(void 0===e)throw new TypeError("Not enough arguments");if(this._direction="outgoing",this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new Fi.InvalidStateError(this._session.status);const n=qi.cloneArray(t.extraHeaders);if(this.eventHandlers=qi.cloneObject(t.eventHandlers),"string"==typeof e)e=e.toUpperCase();else{if("number"!=typeof e)throw new TypeError(`Invalid tone: ${e}`);e=e.toString()}if(!e.match(/^[0-9A-DR#*]$/))throw new TypeError(`Invalid tone: ${e}`);this._tone=e,this._duration=t.duration,n.push("Content-Type: application/dtmf-relay");let s=`Signal=${this._tone}\r\n`;s+=`Duration=${this._duration}`,this._session.newDTMF({originator:"local",dtmf:this,request:this._request}),this._session.sendRequest($i.INFO,{extraHeaders:n,eventHandlers:{onSuccessResponse:e=>{this.emit("succeeded",{originator:"remote",response:e})},onErrorResponse:e=>{this.eventHandlers.onFailed&&this.eventHandlers.onFailed(),this.emit("failed",{originator:"remote",response:e})},onRequestTimeout:()=>{this._session.onRequestTimeout()},onTransportError:()=>{this._session.onTransportError()},onDialogError:()=>{this._session.onDialogError()}},body:s})}init_incoming(e){const t=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,n=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;if(this._direction="incoming",this._request=e,e.reply(200),e.body){const s=e.body.split("\n");s.length>=1&&t.test(s[0])&&(this._tone=s[0].replace(t,"$2")),s.length>=2&&n.test(s[1])&&(this._duration=parseInt(s[1].replace(n,"$2"),10))}this._duration||(this._duration=ji.DEFAULT_DURATION),this._tone?this._session.newDTMF({originator:"remote",dtmf:this,request:e}):Hi("invalid INFO DTMF received, discarded")}},Ui.C=ji;const Bi=Dr.EventEmitter;Gr("JsSIP:ERROR:RTCSession:Info").log=console.warn.bind(console);const Wi=or,Gi=Tr,Vi=Ar();var Ki=class extends Bi{constructor(e){super(),this._session=e,this._direction=null,this._contentType=null,this._body=null}get contentType(){return this._contentType}get body(){return this._body}send(e,t,n={}){if(this._direction="outgoing",void 0===e)throw new TypeError("Not enough arguments");if(this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new Gi.InvalidStateError(this._session.status);this._contentType=e,this._body=t;const s=Vi.cloneArray(n.extraHeaders);s.push(`Content-Type: ${e}`),this._session.newInfo({originator:"local",info:this,request:this.request}),this._session.sendRequest(Wi.INFO,{extraHeaders:s,eventHandlers:{onSuccessResponse:e=>{this.emit("succeeded",{originator:"remote",response:e})},onErrorResponse:e=>{this.emit("failed",{originator:"remote",response:e})},onTransportError:()=>{this._session.onTransportError()},onRequestTimeout:()=>{this._session.onRequestTimeout()},onDialogError:()=>{this._session.onDialogError()}},body:t})}init_incoming(e){this._direction="incoming",this.request=e,e.reply(200),this._contentType=e.hasHeader("Content-Type")?e.getHeader("Content-Type").toLowerCase():void 0,this._body=e.body,this._session.newInfo({originator:"remote",info:this,request:e})}};const zi=or,Ji=Gr("JsSIP:RTCSession:ReferNotifier"),Xi="refer",Yi="message/sipfrag;version=2.0",Qi=300;var Zi=class{constructor(e,t,n){this._session=e,this._id=t,this._expires=n||Qi,this._active=!0,this.notify(100)}notify(e,t){if(Ji("notify()"),!1===this._active)return;let n;t=t||zi.REASON_PHRASE[e]||"",n=e>=200?"terminated;reason=noresource":`active;expires=${this._expires}`,this._session.sendRequest(zi.NOTIFY,{extraHeaders:[`Event: ${Xi};id=${this._id}`,`Subscription-State: ${n}`,`Content-Type: ${Yi}`],body:`SIP/2.0 ${e} ${t}`,eventHandlers:{onErrorResponse(){this._active=!1}}})}};const eo=Dr.EventEmitter,to=or,no=Cr(),so=Ar(),ro=Gr("JsSIP:RTCSession:ReferSubscriber");var io,oo,lo=class extends eo{constructor(e){super(),this._id=null,this._session=e}get id(){return this._id}sendRefer(e,t={}){ro("sendRefer()");const n=so.cloneArray(t.extraHeaders),s=so.cloneObject(t.eventHandlers);for(const e in s)Object.prototype.hasOwnProperty.call(s,e)&&this.on(e,s[e]);let r=null;t.replaces&&(r=t.replaces._request.call_id,r+=`;to-tag=${t.replaces._to_tag}`,r+=`;from-tag=${t.replaces._from_tag}`,r=encodeURIComponent(r));const i=`Refer-To: <${e}${r?`?Replaces=${r}`:""}>`;n.push(i);const o=`Referred-By: <${this._session._ua._configuration.uri._scheme}:${this._session._ua._configuration.uri._user}@${this._session._ua._configuration.uri._host}>`;n.push(o),n.push(`Contact: ${this._session.contact}`);const l=this._session.sendRequest(to.REFER,{extraHeaders:n,eventHandlers:{onSuccessResponse:e=>{this._requestSucceeded(e)},onErrorResponse:e=>{this._requestFailed(e,to.causes.REJECTED)},onTransportError:()=>{this._requestFailed(null,to.causes.CONNECTION_ERROR)},onRequestTimeout:()=>{this._requestFailed(null,to.causes.REQUEST_TIMEOUT)},onDialogError:()=>{this._requestFailed(null,to.causes.DIALOG_ERROR)}}});this._id=l.cseq}receiveNotify(e){if(ro("receiveNotify()"),!e.body)return;const t=no.parse(e.body.trim(),"Status_Line");if(-1!==t)switch(!0){case/^100$/.test(t.status_code):this.emit("trying",{request:e,status_line:t});break;case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",{request:e,status_line:t});break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("accepted",{request:e,status_line:t});break;default:this.emit("failed",{request:e,status_line:t})}else ro(`receiveNotify() | error parsing NOTIFY body: "${e.body}"`)}_requestSucceeded(e){ro("REFER succeeded"),ro('emit "requestSucceeded"'),this.emit("requestSucceeded",{response:e})}_requestFailed(e,t){ro("REFER failed"),ro('emit "requestFailed"'),this.emit("requestFailed",{response:e||null,cause:t})}};function ao(){if(oo)return io;oo=1;const e=Dr.EventEmitter,t=Pr,n=or,s=Tr,r=Ti,i=Ar(),o=li,l=ni,a=Li(),u=Ri,c=Ui,h=Ki,d=Zi,f=lo,_=Sr(),p=Gr("JsSIP:RTCSession"),m=Gr("JsSIP:ERROR:RTCSession");m.log=console.warn.bind(console);const g={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9},T=["audio","video"];return io=class v extends e{static get C(){return g}constructor(e){p("new"),super(),this._id=null,this._ua=e,this._status=g.STATUS_NULL,this._dialog=null,this._earlyDialogs={},this._contact=null,this._from_tag=null,this._to_tag=null,this._connection=null,this._connectionPromiseQueue=Promise.resolve(),this._request=null,this._is_canceled=!1,this._cancel_reason="",this._is_confirmed=!1,this._late_sdp=!1,this._rtcOfferConstraints=null,this._rtcAnswerConstraints=null,this._localMediaStream=null,this._localMediaStreamLocallyGenerated=!1,this._rtcReady=!0,this._timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this._direction=null,this._local_identity=null,this._remote_identity=null,this._start_time=null,this._end_time=null,this._tones=null,this._audioMuted=!1,this._videoMuted=!1,this._localHold=!1,this._remoteHold=!1,this._sessionTimers={enabled:this._ua.configuration.session_timers,refreshMethod:this._ua.configuration.session_timers_refresh_method,defaultExpires:n.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},this._referSubscribers={},this._data={},this._preview=!1,this._previewLocalDesc=null}get C(){return g}get causes(){return n.causes}get id(){return this._id}get connection(){return this._connection}get contact(){return this._contact}get direction(){return this._direction}get local_identity(){return this._local_identity}get remote_identity(){return this._remote_identity}get start_time(){return this._start_time}get end_time(){return this._end_time}get data(){return this._data}set data(e){this._data=e}get status(){return this._status}isInProgress(){switch(this._status){case g.STATUS_NULL:case g.STATUS_INVITE_SENT:case g.STATUS_1XX_RECEIVED:case g.STATUS_INVITE_RECEIVED:case g.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}}isEstablished(){switch(this._status){case g.STATUS_ANSWERED:case g.STATUS_WAITING_FOR_ACK:case g.STATUS_CONFIRMED:return!0;default:return!1}}isEnded(){switch(this._status){case g.STATUS_CANCELED:case g.STATUS_TERMINATED:return!0;default:return!1}}isMuted(){return{audio:this._audioMuted,video:this._videoMuted}}isOnHold(){return{local:this._localHold,remote:this._remoteHold}}connect(e,t={},r){p("connect()");const o=e,a=i.cloneObject(t.eventHandlers),u=i.cloneArray(t.extraHeaders),c=i.cloneObject(t.mediaConstraints,{audio:!0,video:!0}),h=t.mediaStream||null,d=i.cloneObject(t.pcConfig,{iceServers:[]}),f=t.rtcConstraints||null,m=t.rtcOfferConstraints||null;if(this._rtcOfferConstraints=m,this._rtcAnswerConstraints=t.rtcAnswerConstraints||null,this._data=t.data||this._data,void 0===e)throw new TypeError("Not enough arguments");if(this._status!==g.STATUS_NULL)throw new s.InvalidStateError(this._status);if(!window.RTCPeerConnection)throw new s.NotSupportedError("WebRTC not supported");if(!(e=this._ua.normalizeTarget(e)))throw new TypeError(`Invalid target: ${o}`);this._sessionTimers.enabled&&i.isDecimal(t.sessionTimersExpires)&&(t.sessionTimersExpires>=n.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=t.sessionTimersExpires:this._sessionTimers.defaultExpires=n.SESSION_EXPIRES);for(const e in a)Object.prototype.hasOwnProperty.call(a,e)&&this.on(e,a[e]);this._from_tag=i.newTag();const T=t.anonymous||!1,v={from_tag:this._from_tag};this._contact=this._ua.contact.toString({anonymous:T,outbound:!0}),T&&(v.from_display_name="Anonymous",v.from_uri=new _("sip","anonymous","anonymous.invalid"),u.push(`P-Preferred-Identity: ${this._ua.configuration.uri.toString()}`),u.push("Privacy: id")),u.push(`Contact: ${this._contact}`),u.push("Content-Type: application/sdp"),this._sessionTimers.enabled&&u.push(`Session-Expires: ${this._sessionTimers.defaultExpires}${this._ua.configuration.session_timers_force_refresher?";refresher=uac":""}`),this._request=new l.InitialOutgoingInviteRequest(e,this._ua,v,u),this._id=this._request.call_id+this._from_tag,this._createRTCConnection(d,f),this._direction="outgoing",this._local_identity=this._request.from,this._remote_identity=this._request.to,r&&r(this),this._newRTCSession("local",this._request),this._sendInitialRequest(c,m,h)}init_incoming(e,t){let s;p("init_incoming()");const r=e.hasHeader("Content-Type")?e.getHeader("Content-Type").toLowerCase():void 0;e.body&&"application/sdp"!==r?e.reply(415):(this._status=g.STATUS_INVITE_RECEIVED,this._from_tag=e.from_tag,this._id=e.call_id+this._from_tag,this._request=e,this._contact=this._ua.contact.toString(),e.hasHeader("expires")&&(s=1e3*e.getHeader("expires")),e.to_tag=i.newTag(),this._createDialog(e,"UAS",!0)?(e.body?this._late_sdp=!1:this._late_sdp=!0,this._status=g.STATUS_WAITING_FOR_ANSWER,this._timers.userNoAnswerTimer=setTimeout((()=>{e.reply(408),this._failed("local",null,n.causes.NO_ANSWER)}),this._ua.configuration.no_answer_timeout),s&&(this._timers.expiresTimer=setTimeout((()=>{this._status===g.STATUS_WAITING_FOR_ANSWER&&(e.reply(487),this._failed("system",null,n.causes.EXPIRES))}),s)),this._direction="incoming",this._local_identity=e.to,this._remote_identity=e.from,t&&t(this),this._newRTCSession("remote",e),this._status!==g.STATUS_TERMINATED&&(e.reply(180,null,[`Contact: ${this._contact}`]),this._progress("local",null))):e.reply(500,"Missing Contact header field"))}preview(e={}){p("preview()");const t=this._request,r=i.cloneArray(e.extraHeaders),o=i.cloneObject(e.mediaConstraints),l=e.mediaStream||null,a=i.cloneObject(e.pcConfig,{iceServers:[]}),u=e.rtcConstraints||null,c=e.rtcAnswerConstraints||null,h=i.cloneObject(e.rtcOfferConstraints);let d,f=!1,_=!1,T=!1,v=!1;if(this._rtcAnswerConstraints=c,this._rtcOfferConstraints=e.rtcOfferConstraints||null,this._data=e.data||this._data,"incoming"!==this._direction)throw new s.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this._status!==g.STATUS_WAITING_FOR_ANSWER)throw new s.InvalidStateError(this._status);if(this._sessionTimers.enabled&&i.isDecimal(e.sessionTimersExpires)&&(e.sessionTimersExpires>=n.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=e.sessionTimersExpires:this._sessionTimers.defaultExpires=n.SESSION_EXPIRES),this._status=g.STATUS_ANSWERED,!this._createDialog(t,"UAS"))return void t.reply(500,"Error creating dialog");clearTimeout(this._timers.userNoAnswerTimer),r.unshift(`Contact: ${this._contact}`);const E=t.parseSDP();Array.isArray(E.media)||(E.media=[E.media]);for(const e of E.media)"audio"===e.type&&(f=!0,e.direction&&"sendrecv"!==e.direction||(T=!0)),"video"===e.type&&(_=!0,e.direction&&"sendrecv"!==e.direction||(v=!0));if(l&&!1===o.audio){d=l.getAudioTracks();for(const e of d)l.removeTrack(e)}if(l&&!1===o.video){d=l.getVideoTracks();for(const e of d)l.removeTrack(e)}l||void 0!==o.audio||(o.audio=T),l||void 0!==o.video||(o.video=v),l||f||h.offerToReceiveAudio||(o.audio=!1),l||_||h.offerToReceiveVideo||(o.video=!1),this._createRTCConnection(a,u),Promise.resolve().then((()=>l||(o.audio||o.video?(this._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(o).catch((e=>{if(this._status===g.STATUS_TERMINATED)throw new Error("terminated");throw t.reply(480),this._failed("local",null,n.causes.USER_DENIED_MEDIA_ACCESS),m('emit "getusermediafailed" [error:%o]',e),this.emit("getusermediafailed",e),new Error("getUserMedia() failed")}))):void 0))).then((e=>{if(this._status===g.STATUS_TERMINATED)throw new Error("terminated");this._localMediaStream=e,e&&e.getTracks().forEach((t=>{this._connection.addTrack(t,e)}))})).then((()=>{if(this._late_sdp)return;const e={originator:"remote",type:"offer",sdp:t.body};p('emit "sdp"'),this.emit("sdp",e);const s=new RTCSessionDescription({type:"offer",sdp:e.sdp});return this._connectionPromiseQueue=this._connectionPromiseQueue.then((()=>this._connection.setRemoteDescription(s))).catch((e=>{throw t.reply(488),this._failed("system",null,n.causes.WEBRTC_ERROR),m('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),this.emit("peerconnection:setremotedescriptionfailed",e),new Error("peerconnection.setRemoteDescription() failed")})),this._connectionPromiseQueue})).then((()=>{if(this._status===g.STATUS_TERMINATED)throw new Error("terminated");return this._connecting(t),this._late_sdp?this._createLocalDescription("offer",this._rtcOfferConstraints).catch((()=>{throw t.reply(500),new Error("_createLocalDescription() failed")})):this._createLocalDescription("answer",c).catch((()=>{throw t.reply(500),new Error("_createLocalDescription() failed")}))})).then((e=>{if(this._status===g.STATUS_TERMINATED)throw new Error("terminated");this._handleSessionTimersInIncomingRequest(t,r),this._previewLocalDesc=e,t.reply(183,null,r,e,(()=>{}),(()=>{this._failed("system",null,n.causes.CONNECTION_ERROR)})),this._preview=!0})).catch((e=>{this._status!==g.STATUS_TERMINATED&&m(e)}))}answer(e={}){p("answer()");const t=this._request,r=i.cloneArray(e.extraHeaders),o=i.cloneObject(e.mediaConstraints),l=e.mediaStream||null,a=i.cloneObject(e.pcConfig,{iceServers:[]}),u=e.rtcConstraints||null,c=e.rtcAnswerConstraints||null,h=i.cloneObject(e.rtcOfferConstraints);let d,f=!1,_=!1,T=!1,v=!1;if(this._rtcAnswerConstraints=c,this._rtcOfferConstraints=e.rtcOfferConstraints||null,this._data=e.data||this._data,"incoming"!==this._direction)throw new s.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this._preview){this._preview=!1,this._status=g.STATUS_ANSWERED,clearTimeout(this._timers.userNoAnswerTimer),this._handleSessionTimersInIncomingRequest(t,r);let e=this._previewLocalDesc;return void t.reply(200,null,r,e,(()=>{this._status=g.STATUS_WAITING_FOR_ACK,this._setInvite2xxTimer(t,e),this._setACKTimer(),this._accepted("local")}),(()=>{this._failed("system",null,n.causes.CONNECTION_ERROR)}))}if(this._status!==g.STATUS_WAITING_FOR_ANSWER)throw new s.InvalidStateError(this._status);if(this._sessionTimers.enabled&&i.isDecimal(e.sessionTimersExpires)&&(e.sessionTimersExpires>=n.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=e.sessionTimersExpires:this._sessionTimers.defaultExpires=n.SESSION_EXPIRES),this._status=g.STATUS_ANSWERED,!this._createDialog(t,"UAS"))return void t.reply(500,"Error creating dialog");clearTimeout(this._timers.userNoAnswerTimer),r.unshift(`Contact: ${this._contact}`);const E=t.parseSDP();Array.isArray(E.media)||(E.media=[E.media]);for(const e of E.media)"audio"===e.type&&(f=!0,e.direction&&"sendrecv"!==e.direction||(T=!0)),"video"===e.type&&(_=!0,e.direction&&"sendrecv"!==e.direction||(v=!0));if(l&&!1===o.audio){d=l.getAudioTracks();for(const e of d)l.removeTrack(e)}if(l&&!1===o.video){d=l.getVideoTracks();for(const e of d)l.removeTrack(e)}l||void 0!==o.audio||(o.audio=T),l||void 0!==o.video||(o.video=v),l||f||h.offerToReceiveAudio||(o.audio=!1),l||_||h.offerToReceiveVideo||(o.video=!1),this._createRTCConnection(a,u),Promise.resolve().then((()=>l||(o.audio||o.video?(this._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(o).catch((e=>{if(this._status===g.STATUS_TERMINATED)throw new Error("terminated");throw t.reply(480),this._failed("local",null,n.causes.USER_DENIED_MEDIA_ACCESS),m('emit "getusermediafailed" [error:%o]',e),this.emit("getusermediafailed",e),new Error("getUserMedia() failed")}))):void 0))).then((e=>{if(this._status===g.STATUS_TERMINATED)throw new Error("terminated");this._localMediaStream=e,e&&e.getTracks().forEach((t=>{this._connection.addTrack(t,e)}))})).then((()=>{if(this._late_sdp)return;const e={originator:"remote",type:"offer",sdp:t.body};p('emit "sdp"'),this.emit("sdp",e);const s=new RTCSessionDescription({type:"offer",sdp:e.sdp});return this._connectionPromiseQueue=this._connectionPromiseQueue.then((()=>this._connection.setRemoteDescription(s))).catch((e=>{throw t.reply(488),this._failed("system",null,n.causes.WEBRTC_ERROR),m('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),this.emit("peerconnection:setremotedescriptionfailed",e),new Error("peerconnection.setRemoteDescription() failed")})),this._connectionPromiseQueue})).then((()=>{if(this._status===g.STATUS_TERMINATED)throw new Error("terminated");return this._connecting(t),this._late_sdp?this._createLocalDescription("offer",this._rtcOfferConstraints).catch((()=>{throw t.reply(500),new Error("_createLocalDescription() failed")})):this._createLocalDescription("answer",c).catch((()=>{throw t.reply(500),new Error("_createLocalDescription() failed")}))})).then((e=>{if(this._status===g.STATUS_TERMINATED)throw new Error("terminated");this._handleSessionTimersInIncomingRequest(t,r),t.reply(200,null,r,e,(()=>{this._status=g.STATUS_WAITING_FOR_ACK,this._setInvite2xxTimer(t,e),this._setACKTimer(),this._accepted("local")}),(()=>{this._failed("system",null,n.causes.CONNECTION_ERROR)}))})).catch((e=>{this._status!==g.STATUS_TERMINATED&&m(e)}))}terminate(e={}){p("terminate()");const t=e.cause||n.causes.BYE,o=i.cloneArray(e.extraHeaders),l=e.body;let a,u=e.status_code,c=e.reason_phrase;if(this._status===g.STATUS_TERMINATED)throw new s.InvalidStateError(this._status);switch(this._status){case g.STATUS_NULL:case g.STATUS_INVITE_SENT:case g.STATUS_1XX_RECEIVED:if(p("canceling session"),u&&(u<200||u>=700))throw new TypeError(`Invalid status_code: ${u}`);u&&(c=c||n.REASON_PHRASE[u]||"",a=`SIP ;cause=${u} ;text="${c}"`),this._status===g.STATUS_NULL||this._status===g.STATUS_INVITE_SENT?(this._is_canceled=!0,this._cancel_reason=a):this._status===g.STATUS_1XX_RECEIVED&&this._request.cancel(a),this._status=g.STATUS_CANCELED,this._failed("local",null,n.causes.CANCELED);break;case g.STATUS_WAITING_FOR_ANSWER:case g.STATUS_ANSWERED:if(p("rejecting session"),u=u||480,u<300||u>=700)throw new TypeError(`Invalid status_code: ${u}`);this._request.reply(u,c,o,l),this._failed("local",null,n.causes.REJECTED);break;case g.STATUS_WAITING_FOR_ACK:case g.STATUS_CONFIRMED:if(p("terminating session"),c=e.reason_phrase||n.REASON_PHRASE[u]||"",u&&(u<200||u>=700))throw new TypeError(`Invalid status_code: ${u}`);if(u&&o.push(`Reason: SIP ;cause=${u}; text="${c}"`),this._status===g.STATUS_WAITING_FOR_ACK&&"incoming"===this._direction&&this._request.server_transaction.state!==r.C.STATUS_TERMINATED){const e=this._dialog;this.receiveRequest=({method:t})=>{t===n.ACK&&(this.sendRequest(n.BYE,{extraHeaders:o,body:l}),e.terminate())},this._request.server_transaction.on("stateChanged",(()=>{this._request.server_transaction.state===r.C.STATUS_TERMINATED&&(this.sendRequest(n.BYE,{extraHeaders:o,body:l}),e.terminate())})),this._ended("local",null,t),this._dialog=e,this._ua.newDialog(e)}else this.sendRequest(n.BYE,{extraHeaders:o,body:l}),this._ended("local",null,t)}}sendDTMF(e,t={}){p("sendDTMF() | tones: %s",e);let r=0,o=t.duration||null,l=t.interToneGap||null;const a=t.transportType||n.DTMF_TRANSPORT.INFO;if(void 0===e)throw new TypeError("Not enough arguments");if(this._status!==g.STATUS_CONFIRMED&&this._status!==g.STATUS_WAITING_FOR_ACK)throw new s.InvalidStateError(this._status);if(a!==n.DTMF_TRANSPORT.INFO&&a!==n.DTMF_TRANSPORT.RFC2833)throw new TypeError(`invalid transportType: ${a}`);if("number"==typeof e&&(e=e.toString()),!e||"string"!=typeof e||!e.match(/^[0-9A-DR#*,]+$/i))throw new TypeError(`Invalid tones: ${e}`);if(o&&!i.isDecimal(o))throw new TypeError(`Invalid tone duration: ${o}`);if(o?o<c.C.MIN_DURATION?(p(`"duration" value is lower than the minimum allowed, setting it to ${c.C.MIN_DURATION} milliseconds`),o=c.C.MIN_DURATION):o>c.C.MAX_DURATION?(p(`"duration" value is greater than the maximum allowed, setting it to ${c.C.MAX_DURATION} milliseconds`),o=c.C.MAX_DURATION):o=Math.abs(o):o=c.C.DEFAULT_DURATION,t.duration=o,l&&!i.isDecimal(l))throw new TypeError(`Invalid interToneGap: ${l}`);if(l?l<c.C.MIN_INTER_TONE_GAP?(p(`"interToneGap" value is lower than the minimum allowed, setting it to ${c.C.MIN_INTER_TONE_GAP} milliseconds`),l=c.C.MIN_INTER_TONE_GAP):l=Math.abs(l):l=c.C.DEFAULT_INTER_TONE_GAP,a!==n.DTMF_TRANSPORT.RFC2833)this._tones?this._tones+=e:(this._tones=e,function e(){let n;if(this._status===g.STATUS_TERMINATED||!this._tones||r>=this._tones.length)return void(this._tones=null);const s=this._tones[r];if(r+=1,","===s)n=2e3;else{const e=new c(this);t.eventHandlers={onFailed:()=>{this._tones=null}},e.send(s,t),n=o+l}setTimeout(e.bind(this),n)}.call(this));else{const t=this._getDTMFRTPSender();t&&(e=t.toneBuffer+e,t.insertDTMF(e,o,l))}}sendInfo(e,t,n={}){if(p("sendInfo()"),this._status!==g.STATUS_CONFIRMED&&this._status!==g.STATUS_WAITING_FOR_ACK)throw new s.InvalidStateError(this._status);new h(this).send(e,t,n)}mute(e={audio:!0,video:!1}){p("mute()");let t=!1,n=!1;!1===this._audioMuted&&e.audio&&(t=!0,this._audioMuted=!0,this._toggleMuteAudio(!0)),!1===this._videoMuted&&e.video&&(n=!0,this._videoMuted=!0,this._toggleMuteVideo(!0)),!0!==t&&!0!==n||this._onmute({audio:t,video:n})}unmute(e={audio:!0,video:!0}){p("unmute()");let t=!1,n=!1;!0===this._audioMuted&&e.audio&&(t=!0,this._audioMuted=!1,!1===this._localHold&&this._toggleMuteAudio(!1)),!0===this._videoMuted&&e.video&&(n=!0,this._videoMuted=!1,!1===this._localHold&&this._toggleMuteVideo(!1)),!0!==t&&!0!==n||this._onunmute({audio:t,video:n})}hold(e={},t){if(p("hold()"),this._status!==g.STATUS_WAITING_FOR_ACK&&this._status!==g.STATUS_CONFIRMED)return!1;if(!0===this._localHold)return!1;if(!this._isReadyToReOffer())return!1;this._localHold=!0,this._onhold("local");const s={succeeded:()=>{t&&t()},failed:()=>{this.terminate({cause:n.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}};return e.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:s,extraHeaders:e.extraHeaders}):this._sendReinvite({eventHandlers:s,extraHeaders:e.extraHeaders}),!0}unhold(e={},t){if(p("unhold()"),this._status!==g.STATUS_WAITING_FOR_ACK&&this._status!==g.STATUS_CONFIRMED)return!1;if(!1===this._localHold)return!1;if(!this._isReadyToReOffer())return!1;this._localHold=!1,this._onunhold("local");const s={succeeded:()=>{t&&t()},failed:()=>{this.terminate({cause:n.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}};return e.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:s,extraHeaders:e.extraHeaders}):this._sendReinvite({eventHandlers:s,extraHeaders:e.extraHeaders}),!0}renegotiate(e={},t){p("renegotiate()");const s=e.rtcOfferConstraints||null;if(this._status!==g.STATUS_WAITING_FOR_ACK&&this._status!==g.STATUS_CONFIRMED)return!1;if(!this._isReadyToReOffer())return!1;const r={succeeded:()=>{t&&t()},failed:()=>{this.terminate({cause:n.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}};return this._setLocalMediaStatus(),e.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:r,rtcOfferConstraints:s,extraHeaders:e.extraHeaders}):this._sendReinvite({eventHandlers:r,rtcOfferConstraints:s,extraHeaders:e.extraHeaders}),!0}refer(e,t){p("refer()");const n=e;if(this._status!==g.STATUS_WAITING_FOR_ACK&&this._status!==g.STATUS_CONFIRMED)return!1;if(!(e=this._ua.normalizeTarget(e)))throw new TypeError(`Invalid target: ${n}`);const s=new f(this);s.sendRefer(e,t);const r=s.id;return this._referSubscribers[r]=s,s.on("requestFailed",(()=>{delete this._referSubscribers[r]})),s.on("accepted",(()=>{delete this._referSubscribers[r]})),s.on("failed",(()=>{delete this._referSubscribers[r]})),s}sendRequest(e,t){return p("sendRequest()"),this._dialog.sendRequest(e,t)}receiveRequest(e){if(p("receiveRequest()"),e.method===n.CANCEL)this._status!==g.STATUS_WAITING_FOR_ANSWER&&this._status!==g.STATUS_ANSWERED||(this._status=g.STATUS_CANCELED,this._request.reply(487),this._failed("remote",e,n.causes.CANCELED));else switch(e.method){case n.ACK:if(this._status!==g.STATUS_WAITING_FOR_ACK)return;if(this._status=g.STATUS_CONFIRMED,clearTimeout(this._timers.ackTimer),clearTimeout(this._timers.invite2xxTimer),this._late_sdp){if(!e.body){this.terminate({cause:n.causes.MISSING_SDP,status_code:400});break}const t={originator:"remote",type:"answer",sdp:e.body};p('emit "sdp"'),this.emit("sdp",t);const s=new RTCSessionDescription({type:"answer",sdp:t.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then((()=>this._connection.setRemoteDescription(s))).then((()=>{this._is_confirmed||this._confirmed("remote",e)})).catch((e=>{this.terminate({cause:n.causes.BAD_MEDIA_DESCRIPTION,status_code:488}),m('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),this.emit("peerconnection:setremotedescriptionfailed",e)}))}else this._is_confirmed||this._confirmed("remote",e);break;case n.BYE:this._status===g.STATUS_CONFIRMED||this._status===g.STATUS_WAITING_FOR_ACK?(e.reply(200),this._ended("remote",e,n.causes.BYE)):this._status===g.STATUS_INVITE_RECEIVED||this._status===g.STATUS_WAITING_FOR_ANSWER?(e.reply(200),this._request.reply(487,"BYE Received"),this._ended("remote",e,n.causes.BYE)):e.reply(403,"Wrong Status");break;case n.INVITE:this._status===g.STATUS_CONFIRMED?e.hasHeader("replaces")?this._receiveReplaces(e):this._receiveReinvite(e):e.reply(403,"Wrong Status");break;case n.INFO:if(this._status===g.STATUS_1XX_RECEIVED||this._status===g.STATUS_WAITING_FOR_ANSWER||this._status===g.STATUS_ANSWERED||this._status===g.STATUS_WAITING_FOR_ACK||this._status===g.STATUS_CONFIRMED){const t=e.hasHeader("Content-Type")?e.getHeader("Content-Type").toLowerCase():void 0;t&&t.match(/^application\/dtmf-relay/i)?new c(this).init_incoming(e):void 0!==t?new h(this).init_incoming(e):e.reply(415)}else e.reply(403,"Wrong Status");break;case n.UPDATE:this._status===g.STATUS_CONFIRMED?this._receiveUpdate(e):e.reply(403,"Wrong Status");break;case n.REFER:this._status===g.STATUS_CONFIRMED?this._receiveRefer(e):e.reply(403,"Wrong Status");break;case n.NOTIFY:this._status===g.STATUS_CONFIRMED?this._receiveNotify(e):e.reply(403,"Wrong Status");break;default:e.reply(501)}}onTransportError(){m("onTransportError()"),this._status!==g.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:n.causes.CONNECTION_ERROR,cause:n.causes.CONNECTION_ERROR})}onRequestTimeout(){m("onRequestTimeout()"),this._status!==g.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:n.causes.REQUEST_TIMEOUT,cause:n.causes.REQUEST_TIMEOUT})}onDialogError(){m("onDialogError()"),this._status!==g.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:n.causes.DIALOG_ERROR,cause:n.causes.DIALOG_ERROR})}newDTMF(e){p("newDTMF()"),this.emit("newDTMF",e)}newInfo(e){p("newInfo()"),this.emit("newInfo",e)}_isReadyToReOffer(){return this._rtcReady?this._dialog?!0!==this._dialog.uac_pending_reply&&!0!==this._dialog.uas_pending_reply||(p("_isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):(p("_isReadyToReOffer() | session not established yet"),!1):(p("_isReadyToReOffer() | internal WebRTC status not ready"),!1)}_close(){if(p("close()"),this._status!==g.STATUS_TERMINATED){if(this._status=g.STATUS_TERMINATED,this._connection)try{this._connection.close()}catch(e){m("close() | error closing the RTCPeerConnection: %o",e)}this._localMediaStream&&this._localMediaStreamLocallyGenerated&&(p("close() | closing local MediaStream"),i.closeMediaStream(this._localMediaStream));for(const e in this._timers)Object.prototype.hasOwnProperty.call(this._timers,e)&&clearTimeout(this._timers[e]);clearTimeout(this._sessionTimers.timer),this._dialog&&(this._dialog.terminate(),delete this._dialog);for(const e in this._earlyDialogs)Object.prototype.hasOwnProperty.call(this._earlyDialogs,e)&&(this._earlyDialogs[e].terminate(),delete this._earlyDialogs[e]);for(const e in this._referSubscribers)Object.prototype.hasOwnProperty.call(this._referSubscribers,e)&&delete this._referSubscribers[e];this._ua.destroyRTCSession(this)}}_setInvite2xxTimer(e,t){let n=o.T1;this._timers.invite2xxTimer=setTimeout(function s(){this._status===g.STATUS_WAITING_FOR_ACK&&(e.reply(200,null,[`Contact: ${this._contact}`],t),n<o.T2&&(n*=2,n>o.T2&&(n=o.T2)),this._timers.invite2xxTimer=setTimeout(s.bind(this),n))}.bind(this),n)}_setACKTimer(){this._timers.ackTimer=setTimeout((()=>{this._status===g.STATUS_WAITING_FOR_ACK&&(p("no ACK received, terminating the session"),clearTimeout(this._timers.invite2xxTimer),this.sendRequest(n.BYE),this._ended("remote",null,n.causes.NO_ACK))}),o.TIMER_H)}_createRTCConnection(e,t){this._connection=new RTCPeerConnection(e,t),this._connection.addEventListener("iceconnectionstatechange",(()=>{"failed"===this._connection.iceConnectionState&&this.terminate({cause:n.causes.RTP_TIMEOUT,status_code:408,reason_phrase:n.causes.RTP_TIMEOUT})})),p('emit "peerconnection"'),this.emit("peerconnection",{peerconnection:this._connection})}_createLocalDescription(e,t){if(p("createLocalDescription()"),"offer"!==e&&"answer"!==e)throw new Error(`createLocalDescription() | invalid type "${e}"`);const n=this._connection;return this._rtcReady=!1,Promise.resolve().then((()=>"offer"===e?n.createOffer(t).catch((e=>(m('emit "peerconnection:createofferfailed" [error:%o]',e),this.emit("peerconnection:createofferfailed",e),Promise.reject(e)))):n.createAnswer(t).catch((e=>(m('emit "peerconnection:createanswerfailed" [error:%o]',e),this.emit("peerconnection:createanswerfailed",e),Promise.reject(e)))))).then((e=>n.setLocalDescription(e).catch((e=>(this._rtcReady=!0,m('emit "peerconnection:setlocaldescriptionfailed" [error:%o]',e),this.emit("peerconnection:setlocaldescriptionfailed",e),Promise.reject(e)))))).then((()=>{if(!("complete"!==n.iceGatheringState||t&&t.iceRestart)){this._rtcReady=!0;const t={originator:"local",type:e,sdp:n.localDescription.sdp};return p('emit "sdp"'),this.emit("sdp",t),Promise.resolve(t.sdp)}return new Promise((t=>{let s,r,i=!1;const o=()=>{n.removeEventListener("icecandidate",s),n.removeEventListener("icegatheringstatechange",r),i=!0,this._rtcReady=!0;const o={originator:"local",type:e,sdp:n.localDescription.sdp};p('emit "sdp"'),this.emit("sdp",o),t(o.sdp)};n.addEventListener("icecandidate",s=e=>{const t=e.candidate;t?this.emit("icecandidate",{candidate:t,ready:o}):i||o()}),n.addEventListener("icegatheringstatechange",r=()=>{"complete"!==n.iceGatheringState||i||o()})}))}))}_createDialog(e,t,s){const r="UAS"===t?e.to_tag:e.from_tag,i="UAS"===t?e.from_tag:e.to_tag,o=e.call_id+r+i;let l=this._earlyDialogs[o];if(s)return!!l||(l=new a(this,e,t,a.C.STATUS_EARLY),l.error?(p(l.error),this._failed("remote",e,n.causes.INTERNAL_ERROR),!1):(this._earlyDialogs[o]=l,!0));{if(this._from_tag=e.from_tag,this._to_tag=e.to_tag,l)return l.update(e,t),this._dialog=l,delete this._earlyDialogs[o],!0;const s=new a(this,e,t);return s.error?(p(s.error),this._failed("remote",e,n.causes.INTERNAL_ERROR),!1):(this._dialog=s,!0)}}_receiveReinvite(e){p("receiveReinvite()");const t=e.hasHeader("Content-Type")?e.getHeader("Content-Type").toLowerCase():void 0,n={request:e,callback:void 0,reject:function(t={}){s=!0;const n=t.status_code||403,r=t.reason_phrase||"",o=i.cloneArray(t.extraHeaders);if(this._status!==g.STATUS_CONFIRMED)return!1;if(n<300||n>=700)throw new TypeError(`Invalid status_code: ${n}`);e.reply(n,r,o)}.bind(this)};let s=!1;if(this.emit("reinvite",n),!s){if(this._late_sdp=!1,!e.body)return this._late_sdp=!0,this._remoteHold&&(this._remoteHold=!1,this._onunhold("remote")),void(this._connectionPromiseQueue=this._connectionPromiseQueue.then((()=>this._createLocalDescription("offer",this._rtcOfferConstraints))).then((e=>{r.call(this,e)})).catch((()=>{e.reply(500)})));if("application/sdp"!==t)return p("invalid Content-Type"),void e.reply(415);this._processInDialogSdpOffer(e).then((e=>{this._status!==g.STATUS_TERMINATED&&r.call(this,e)})).catch((e=>{m(e)}))}function r(t){const s=[`Contact: ${this._contact}`];this._handleSessionTimersInIncomingRequest(e,s),this._late_sdp&&(t=this._mangleOffer(t)),e.reply(200,null,s,t,(()=>{this._status=g.STATUS_WAITING_FOR_ACK,this._setInvite2xxTimer(e,t),this._setACKTimer()})),"function"==typeof n.callback&&n.callback()}}_receiveUpdate(e){p("receiveUpdate()");const t=e.hasHeader("Content-Type")?e.getHeader("Content-Type").toLowerCase():void 0,n={request:e,callback:void 0,reject:function(t={}){s=!0;const n=t.status_code||403,r=t.reason_phrase||"",o=i.cloneArray(t.extraHeaders);if(this._status!==g.STATUS_CONFIRMED)return!1;if(n<300||n>=700)throw new TypeError(`Invalid status_code: ${n}`);e.reply(n,r,o)}.bind(this)};let s=!1;if(this.emit("update",n),!s)if(e.body){if("application/sdp"!==t)return p("invalid Content-Type"),void e.reply(415);this._processInDialogSdpOffer(e).then((e=>{this._status!==g.STATUS_TERMINATED&&r.call(this,e)})).catch((e=>{m(e)}))}else r.call(this,null);function r(t){const s=[`Contact: ${this._contact}`];this._handleSessionTimersInIncomingRequest(e,s),e.reply(200,null,s,t),"function"==typeof n.callback&&n.callback()}}_processInDialogSdpOffer(e){p("_processInDialogSdpOffer()");const t=e.parseSDP();let n=!1;for(const e of t.media){if(-1===T.indexOf(e.type))continue;const s=e.direction||t.direction||"sendrecv";if("sendonly"!==s&&"inactive"!==s){n=!1;break}n=!0}const s={originator:"remote",type:"offer",sdp:e.body};p('emit "sdp"'),this.emit("sdp",s);const r=new RTCSessionDescription({type:"offer",sdp:s.sdp});return this._connectionPromiseQueue=this._connectionPromiseQueue.then((()=>{if(this._status===g.STATUS_TERMINATED)throw new Error("terminated");return this._connection.setRemoteDescription(r).catch((t=>{throw e.reply(488),m('emit "peerconnection:setremotedescriptionfailed" [error:%o]',t),this.emit("peerconnection:setremotedescriptionfailed",t),t}))})).then((()=>{if(this._status===g.STATUS_TERMINATED)throw new Error("terminated");!0===this._remoteHold&&!1===n?(this._remoteHold=!1,this._onunhold("remote")):!1===this._remoteHold&&!0===n&&(this._remoteHold=!0,this._onhold("remote"))})).then((()=>{if(this._status===g.STATUS_TERMINATED)throw new Error("terminated");return this._createLocalDescription("answer",this._rtcAnswerConstraints).catch((t=>{throw e.reply(500),m('emit "peerconnection:createtelocaldescriptionfailed" [error:%o]',t),t}))})).catch((e=>{m("_processInDialogSdpOffer() failed [error: %o]",e)})),this._connectionPromiseQueue}_receiveRefer(e){if(p("receiveRefer()"),!e.refer_to)return p("no Refer-To header field present in REFER"),void e.reply(400);if(e.refer_to.uri.scheme!==n.SIP)return p("Refer-To header field points to a non-SIP URI scheme"),void e.reply(416);e.reply(202);const t=new d(this,e.cseq);function s(n,s={}){if(n="function"==typeof n?n:null,this._status!==g.STATUS_WAITING_FOR_ACK&&this._status!==g.STATUS_CONFIRMED)return!1;const r=new v(this._ua);if(r.on("progress",(({response:e})=>{t.notify(e.status_code,e.reason_phrase)})),r.on("accepted",(({response:e})=>{t.notify(e.status_code,e.reason_phrase)})),r.on("_failed",(({message:e,cause:n})=>{e?t.notify(e.status_code,e.reason_phrase):t.notify(487,n)})),e.refer_to.uri.hasHeader("replaces")){const t=decodeURIComponent(e.refer_to.uri.getHeader("replaces"));s.extraHeaders=i.cloneArray(s.extraHeaders),s.extraHeaders.push(`Replaces: ${t}`)}r.connect(e.refer_to.uri.toAor(),s,n)}function r(){t.notify(603)}p('emit "refer"'),this.emit("refer",{request:e,accept:(e,t)=>{s.call(this,e,t)},reject:()=>{r.call(this)}})}_receiveNotify(e){switch(p("receiveNotify()"),e.event||e.reply(400),e.event.event){case"refer":{let t,n;if(e.event.params&&e.event.params.id)t=e.event.params.id,n=this._referSubscribers[t];else{if(1!==Object.keys(this._referSubscribers).length)return void e.reply(400,"Missing event id parameter");n=this._referSubscribers[Object.keys(this._referSubscribers)[0]]}if(!n)return void e.reply(481,"Subscription does not exist");n.receiveNotify(e),e.reply(200);break}default:e.reply(489)}}_receiveReplaces(e){function t(t){if(this._status!==g.STATUS_WAITING_FOR_ACK&&this._status!==g.STATUS_CONFIRMED)return!1;const n=new v(this._ua);n.on("confirmed",(()=>{this.terminate()})),n.init_incoming(e,t)}function n(){p("Replaced INVITE rejected by the user"),e.reply(486)}p("receiveReplaces()"),this.emit("replaces",{request:e,accept:e=>{t.call(this,e)},reject:()=>{n.call(this)}})}_sendInitialRequest(e,t,s){const r=new u(this._ua,this._request,{onRequestTimeout:()=>{this.onRequestTimeout()},onTransportError:()=>{this.onTransportError()},onAuthenticated:e=>{this._request=e},onReceiveResponse:e=>{this._receiveInviteResponse(e)}});Promise.resolve().then((()=>s||(e.audio||e.video?(this._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(e).catch((e=>{if(this._status===g.STATUS_TERMINATED)throw new Error("terminated");throw this._failed("local",null,n.causes.USER_DENIED_MEDIA_ACCESS),m('emit "getusermediafailed" [error:%o]',e),this.emit("getusermediafailed",e),e}))):void 0))).then((e=>{if(this._status===g.STATUS_TERMINATED)throw new Error("terminated");return this._localMediaStream=e,e&&e.getTracks().forEach((t=>{this._connection.addTrack(t,e)})),this._connecting(this._request),this._createLocalDescription("offer",t).catch((e=>{throw this._failed("local",null,n.causes.WEBRTC_ERROR),e}))})).then((e=>{if(this._is_canceled||this._status===g.STATUS_TERMINATED)throw new Error("terminated");this._request.body=e,this._status=g.STATUS_INVITE_SENT,p('emit "sending" [request:%o]',this._request),this.emit("sending",{request:this._request}),r.send()})).catch((e=>{this._status!==g.STATUS_TERMINATED&&m(e)}))}_getDTMFRTPSender(){const e=this._connection.getSenders().find((e=>e.track&&"audio"===e.track.kind));if(e&&e.dtmf)return e.dtmf;m("sendDTMF() | no local audio track to send DTMF with")}_receiveInviteResponse(e){if(p("receiveInviteResponse()"),this._dialog&&e.status_code>=200&&e.status_code<=299){if(this._dialog.id.call_id===e.call_id&&this._dialog.id.local_tag===e.from_tag&&this._dialog.id.remote_tag===e.to_tag)return void this.sendRequest(n.ACK);{const t=new a(this,e,"UAC");return void 0!==t.error?void p(t.error):(this.sendRequest(n.ACK),void this.sendRequest(n.BYE))}}if(this._is_canceled)e.status_code>=100&&e.status_code<200?this._request.cancel(this._cancel_reason):e.status_code>=200&&e.status_code<299&&this._acceptAndTerminate(e);else if(this._status===g.STATUS_INVITE_SENT||this._status===g.STATUS_1XX_RECEIVED)switch(!0){case/^100$/.test(e.status_code):this._status=g.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(e.status_code):{if(!e.to_tag){p("1xx response received without to tag");break}if(e.hasHeader("contact")&&!this._createDialog(e,"UAC",!0))break;if(this._status=g.STATUS_1XX_RECEIVED,!e.body){this._progress("remote",e);break}const t={originator:"remote",type:"answer",sdp:e.body};p('emit "sdp"'),this.emit("sdp",t);const n=new RTCSessionDescription({type:"answer",sdp:t.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then((()=>this._connection.setRemoteDescription(n))).then((()=>this._progress("remote",e))).catch((e=>{m('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),this.emit("peerconnection:setremotedescriptionfailed",e)}));break}case/^2[0-9]{2}$/.test(e.status_code):{if(this._status=g.STATUS_CONFIRMED,!e.body){this._acceptAndTerminate(e,400,n.causes.MISSING_SDP),this._failed("remote",e,n.causes.BAD_MEDIA_DESCRIPTION);break}if(!this._createDialog(e,"UAC"))break;const t={originator:"remote",type:"answer",sdp:e.body};p('emit "sdp"'),this.emit("sdp",t);const s=new RTCSessionDescription({type:"answer",sdp:t.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then((()=>{if("stable"===this._connection.signalingState)return this._connection.createOffer(this._rtcOfferConstraints).then((e=>this._connection.setLocalDescription(e))).catch((t=>{this._acceptAndTerminate(e,500,t.toString()),this._failed("local",e,n.causes.WEBRTC_ERROR)}))})).then((()=>{this._connection.setRemoteDescription(s).then((()=>{this._handleSessionTimersInIncomingResponse(e),this._accepted("remote",e),this.sendRequest(n.ACK),this._confirmed("local",null)})).catch((t=>{this._acceptAndTerminate(e,488,"Not Acceptable Here"),this._failed("remote",e,n.causes.BAD_MEDIA_DESCRIPTION),m('emit "peerconnection:setremotedescriptionfailed" [error:%o]',t),this.emit("peerconnection:setremotedescriptionfailed",t)}))}));break}default:{const t=i.sipErrorCause(e.status_code);this._failed("remote",e,t)}}}_sendReinvite(e={}){p("sendReinvite()");const t=i.cloneArray(e.extraHeaders),s=i.cloneObject(e.eventHandlers),r=e.rtcOfferConstraints||this._rtcOfferConstraints||null;let o=!1;function l(e){if(this._status===g.STATUS_TERMINATED)return;if(this.sendRequest(n.ACK),o)return;if(this._handleSessionTimersInIncomingResponse(e),!e.body)return void a.call(this);if(!e.hasHeader("Content-Type")||"application/sdp"!==e.getHeader("Content-Type").toLowerCase())return void a.call(this);const t={originator:"remote",type:"answer",sdp:e.body};p('emit "sdp"'),this.emit("sdp",t);const r=new RTCSessionDescription({type:"answer",sdp:t.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then((()=>this._connection.setRemoteDescription(r))).then((()=>{s.succeeded&&s.succeeded(e)})).catch((e=>{a.call(this),m('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),this.emit("peerconnection:setremotedescriptionfailed",e)}))}function a(e){s.failed&&s.failed(e)}t.push(`Contact: ${this._contact}`),t.push("Content-Type: application/sdp"),this._sessionTimers.running&&t.push(`Session-Expires: ${this._sessionTimers.currentExpires};refresher=${this._sessionTimers.refresher?"uac":"uas"}`),this._connectionPromiseQueue=this._connectionPromiseQueue.then((()=>this._createLocalDescription("offer",r))).then((e=>{const s={originator:"local",type:"offer",sdp:e=this._mangleOffer(e)};p('emit "sdp"'),this.emit("sdp",s),this.sendRequest(n.INVITE,{extraHeaders:t,body:e,eventHandlers:{onSuccessResponse:e=>{l.call(this,e),o=!0},onErrorResponse:e=>{a.call(this,e)},onTransportError:()=>{this.onTransportError()},onRequestTimeout:()=>{this.onRequestTimeout()},onDialogError:()=>{this.onDialogError()}}})})).catch((()=>{a()}))}_sendUpdate(e={}){p("sendUpdate()");const t=i.cloneArray(e.extraHeaders),s=i.cloneObject(e.eventHandlers),r=e.rtcOfferConstraints||this._rtcOfferConstraints||null,o=e.sdpOffer||!1;let l=!1;function a(e){if(this._status!==g.STATUS_TERMINATED&&!l)if(this._handleSessionTimersInIncomingResponse(e),o){if(!e.body)return void u.call(this);if(!e.hasHeader("Content-Type")||"application/sdp"!==e.getHeader("Content-Type").toLowerCase())return void u.call(this);const t={originator:"remote",type:"answer",sdp:e.body};p('emit "sdp"'),this.emit("sdp",t);const n=new RTCSessionDescription({type:"answer",sdp:t.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then((()=>this._connection.setRemoteDescription(n))).then((()=>{s.succeeded&&s.succeeded(e)})).catch((e=>{u.call(this),m('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),this.emit("peerconnection:setremotedescriptionfailed",e)}))}else s.succeeded&&s.succeeded(e)}function u(e){s.failed&&s.failed(e)}t.push(`Contact: ${this._contact}`),this._sessionTimers.running&&t.push(`Session-Expires: ${this._sessionTimers.currentExpires};refresher=${this._sessionTimers.refresher?"uac":"uas"}`),o?(t.push("Content-Type: application/sdp"),this._connectionPromiseQueue=this._connectionPromiseQueue.then((()=>this._createLocalDescription("offer",r))).then((e=>{const s={originator:"local",type:"offer",sdp:e=this._mangleOffer(e)};p('emit "sdp"'),this.emit("sdp",s),this.sendRequest(n.UPDATE,{extraHeaders:t,body:e,eventHandlers:{onSuccessResponse:e=>{a.call(this,e),l=!0},onErrorResponse:e=>{u.call(this,e)},onTransportError:()=>{this.onTransportError()},onRequestTimeout:()=>{this.onRequestTimeout()},onDialogError:()=>{this.onDialogError()}}})})).catch((()=>{u.call(this)}))):this.sendRequest(n.UPDATE,{extraHeaders:t,eventHandlers:{onSuccessResponse:e=>{a.call(this,e)},onErrorResponse:e=>{u.call(this,e)},onTransportError:()=>{this.onTransportError()},onRequestTimeout:()=>{this.onRequestTimeout()},onDialogError:()=>{this.onDialogError()}}})}_acceptAndTerminate(e,t,s){p("acceptAndTerminate()");const r=[];t&&(s=s||n.REASON_PHRASE[t]||"",r.push(`Reason: SIP ;cause=${t}; text="${s}"`)),(this._dialog||this._createDialog(e,"UAC"))&&(this.sendRequest(n.ACK),this.sendRequest(n.BYE,{extraHeaders:r})),this._status=g.STATUS_TERMINATED}_mangleOffer(e){if(!this._localHold&&!this._remoteHold)return e;if(e=t.parse(e),this._localHold&&!this._remoteHold){p("mangleOffer() | me on hold, mangling offer");for(const t of e.media)-1!==T.indexOf(t.type)&&(t.direction?"sendrecv"===t.direction?t.direction="sendonly":"recvonly"===t.direction&&(t.direction="inactive"):t.direction="sendonly")}else if(this._localHold&&this._remoteHold){p("mangleOffer() | both on hold, mangling offer");for(const t of e.media)-1!==T.indexOf(t.type)&&(t.direction="inactive")}else if(this._remoteHold){p("mangleOffer() | remote on hold, mangling offer");for(const t of e.media)-1!==T.indexOf(t.type)&&(t.direction?"sendrecv"===t.direction?t.direction="recvonly":"recvonly"===t.direction&&(t.direction="inactive"):t.direction="recvonly")}return t.write(e)}_setLocalMediaStatus(){let e=!0,t=!0;(this._localHold||this._remoteHold)&&(e=!1,t=!1),this._audioMuted&&(e=!1),this._videoMuted&&(t=!1),this._toggleMuteAudio(!e),this._toggleMuteVideo(!t)}_handleSessionTimersInIncomingRequest(e,t){if(!this._sessionTimers.enabled)return;let s;e.session_expires&&e.session_expires>=n.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=e.session_expires,s=e.session_expires_refresher||"uas"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,s="uas"),t.push(`Session-Expires: ${this._sessionTimers.currentExpires};refresher=${s}`),this._sessionTimers.refresher="uas"===s,this._runSessionTimer()}_handleSessionTimersInIncomingResponse(e){if(!this._sessionTimers.enabled)return;let t;e.session_expires&&e.session_expires>=n.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=e.session_expires,t=e.session_expires_refresher||"uac"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,t="uac"),this._sessionTimers.refresher="uac"===t,this._runSessionTimer()}_runSessionTimer(){const e=this._sessionTimers.currentExpires;this._sessionTimers.running=!0,clearTimeout(this._sessionTimers.timer),this._sessionTimers.refresher?this._sessionTimers.timer=setTimeout((()=>{this._status!==g.STATUS_TERMINATED&&(p("runSessionTimer() | sending session refresh request"),this._sessionTimers.refreshMethod===n.UPDATE?this._sendUpdate():this._sendReinvite())}),500*e):this._sessionTimers.timer=setTimeout((()=>{this._status!==g.STATUS_TERMINATED&&(m("runSessionTimer() | timer expired, terminating the session"),this.terminate({cause:n.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))}),1100*e)}_toggleMuteAudio(e){const t=this._connection.getSenders().filter((e=>e.track&&"audio"===e.track.kind));for(const n of t)n.track.enabled=!e}_toggleMuteVideo(e){const t=this._connection.getSenders().filter((e=>e.track&&"video"===e.track.kind));for(const n of t)n.track.enabled=!e}_newRTCSession(e,t){p("newRTCSession()"),this._ua.newRTCSession(this,{originator:e,session:this,request:t})}_connecting(e){p("session connecting"),p('emit "connecting"'),this.emit("connecting",{request:e})}_progress(e,t){p("session progress"),p('emit "progress"'),this.emit("progress",{originator:e,response:t||null,session:this._request})}_accepted(e,t){p("session accepted"),this._start_time=new Date,p('emit "accepted"'),this.emit("accepted",{originator:e,response:t||null})}_confirmed(e,t){p("session confirmed"),this._is_confirmed=!0,p('emit "confirmed"'),this.emit("confirmed",{originator:e,ack:t||null})}_ended(e,t,n){p("session ended"),this._end_time=new Date,this._close(),p('emit "ended"'),this.emit("ended",{originator:e,message:t||null,cause:n})}_failed(e,t,n){p("session failed"),p('emit "_failed"'),this.emit("_failed",{originator:e,message:t||null,cause:n}),this._close(),p('emit "failed"'),this.emit("failed",{originator:e,message:t||null,cause:n})}_onhold(e){p("session onhold"),this._setLocalMediaStatus(),p('emit "hold"'),this.emit("hold",{originator:e})}_onunhold(e){p("session onunhold"),this._setLocalMediaStatus(),p('emit "unhold"'),this.emit("unhold",{originator:e})}_onmute({audio:e,video:t}){p("session onmute"),this._setLocalMediaStatus(),p('emit "muted"'),this.emit("muted",{audio:e,video:t})}_onunmute({audio:e,video:t}){p("session onunmute"),this._setLocalMediaStatus(),p('emit "unmuted"'),this.emit("unmuted",{audio:e,video:t})}},io}const uo=Dr.EventEmitter,co=or,ho=ni,fo=Ar(),_o=Ri,po=Tr,mo=Gr("JsSIP:Message");var go={};const To=Ar(),vo=Cr(),Eo=Gr("JsSIP:ERROR:Socket");Eo.log=console.warn.bind(console),go.isSocket=e=>{if(Array.isArray(e))return!1;if(void 0===e)return Eo("undefined JsSIP.Socket instance"),!1;try{if(!To.isString(e.url))throw Eo("missing or invalid JsSIP.Socket url property"),new Error;if(!To.isString(e.via_transport))throw Eo("missing or invalid JsSIP.Socket via_transport property"),new Error;if(-1===vo.parse(e.sip_uri,"SIP_URI"))throw Eo("missing or invalid JsSIP.Socket sip_uri property"),new Error}catch(e){return!1}try{["connect","disconnect","send"].forEach((t=>{if(!To.isFunction(e[t]))throw Eo(`missing or invalid JsSIP.Socket method: ${t}`),new Error}))}catch(e){return!1}return!0};const Co=go,So=Gr("JsSIP:Transport"),Ao=Gr("JsSIP:ERROR:Transport"),Ro=or;Ao.log=console.warn.bind(console);const yo=0,bo=1,wo=2,Io=0,Oo=1,No={min_interval:Ro.CONNECTION_RECOVERY_MIN_INTERVAL,max_interval:Ro.CONNECTION_RECOVERY_MAX_INTERVAL};var Do={};const Po=Cr(),xo=ni,Lo=Gr("JsSIP:ERROR:Parser");function Uo(e,t){let n=t,s=0,r=0;if(e.substring(n,n+2).match(/(^\r\n)/))return-2;for(;0===s;){if(r=e.indexOf("\r\n",n),-1===r)return r;!e.substring(r+2,r+4).match(/(^\r\n)/)&&e.charAt(r+2).match(/(^\s+)/)?n=r+2:s=r}return s}function ko(e,t,n,s){let r;const i=t.indexOf(":",n),o=t.substring(n,i).trim(),l=t.substring(i+1,s).trim();switch(o.toLowerCase()){case"via":case"v":e.addHeader("via",l),1===e.getHeaders("via").length?(r=e.parseHeader("Via"),r&&(e.via=r,e.via_branch=r.branch)):r=0;break;case"from":case"f":e.setHeader("from",l),r=e.parseHeader("from"),r&&(e.from=r,e.from_tag=r.getParam("tag"));break;case"to":case"t":e.setHeader("to",l),r=e.parseHeader("to"),r&&(e.to=r,e.to_tag=r.getParam("tag"));break;case"record-route":if(r=Po.parse(l,"Record_Route"),-1===r)r=void 0;else for(const t of r)e.addHeader("record-route",l.substring(t.possition,t.offset)),e.headers["Record-Route"][e.getHeaders("record-route").length-1].parsed=t.parsed;break;case"call-id":case"i":e.setHeader("call-id",l),r=e.parseHeader("call-id"),r&&(e.call_id=l);break;case"contact":case"m":if(r=Po.parse(l,"Contact"),-1===r)r=void 0;else for(const t of r)e.addHeader("contact",l.substring(t.possition,t.offset)),e.headers.Contact[e.getHeaders("contact").length-1].parsed=t.parsed;break;case"content-length":case"l":e.setHeader("content-length",l),r=e.parseHeader("content-length");break;case"content-type":case"c":e.setHeader("content-type",l),r=e.parseHeader("content-type");break;case"cseq":e.setHeader("cseq",l),r=e.parseHeader("cseq"),r&&(e.cseq=r.value),e instanceof xo.IncomingResponse&&(e.method=r.method);break;case"max-forwards":e.setHeader("max-forwards",l),r=e.parseHeader("max-forwards");break;case"www-authenticate":e.setHeader("www-authenticate",l),r=e.parseHeader("www-authenticate");break;case"proxy-authenticate":e.setHeader("proxy-authenticate",l),r=e.parseHeader("proxy-authenticate");break;case"session-expires":case"x":e.setHeader("session-expires",l),r=e.parseHeader("session-expires"),r&&(e.session_expires=r.expires,e.session_expires_refresher=r.refresher);break;case"refer-to":case"r":e.setHeader("refer-to",l),r=e.parseHeader("refer-to"),r&&(e.refer_to=r);break;case"replaces":e.setHeader("replaces",l),r=e.parseHeader("replaces"),r&&(e.replaces=r);break;case"event":case"o":e.setHeader("event",l),r=e.parseHeader("event"),r&&(e.event=r);break;default:e.addHeader(o,l),r=0}return void 0!==r||{error:`error parsing header "${o}"`}}Lo.log=console.warn.bind(console),Do.parseMessage=(e,t)=>{let n,s,r=e.indexOf("\r\n");if(-1===r)return void Lo("parseMessage() | no CRLF found, not a SIP message");const i=e.substring(0,r);let o=Po.parse(i,"Request_Response");if(-1===o)return void Lo(`parseMessage() | error parsing first line of SIP message: "${i}"`);o.status_code?(n=new xo.IncomingResponse,n.status_code=o.status_code,n.reason_phrase=o.reason_phrase):(n=new xo.IncomingRequest(t),n.method=o.method,n.ruri=o.uri),n.data=e;let l=r+2;for(;;){if(r=Uo(e,l),-2===r){s=l+2;break}if(-1===r)return void Lo("parseMessage() | malformed message");if(o=ko(n,e,l,r),!0!==o)return void Lo("parseMessage() |",o.error);l=r+2}if(n.hasHeader("content-length")){const t=n.getHeader("content-length");n.body=e.substr(s,t)}else n.body=e.substring(s);return n};const Mo=or,$o=ni,Fo=Ar(),qo=Gr("JsSIP:sanityCheck"),Ho=[function(){const e=["from","to","call_id","cseq","via"];for(const t of e)if(!Wo.hasHeader(t))return qo(`missing mandatory header field : ${t}, dropping the response`),!1}],jo=[function(){if("sip"!==Wo.s("to").uri.scheme)return Ko(416),!1},function(){if(!Wo.to_tag&&Wo.call_id.substr(0,5)===Go.configuration.jssip_id)return Ko(482),!1},function(){const e=Fo.str_utf8_length(Wo.body),t=Wo.getHeader("content-length");if(e<t)return Ko(400),!1},function(){const e=Wo.from_tag,t=Wo.call_id,n=Wo.cseq;let s;if(Wo.to_tag)return;if(Wo.method===Mo.INVITE){if(Go._transactions.ist[Wo.via_branch])return!1;for(const r in Go._transactions.ist)if(Object.prototype.hasOwnProperty.call(Go._transactions.ist,r)&&(s=Go._transactions.ist[r],s.request.from_tag===e&&s.request.call_id===t&&s.request.cseq===n))return Ko(482),!1}else{if(Go._transactions.nist[Wo.via_branch])return!1;for(const r in Go._transactions.nist)if(Object.prototype.hasOwnProperty.call(Go._transactions.nist,r)&&(s=Go._transactions.nist[r],s.request.from_tag===e&&s.request.call_id===t&&s.request.cseq===n))return Ko(482),!1}}],Bo=[function(){if(Wo.getHeaders("via").length>1)return qo("more than one Via header field present in the response, dropping the response"),!1},function(){const e=Fo.str_utf8_length(Wo.body),t=Wo.getHeader("content-length");if(e<t)return qo("message body length is lower than the value in Content-Length header field, dropping the response"),!1}];let Wo,Go,Vo;function Ko(e){const t=Wo.getHeaders("via");let n,s=`SIP/2.0 ${e} ${Mo.REASON_PHRASE[e]}\r\n`;for(const e of t)s+=`Via: ${e}\r\n`;n=Wo.getHeader("To"),Wo.to_tag||(n+=`;tag=${Fo.newTag()}`),s+=`To: ${n}\r\n`,s+=`From: ${Wo.getHeader("From")}\r\n`,s+=`Call-ID: ${Wo.call_id}\r\n`,s+=`CSeq: ${Wo.cseq} ${Wo.method}\r\n`,s+="\r\n",Vo.send(s)}var zo={};const Jo=Ar(),Xo=or,Yo=Cr(),Qo=Sr(),Zo=go,el=Tr;zo.settings={authorization_user:null,password:null,realm:null,ha1:null,display_name:null,uri:null,contact_uri:null,instance_id:null,use_preloaded_route:!1,session_timers:!0,session_timers_refresh_method:Xo.UPDATE,session_timers_force_refresher:!1,no_answer_timeout:60,register:!0,register_expires:600,registrar_server:null,sockets:null,connection_recovery_max_interval:Xo.CONNECTION_RECOVERY_MAX_INTERVAL,connection_recovery_min_interval:Xo.CONNECTION_RECOVERY_MIN_INTERVAL,via_host:`${Jo.createRandomToken(12)}.invalid`};const tl={mandatory:{sockets(e){const t=[];if(Zo.isSocket(e))t.push({socket:e});else{if(!Array.isArray(e)||!e.length)return;for(const n of e)Object.prototype.hasOwnProperty.call(n,"socket")&&Zo.isSocket(n.socket)?t.push(n):Zo.isSocket(n)&&t.push({socket:n})}return t},uri(e){/^sip:/i.test(e)||(e=`${Xo.SIP}:${e}`);const t=Qo.parse(e);return t&&t.user?t:void 0}},optional:{authorization_user:e=>-1===Yo.parse(`"${e}"`,"quoted_string")?void 0:e,authorization_jwt(e){if("string"==typeof e)return e},user_agent(e){if("string"==typeof e)return e},connection_recovery_max_interval(e){if(Jo.isDecimal(e)){const t=Number(e);if(t>0)return t}},connection_recovery_min_interval(e){if(Jo.isDecimal(e)){const t=Number(e);if(t>0)return t}},contact_uri(e){if("string"==typeof e){const t=Yo.parse(e,"SIP_URI");if(-1!==t)return t}},display_name:e=>e,instance_id:e=>(/^uuid:/i.test(e)&&(e=e.substr(5)),-1===Yo.parse(e,"uuid")?void 0:e),no_answer_timeout(e){if(Jo.isDecimal(e)){const t=Number(e);if(t>0)return t}},session_timers(e){if("boolean"==typeof e)return e},session_timers_refresh_method(e){if("string"==typeof e&&((e=e.toUpperCase())===Xo.INVITE||e===Xo.UPDATE))return e},session_timers_force_refresher(e){if("boolean"==typeof e)return e},password:e=>String(e),realm:e=>String(e),ha1:e=>String(e),register(e){if("boolean"==typeof e)return e},register_expires(e){if(Jo.isDecimal(e)){const t=Number(e);if(t>0)return t}},registrar_server(e){/^sip:/i.test(e)||(e=`${Xo.SIP}:${e}`);const t=Qo.parse(e);return t?t.user?void 0:t:void 0},use_preloaded_route(e){if("boolean"==typeof e)return e}}};zo.load=(e,t)=>{for(const n in tl.mandatory){if(!t.hasOwnProperty(n))throw new el.ConfigurationError(n);{const s=t[n],r=tl.mandatory[n](s);if(void 0===r)throw new el.ConfigurationError(n,s);e[n]=r}}for(const n in tl.optional)if(t.hasOwnProperty(n)){const s=t[n];if(Jo.isEmpty(s))continue;const r=tl.optional[n](s);if(void 0===r)throw new el.ConfigurationError(n,s);e[n]=r}};const nl=Dr.EventEmitter,sl=or,rl=class{constructor(e,t){this._ua=e,this._transport=t,this._registrar=e.configuration.registrar_server,this._expires=e.configuration.register_expires,this._call_id=yi.createRandomToken(22),this._cseq=0,this._to_uri=e.configuration.uri,this._registrationTimer=null,this._registering=!1,this._registered=!1,this._contact=this._ua.contact.toString(),this._contact+=";+sip.ice",this._extraHeaders=[],this._extraContactParams="",this._contact+=";reg-id=1",this._contact+=`;+sip.instance="<urn:uuid:${this._ua.configuration.instance_id}>"`}get registered(){return this._registered}setExtraHeaders(e){Array.isArray(e)||(e=[]),this._extraHeaders=e.slice()}setExtraContactParams(e){e instanceof Object||(e={}),this._extraContactParams="";for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];this._extraContactParams+=`;${t}`,n&&(this._extraContactParams+=`=${n}`)}}register(){if(this._registering)return void Oi("Register request in progress...");const e=this._extraHeaders.slice();e.push(`Contact: ${this._contact};expires=${this._expires}${this._extraContactParams}`),e.push(`Expires: ${this._expires}`);const t=new wi.OutgoingRequest(bi.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},e),n=new Ii(this._ua,t,{onRequestTimeout:()=>{this._registrationFailure(null,bi.causes.REQUEST_TIMEOUT)},onTransportError:()=>{this._registrationFailure(null,bi.causes.CONNECTION_ERROR)},onAuthenticated:()=>{this._cseq+=1},onReceiveResponse:e=>{if(e.cseq===this._cseq)switch(null!==this._registrationTimer&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):{if(this._registering=!1,!e.hasHeader("Contact")){Oi("no Contact header in response to REGISTER, response ignored");break}const t=e.headers.Contact.reduce(((e,t)=>e.concat(t.parsed)),[]).find((e=>e.uri.user===this._ua.contact.uri.user));if(!t){Oi("no Contact header pointing to us, response ignored");break}let n=t.getParam("expires");!n&&e.hasHeader("expires")&&(n=e.getHeader("expires")),n||(n=this._expires),n=Number(n),n<10&&(n=10);const s=n>64?1e3*n/2+Math.floor(1e3*(n/2-32)*Math.random()):1e3*n-5e3;this._registrationTimer=setTimeout((()=>{this._registrationTimer=null,0===this._ua.listeners("registrationExpiring").length?this.register():this._ua.emit("registrationExpiring")}),s),t.hasParam("temp-gruu")&&(this._ua.contact.temp_gruu=t.getParam("temp-gruu").replace(/"/g,"")),t.hasParam("pub-gruu")&&(this._ua.contact.pub_gruu=t.getParam("pub-gruu").replace(/"/g,"")),this._registered||(this._registered=!0,this._ua.registered({response:e}));break}case/^423$/.test(e.status_code):e.hasHeader("min-expires")?(this._expires=Number(e.getHeader("min-expires")),this._expires<10&&(this._expires=10),this.register()):(Oi("423 response received for REGISTER without Min-Expires"),this._registrationFailure(e,bi.causes.SIP_FAILURE_CODE));break;default:{const t=yi.sipErrorCause(e.status_code);this._registrationFailure(e,t)}}}});this._registering=!0,n.send()}unregister(e={}){if(!this._registered)return void Oi("already unregistered");this._registered=!1,null!==this._registrationTimer&&(clearTimeout(this._registrationTimer),this._registrationTimer=null);const t=this._extraHeaders.slice();e.all?t.push(`Contact: *${this._extraContactParams}`):t.push(`Contact: ${this._contact};expires=0${this._extraContactParams}`),t.push("Expires: 0");const n=new wi.OutgoingRequest(bi.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},t);new Ii(this._ua,n,{onRequestTimeout:()=>{this._unregistered(null,bi.causes.REQUEST_TIMEOUT)},onTransportError:()=>{this._unregistered(null,bi.causes.CONNECTION_ERROR)},onAuthenticated:()=>{this._cseq+=1},onReceiveResponse:e=>{switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):this._unregistered(e);break;default:{const t=yi.sipErrorCause(e.status_code);this._unregistered(e,t)}}}}).send()}close(){this._registered&&this.unregister()}onTransportClosed(){this._registering=!1,null!==this._registrationTimer&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),this._registered&&(this._registered=!1,this._ua.unregistered({}))}_registrationFailure(e,t){this._registering=!1,this._ua.registrationFailed({response:e||null,cause:t}),this._registered&&(this._registered=!1,this._ua.unregistered({response:e||null,cause:t}))}_unregistered(e,t){this._registering=!1,this._registered=!1,this._ua.unregistered({response:e||null,cause:t||null})}},il=ao(),ol=class extends uo{constructor(e){super(),this._ua=e,this._request=null,this._closed=!1,this._direction=null,this._local_identity=null,this._remote_identity=null,this._is_replied=!1,this._data={}}get direction(){return this._direction}get local_identity(){return this._local_identity}get remote_identity(){return this._remote_identity}send(e,t,n={}){const s=e;if(void 0===e||void 0===t)throw new TypeError("Not enough arguments");if(!(e=this._ua.normalizeTarget(e)))throw new TypeError(`Invalid target: ${s}`);const r=fo.cloneArray(n.extraHeaders),i=fo.cloneObject(n.eventHandlers),o=n.contentType||"text/plain";for(const e in i)Object.prototype.hasOwnProperty.call(i,e)&&this.on(e,i[e]);r.push(`Content-Type: ${o}`),this._request=new ho.OutgoingRequest(co.MESSAGE,e,this._ua,null,r),t&&(this._request.body=t);const l=new _o(this._ua,this._request,{onRequestTimeout:()=>{this._onRequestTimeout()},onTransportError:()=>{this._onTransportError()},onReceiveResponse:e=>{this._receiveResponse(e)}});this._newMessage("local",this._request),l.send()}init_incoming(e){this._request=e,this._newMessage("remote",e),this._is_replied||(this._is_replied=!0,e.reply(200)),this._close()}accept(e={}){const t=fo.cloneArray(e.extraHeaders),n=e.body;if("incoming"!==this._direction)throw new po.NotSupportedError('"accept" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");this._is_replied=!0,this._request.reply(200,null,t,n)}reject(e={}){const t=e.status_code||480,n=e.reason_phrase,s=fo.cloneArray(e.extraHeaders),r=e.body;if("incoming"!==this._direction)throw new po.NotSupportedError('"reject" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");if(t<300||t>=700)throw new TypeError(`Invalid status_code: ${t}`);this._is_replied=!0,this._request.reply(t,n,s,r)}_receiveResponse(e){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):this._succeeded("remote",e);break;default:{const t=fo.sipErrorCause(e.status_code);this._failed("remote",e,t);break}}}_onRequestTimeout(){this._closed||this._failed("system",null,co.causes.REQUEST_TIMEOUT)}_onTransportError(){this._closed||this._failed("system",null,co.causes.CONNECTION_ERROR)}_close(){this._closed=!0,this._ua.destroyMessage(this)}_newMessage(e,t){"remote"===e?(this._direction="incoming",this._local_identity=t.to,this._remote_identity=t.from):"local"===e&&(this._direction="outgoing",this._local_identity=t.from,this._remote_identity=t.to),this._ua.newMessage(this,{originator:e,message:this,request:t})}_failed(e,t,n){mo("MESSAGE failed"),this._close(),mo('emit "failed"'),this.emit("failed",{originator:e,response:t||null,cause:n})}_succeeded(e,t){mo("MESSAGE succeeded"),this._close(),mo('emit "succeeded"'),this.emit("succeeded",{originator:e,response:t})}},ll=Ti,al=class{constructor(e,t=No){if(So("new()"),this.status=wo,this.socket=null,this.sockets=[],this.recovery_options=t,this.recover_attempts=0,this.recovery_timer=null,this.close_requested=!1,void 0===e)throw new TypeError("Invalid argument. undefined 'sockets' argument");e instanceof Array||(e=[e]),e.forEach((function(e){if(!Co.isSocket(e.socket))throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance");if(e.weight&&!Number(e.weight))throw new TypeError("Invalid argument. 'weight' attribute is not a number");this.sockets.push({socket:e.socket,weight:e.weight||0,status:Io})}),this),this._getSocket()}get via_transport(){return this.socket.via_transport}get url(){return this.socket.url}get sip_uri(){return this.socket.sip_uri}connect(){So("connect()"),this.isConnected()?So("Transport is already connected"):this.isConnecting()?So("Transport is connecting"):(this.close_requested=!1,this.status=bo,this.onconnecting({socket:this.socket,attempts:this.recover_attempts}),this.close_requested||(this.socket.onconnect=this._onConnect.bind(this),this.socket.ondisconnect=this._onDisconnect.bind(this),this.socket.ondata=this._onData.bind(this),this.socket.connect()))}disconnect(){So("close()"),this.close_requested=!0,this.recover_attempts=0,this.status=wo,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.socket.onconnect=()=>{},this.socket.ondisconnect=()=>{},this.socket.ondata=()=>{},this.socket.disconnect(),this.ondisconnect({socket:this.socket,error:!1})}send(e){if(So("send()"),!this.isConnected())return Ao("unable to send message, transport is not connected"),!1;const t=e.toString();return So(`sending message:\n\n${t}\n`),this.socket.send(t)}isConnected(){return this.status===yo}isConnecting(){return this.status===bo}_reconnect(){this.recover_attempts+=1;let e=Math.floor(Math.random()*Math.pow(2,this.recover_attempts)+1);e<this.recovery_options.min_interval?e=this.recovery_options.min_interval:e>this.recovery_options.max_interval&&(e=this.recovery_options.max_interval),So(`reconnection attempt: ${this.recover_attempts}. next connection attempt in ${e} seconds`),this.recovery_timer=setTimeout((()=>{this.close_requested||this.isConnected()||this.isConnecting()||(this._getSocket(),this.connect())}),1e3*e)}_getSocket(){let e=[];if(this.sockets.forEach((t=>{t.status!==Oo&&(0===e.length?e.push(t):t.weight>e[0].weight?e=[t]:t.weight===e[0].weight&&e.push(t))})),0===e.length)return this.sockets.forEach((e=>{e.status=Io})),void this._getSocket();const t=Math.floor(Math.random()*e.length);this.socket=e[t].socket}_onConnect(){this.recover_attempts=0,this.status=yo,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.onconnect({socket:this})}_onDisconnect(e,t,n){this.status=wo,this.ondisconnect({socket:this.socket,error:e,code:t,reason:n}),this.close_requested||(this.sockets.forEach((function(e){this.socket===e.socket&&(e.status=Oo)}),this),this._reconnect(e))}_onData(e){if("\r\n"!==e){if("string"!=typeof e){try{e=String.fromCharCode.apply(null,new Uint8Array(e))}catch(e){return void So("received binary message failed to be converted into string, message discarded")}So(`received binary message:\n\n${e}\n`)}else So(`received text message:\n\n${e}\n`);this.ondata({transport:this,message:e})}else So("received message with CRLF Keep Alive response")}},ul=Ar(),cl=Tr,hl=Sr(),dl=Do,fl=ni,_l=(e,t,n)=>{Wo=e,Go=t,Vo=n;for(const e of Ho)if(!1===e())return!1;if(Wo instanceof $o.IncomingRequest){for(const e of jo)if(!1===e())return!1}else if(Wo instanceof $o.IncomingResponse)for(const e of Bo)if(!1===e())return!1;return!0},pl=zo,ml=Gr("JsSIP:UA"),gl=Gr("JsSIP:ERROR:UA");gl.log=console.warn.bind(console);const Tl={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};function vl(e){this.emit("connecting",e)}function El(e){this._status!==Tl.STATUS_USER_CLOSED&&(this._status=Tl.STATUS_READY,this._error=null,this.emit("connected",e),this._dynConfiguration.register&&this._registrator.register())}function Cl(e){const t=["nict","ict","nist","ist"];for(const e of t)for(const t in this._transactions[e])Object.prototype.hasOwnProperty.call(this._transactions[e],t)&&this._transactions[e][t].onTransportError();this.emit("disconnected",e),this._registrator.onTransportClosed(),this._status!==Tl.STATUS_USER_CLOSED&&(this._status=Tl.STATUS_NOT_READY,this._error=Tl.NETWORK_ERROR)}function Sl(e){const t=e.transport;let n=e.message;if(n=dl.parseMessage(n,this),n&&!(this._status===Tl.STATUS_USER_CLOSED&&n instanceof fl.IncomingRequest)&&_l(n,this,t))if(n instanceof fl.IncomingRequest)n.transport=t,this.receiveRequest(n);else if(n instanceof fl.IncomingResponse){let e;switch(n.method){case sl.INVITE:e=this._transactions.ict[n.via_branch],e&&e.receiveResponse(n);break;case sl.ACK:break;default:e=this._transactions.nict[n.via_branch],e&&e.receiveResponse(n)}}}const Al=Cr(),Rl=Gr("JsSIP:WebSocketInterface"),yl=Gr("JsSIP:ERROR:WebSocketInterface");yl.log=console.warn.bind(console);const bl=ir,wl=or,Il=Tr,Ol=Ar(),Nl=class extends nl{static get C(){return Tl}constructor(e){if(ml("new() [configuration:%o]",e),super(),this._cache={credentials:{}},this._configuration=Object.assign({},pl.settings),this._dynConfiguration={},this._dialogs={},this._applicants={},this._sessions={},this._transport=null,this._contact=null,this._status=Tl.STATUS_INIT,this._error=null,this._transactions={nist:{},nict:{},ist:{},ict:{}},this._data={},this._closeTimer=null,void 0===e)throw new TypeError("Not enough arguments");try{this._loadConfig(e)}catch(e){throw this._status=Tl.STATUS_NOT_READY,this._error=Tl.CONFIGURATION_ERROR,e}this._registrator=new rl(this)}get C(){return Tl}get status(){return this._status}get contact(){return this._contact}get configuration(){return this._configuration}get transport(){return this._transport}start(){ml("start()"),this._status===Tl.STATUS_INIT?this._transport.connect():this._status===Tl.STATUS_USER_CLOSED?(ml("restarting UA"),null!==this._closeTimer&&(clearTimeout(this._closeTimer),this._closeTimer=null,this._transport.disconnect()),this._status=Tl.STATUS_INIT,this._transport.connect()):this._status===Tl.STATUS_READY?ml("UA is in READY status, not restarted"):ml("ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this._dynConfiguration.register=this._configuration.register}register(){ml("register()"),this._dynConfiguration.register=!0,this._registrator.register()}unregister(e){ml("unregister()"),this._dynConfiguration.register=!1,this._registrator.unregister(e)}registrator(){return this._registrator}isRegistered(){return this._registrator.registered}isConnected(){return this._transport.isConnected()}call(e,t){ml("call()");const n=new il(this);return n.connect(e,t),n}sendMessage(e,t,n){ml("sendMessage()");const s=new ol(this);return s.send(e,t,n),s}terminateSessions(e){ml("terminateSessions()");for(const t in this._sessions)this._sessions[t].isEnded()||this._sessions[t].terminate(e)}stop(){if(ml("stop()"),this._dynConfiguration={},this._status===Tl.STATUS_USER_CLOSED)return void ml("UA already closed");this._registrator.close();const e=Object.keys(this._sessions).length;for(const e in this._sessions)if(Object.prototype.hasOwnProperty.call(this._sessions,e)){ml(`closing session ${e}`);try{this._sessions[e].terminate()}catch(e){}}for(const e in this._applicants)if(Object.prototype.hasOwnProperty.call(this._applicants,e))try{this._applicants[e].close()}catch(e){}this._status=Tl.STATUS_USER_CLOSED;0===Object.keys(this._transactions.nict).length+Object.keys(this._transactions.nist).length+Object.keys(this._transactions.ict).length+Object.keys(this._transactions.ist).length&&0===e?this._transport.disconnect():this._closeTimer=setTimeout((()=>{this._closeTimer=null,this._transport.disconnect()}),2e3)}normalizeTarget(e){return ul.normalizeTarget(e,this._configuration.hostport_params)}get(e){switch(e){case"authorization_user":return this._configuration.authorization_user;case"realm":return this._configuration.realm;case"ha1":return this._configuration.ha1;default:return void gl('get() | cannot get "%s" parameter in runtime',e)}}set(e,t){switch(e){case"authorization_user":this._configuration.authorization_user=String(t);break;case"password":this._configuration.password=String(t);break;case"realm":this._configuration.realm=String(t);break;case"ha1":this._configuration.ha1=String(t),this._configuration.password=null;break;case"display_name":this._configuration.display_name=t;break;default:return gl('set() | cannot set "%s" parameter in runtime',e),!1}return!0}newTransaction(e){this._transactions[e.type][e.id]=e,this.emit("newTransaction",{transaction:e})}destroyTransaction(e){delete this._transactions[e.type][e.id],this.emit("transactionDestroyed",{transaction:e})}newDialog(e){this._dialogs[e.id]=e}destroyDialog(e){delete this._dialogs[e.id]}newMessage(e,t){this._applicants[e]=e,this.emit("newMessage",t)}destroyMessage(e){delete this._applicants[e]}newRTCSession(e,t){this._sessions[e.id]=e,this.emit("newRTCSession",t)}destroyRTCSession(e){delete this._sessions[e.id]}registered(e){this.emit("registered",e)}unregistered(e){this.emit("unregistered",e)}registrationFailed(e){this.emit("registrationFailed",e)}receiveRequest(e){const t=e.method;if(e.ruri.user!==this._configuration.uri.user&&e.ruri.user!==this._contact.uri.user)return ml("Request-URI does not point to us"),void(e.method!==sl.ACK&&e.reply_sl(404));if(e.ruri.scheme===sl.SIPS)return void e.reply_sl(416);if(ll.checkTransaction(this,e))return;if(t===sl.INVITE?new ll.InviteServerTransaction(this,this._transport,e):t!==sl.ACK&&t!==sl.CANCEL&&new ll.NonInviteServerTransaction(this,this._transport,e),t===sl.OPTIONS)e.reply(200);else if(t===sl.MESSAGE){if(0===this.listeners("newMessage").length)return void e.reply(405);new ol(this).init_incoming(e)}else if(t===sl.INVITE&&!e.to_tag&&0===this.listeners("newRTCSession").length)return void e.reply(405);let n,s;if(e.to_tag)n=this._findDialog(e.call_id,e.from_tag,e.to_tag),n?n.receiveRequest(e):t===sl.NOTIFY?(s=this._findSession(e),s?s.receiveRequest(e):(ml("received NOTIFY request for a non existent subscription"),e.reply(481,"Subscription does not exist"))):t!==sl.ACK&&e.reply(481);else switch(t){case sl.INVITE:if(window.RTCPeerConnection)if(e.hasHeader("replaces")){const t=e.replaces;n=this._findDialog(t.call_id,t.from_tag,t.to_tag),n?(s=n.owner,s.isEnded()?e.reply(603):s.receiveRequest(e)):e.reply(481)}else s=new il(this),s.init_incoming(e);else gl("INVITE received but WebRTC is not supported"),e.reply(488);break;case sl.BYE:e.reply(481);break;case sl.CANCEL:s=this._findSession(e),s?s.receiveRequest(e):ml("received CANCEL request for a non existent session");break;case sl.ACK:break;case sl.NOTIFY:this.emit("sipEvent",{event:e.event,request:e}),e.reply(200);break;default:e.reply(405)}}_findSession({call_id:e,from_tag:t,to_tag:n}){const s=e+t,r=this._sessions[s],i=e+n,o=this._sessions[i];return r||(o||null)}_findDialog(e,t,n){let s=e+t+n,r=this._dialogs[s];return r||(s=e+n+t,r=this._dialogs[s],r||null)}_loadConfig(e){try{pl.load(this._configuration,e)}catch(e){throw e}0===this._configuration.display_name&&(this._configuration.display_name="0"),this._configuration.instance_id||(this._configuration.instance_id=ul.newUUID()),this._configuration.jssip_id=ul.createRandomToken(5);const t=this._configuration.uri.clone();t.user=null,this._configuration.hostport_params=t.toString().replace(/^sip:/i,"");try{this._transport=new al(this._configuration.sockets,{max_interval:this._configuration.connection_recovery_max_interval,min_interval:this._configuration.connection_recovery_min_interval}),this._transport.onconnecting=vl.bind(this),this._transport.onconnect=El.bind(this),this._transport.ondisconnect=Cl.bind(this),this._transport.ondata=Sl.bind(this)}catch(e){throw gl(e),new cl.ConfigurationError("sockets",this._configuration.sockets)}if(delete this._configuration.sockets,this._configuration.authorization_user||(this._configuration.authorization_user=this._configuration.uri.user),!this._configuration.registrar_server){const e=this._configuration.uri.clone();e.user=null,e.clearParams(),e.clearHeaders(),this._configuration.registrar_server=e}this._configuration.no_answer_timeout*=1e3,this._configuration.contact_uri?this._configuration.via_host=this._configuration.contact_uri.host:this._configuration.contact_uri=new hl("sip",ul.createRandomToken(8),this._configuration.via_host,null,{transport:"ws"}),this._contact={pub_gruu:null,temp_gruu:null,uri:this._configuration.contact_uri,toString(e={}){const t=e.anonymous||null,n=e.outbound||null;let s="<";return s+=t?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),n&&(t?this.temp_gruu:this.pub_gruu),s+=">",s}};const n=["authorization_user","password","realm","ha1","display_name","register"];for(const e in this._configuration)Object.prototype.hasOwnProperty.call(this._configuration,e)&&(-1!==n.indexOf(e)?Object.defineProperty(this._configuration,e,{writable:!0,configurable:!1}):Object.defineProperty(this._configuration,e,{writable:!1,configurable:!1}));ml("configuration parameters after validation:");for(const e in this._configuration)if(Object.prototype.hasOwnProperty.call(pl.settings,e))switch(e){case"uri":case"registrar_server":ml(`- ${e}: ${this._configuration[e]}`);break;case"password":case"ha1":ml(`- ${e}: NOT SHOWN`);break;default:ml(`- ${e}: ${JSON.stringify(this._configuration[e])}`)}}},Dl=Sr(),Pl=Er(),xl=Cr(),Ll=class{constructor(e){Rl('new() [url:"%s"]',e),this._url=e,this._sip_uri=null,this._via_transport=null,this._ws=null;const t=Al.parse(e,"absoluteURI");if(-1===t)throw yl(`invalid WebSocket URI: ${e}`),new TypeError(`Invalid argument: ${e}`);if("wss"!==t.scheme&&"ws"!==t.scheme)throw yl(`invalid WebSocket URI scheme: ${t.scheme}`),new TypeError(`Invalid argument: ${e}`);this._sip_uri=`sip:${t.host}${t.port?`:${t.port}`:""};transport=ws`,this._via_transport=t.scheme.toUpperCase()}get via_transport(){return this._via_transport}set via_transport(e){this._via_transport=e.toUpperCase()}get sip_uri(){return this._sip_uri}get url(){return this._url}connect(){if(Rl("connect()"),this.isConnected())Rl(`WebSocket ${this._url} is already connected`);else if(this.isConnecting())Rl(`WebSocket ${this._url} is connecting`);else{this._ws&&this.disconnect(),Rl(`connecting to WebSocket ${this._url}`);try{this._ws=new WebSocket(this._url,"sip"),this._ws.binaryType="arraybuffer",this._ws.onopen=this._onOpen.bind(this),this._ws.onclose=this._onClose.bind(this),this._ws.onmessage=this._onMessage.bind(this),this._ws.onerror=this._onError.bind(this)}catch(e){this._onError(e)}}}disconnect(){Rl("disconnect()"),this._ws&&(this._ws.onopen=()=>{},this._ws.onclose=()=>{},this._ws.onmessage=()=>{},this._ws.onerror=()=>{},this._ws.close(),this._ws=null)}send(e){return Rl("send()"),this.isConnected()?(this._ws.send(e),!0):(yl("unable to send message, WebSocket is not open"),!1)}isConnected(){return this._ws&&this._ws.readyState===this._ws.OPEN}isConnecting(){return this._ws&&this._ws.readyState===this._ws.CONNECTING}_onOpen(){Rl(`WebSocket ${this._url} connected`),this.onconnect()}_onClose({wasClean:e,code:t,reason:n}){Rl(`WebSocket ${this._url} closed`),!1===e&&Rl("WebSocket abrupt disconnection");const s={socket:this,error:!e,code:t,reason:n};this.ondisconnect(s)}_onMessage({data:e}){Rl("received WebSocket message"),this.ondata(e)}_onError(e){yl(`WebSocket ${this._url} error: ${e}`)}};Gr("JsSIP")("version %s",bl.version);var Ul={C:wl,Exceptions:Il,Utils:Ol,UA:Nl,URI:Dl,NameAddrHeader:Pl,WebSocketInterface:Ll,Grammar:xl,debug:Gr,get name(){return bl.title},get version(){return bl.version}};class kl{constructor(e,t=1e3){this.startTime=0,this.lastTime=0,this.frameId=0,this.onTickStep=1e3,this.counter=0,this.start=()=>{this.startTime=Date.now(),this.lastTime=this.startTime,this.frameId=null===requestAnimationFrame||void 0===requestAnimationFrame?void 0:requestAnimationFrame(this.tick.bind(this))},this.stop=()=>{null===cancelAnimationFrame||void 0===cancelAnimationFrame||cancelAnimationFrame(this.frameId)},this.tick=()=>{const e=Date.now(),t=e-this.lastTime;this.lastTime=e,this.counter+=t;const n=this.counter/this.onTickStep;this.onTick&&n>1&&(this.counter=0,this.onTick({second:this.lastTime-this.startTime/1e3,elapsedTime:t,lastTime:this.lastTime,startTime:this.startTime,duration:this.lastTime-this.startTime})),this.frameId=requestAnimationFrame(this.tick.bind(this))},this.onTick=e,this.onTickStep=t<=0?1e3:t}}const Ml=["audio","video"],$l=e=>Wr(e),Fl=e=>{var t;const n=$l(e);let s="audio",r=0,i="inactive";for(const e of n.media)-1!==Ml.indexOf(e.type)&&"audio"!==e.type&&(s=e.type,r=e.port,i=null!==(t=e.direction)&&void 0!==t?t:"inactive");return"video"===s&&r&&["sendrecv","sendonly","recvonly"].includes(i)?"video":"audio"};var ql,Hl,jl,Bl,Wl,Gl,Vl,Kl,zl,Jl,Xl,Yl,Ql,Zl,ea,ta,na,sa,ra,ia,oa,la={INFO:"INFO",RFC2833:"RFC2833"};function aa(e){e.forEach((e=>{"talking"!==e.status.callStatus||e.status.isHold||e.hold()}))}function ua(e,t){return r(this,void 0,void 0,(function*(){try{const{data:n}=yield Is({ext_num:e});if(0===n.errcode){if(!n.photo)return null;const e=Wt.get("pbxURL").origin;return e+"/api/photo/"+n.photo}return Gt.error(`${t}Get avatar server error. Error code: ${n.errcode}, Error message: ${n.errmsg}`),null}catch(e){return Gt.error(`${t}Get avatar failed.`,e),null}}))}function ca(e,t){return r(this,void 0,void 0,(function*(){try{const{data:n}=yield Os({number:e});return 0===n.errcode?n.name:(Gt.error(`${t}Get contact name server error. Error code: ${n.errcode}, Error message: ${n.errmsg}`),null)}catch(e){return Gt.error(`${t}Get contact name failed.`,e),null}}))}function ha(e,t){let n=0,s=0,r=0;return t.forEach((e=>{"ringing"===e.status.callStatus||"calling"===e.status.callStatus?n++:"connecting"===e.status.callStatus?r++:s++})),(0!==s||0!==n)&&(n>0||"call"===e&&r>0)}function da(e,t){if(!e&&t.size>0)return!0;let n=0,s=0;return t.forEach((e=>{const{status:t}=e;t.isRing?n++:!1===t.isTransfer&&s++})),n+s>=2}function fa(e){const t=new Date;return $t({lksTimestamp:t.getTime().toString(),lksDate:Ft(t),callId:"",extension:"",iceResult:"0",lksNetworkType:"0",lksDeviceType:"web",lksDuration:"0",lksAudioCodec:"0",lksAudioRx:"0",lksAudioRxLost:"0",lksAudioRxMaxjitter:"0",lksAudioRxAvgjitter:"0",lksAudioTx:"0",lksAudioTxLost:"0",lksAudioTxMaxjitter:"0",lksAudioTxAvgjitter:"0",lksVideoCodec:"0",lksVideoRx:"0",lksVideoRxLost:"0",lksVideoRxMaxjitter:"0",lksVideoRxAvgjitter:"0",lksVideoTx:"0",lksVideoTxLost:"0",lksVideoTxMaxjitter:"0",lksVideoTxAvgjitter:"0"},e||{})}const _a="[session] ";class pa extends Bs.EventEmitter{constructor(e,t,n){super(),ql.set(this,void 0),Hl.set(this,void 0),jl.set(this,void 0),Bl.set(this,new MediaStream),Wl.set(this,new MediaStream),Gl.set(this,void 0),this.emitEvent=(e,...t)=>(this.emit(e,...t),!0),Vl.set(this,null),Kl.set(this,(()=>{i(this,Vl,"f")||(Gt.info(`${_a}Start update call report interval.`),o(this,Vl,setInterval((()=>{i(this,zl,"f").call(this)}),3e3),"f"))})),zl.set(this,(()=>r(this,void 0,void 0,(function*(){try{const e=function(e){const t={};return e.forEach((n=>{if("inbound-rtp"===n.type&&"audio"===n.kind){n.totalSamplesDuration&&(t.lksDuration=Math.ceil(n.totalSamplesDuration)+"");const s=n.codecId,r=e.get(s),i=r?r.mimeType.replace("audio/","").toLowerCase():"",o=n.packetsReceived,l=n.packetsLost,a=1e3*n.jitter;t.lksAudioCodec=i,t.lksAudioRx=o+"",l>0&&(t.lksAudioRxLost=(l/(l+o)).toFixed(6)+""),t.lksAudioRxAvgjitter=a+""}if("outbound-rtp"===n.type&&"audio"===n.kind){const e=n.packetsSent;t.lksAudioTx=e+""}if("candidate-pair"===n.type&&"succeeded"===n.state){const s=n.remoteCandidateId,r=e.get(s).candidateType,i=n.localCandidateId,o=e.get(i).networkType;let l="";"host"===r?l="local":"srflx"===r||"prflx"===r?l="public":"relay"===r&&(l="turn"),t.iceResult=l,t.lksNetworkType=o}if("inbound-rtp"===n.type&&"video"===n.kind&&n.codecId){const s=n.codecId,r=e.get(s),i=r?r.mimeType.replace("video/","").toLowerCase():"",o=n.packetsReceived,l=n.packetsLost;t.lksVideoCodec=i,t.lksVideoRx=o+"",t.lksVideoRxLost=(l/(l+o)).toFixed(6)+""}if("outbound-rtp"===n.type&&"video"===n.kind){const e=n.packetsSent;t.lksVideoTx=e+""}})),t}(yield this.RTCSession.connection.getStats());this.callReport=$t(this.callReport,e),this.emitEvent("callReport",{callId:i(this,ql,"f").callId,callReport:this.callReport})}catch(e){Gt.error(`${_a}Get WebRTC stats error. `,e)}})))),Jl.set(this,(e=>{this.RTCSession.connection.ontrack=t=>{const n=t.track.kind;Gt.info(`${_a}On remote track, track kind: ${n}`);const s=new MediaStream(this.remoteStream);"video"===n?(t.track.enabled=!1,s.getVideoTracks().forEach((e=>{s.removeTrack(e)}))):s.getAudioTracks().forEach((e=>{s.removeTrack(e)})),t.streams.forEach((t=>{const n=t.getAudioTracks();n.length>0&&n.forEach((t=>{s.addTrack(t),Gt.info(`${_a}${e} remote stream add audio track.`)}));const r=t.getAudioTracks();r.length>0&&r.forEach((t=>{s.addTrack(t),Gt.info(`${_a}${e} remote stream add video track.`)}))})),this.remoteStream=s,this.emitEvent("streamAdded",{callId:i(this,ql,"f").callId,communicationType:e,stream:this.remoteStream})}})),Xl.set(this,(()=>{if(i(this,jl,"f").stop(),i(this,Vl,"f")&&clearInterval(i(this,Vl,"f")),"talking"!==i(this,ql,"f").callStatus)return;const e=Wt.get("showCloudPlan"),t=Wt.get("fqdnStatus");var n;e||"connected"!==t||(n=Mt(this.callReport),ys.post("/v1.0/rascallreport/web",n)).catch((e=>{Gt.error(`${_a}call report failed.`)}))})),Yl.set(this,(()=>{this.localStream.getTracks().forEach((e=>{e.stop(),this.localStream.removeTrack(e)})),this.localStream=null,this.remoteStream.getTracks().forEach((e=>{e.stop(),this.remoteStream.removeTrack(e)})),this.remoteStream=null,Gt.info(`${_a}remove stream.`)})),Ql.set(this,(()=>{var e,t;this.RTCSession.hasOwnProperty("_connection")&&(null===(t=null===(e=this.RTCSession._connection)||void 0===e?void 0:e.close)||void 0===t||t.call(e),this.RTCSession._connection=null),Gt.info(`${_a}close rtc peer connection.`)})),Zl.set(this,(()=>{let e="";for(const[t,n]of i(this,Gl,"f").sessions)if(e=t,n.status.isTransfer)break;i(this,Gl,"f").setCurrentSession(e)})),ea.set(this,((e,t,n)=>{Gt.info(`${_a}end Session. Type: ${e}, Cause: ${t}`),this.stopTimer(),i(this,Xl,"f").call(this),i(this,Yl,"f").call(this),i(this,Ql,"f").call(this),"ended"===e?this.emitEvent("ended",{callId:i(this,ql,"f").callId,cause:t}):"failed"===e?this.emitEvent("failed",{callId:i(this,ql,"f").callId,cause:t,code:n}):this.emitEvent("clientError",{callId:i(this,ql,"f").callId,cause:t}),this.RTCSession=null,this.removeAllListeners(),i(this,Gl,"f").sessions.delete(i(this,ql,"f").callId),i(this,Zl,"f").call(this),i(this,Gl,"f").emitEvent("deleteSession",{callId:i(this,ql,"f").callId,cause:t})})),ta.set(this,null),na.set(this,((e,t,n)=>{if("local"===e)return n;const s=Fl(n),{isVideo:r,callStatus:o}=i(this,ql,"f");if("offer"===t){if("video"!==s||r)return n;if("talking"!==o){Gt.info(`${_a}Video call, audio answer. Change the sdp to audio`);const e="m=video",t=e.length,s=n.indexOf(e),r=n.substring(s+t).replace(/a=sendrecv|a=sendonly|a=recvonly/g,"a=inactive"),i=n.substring(0,s)+e+r;return n=i}}else"answer"===t&&r&&"audio"===s&&(this.status={isVideo:!1});return n})),sa.set(this,((e,t,n)=>r(this,void 0,void 0,(function*(){const s={};if(e){Gt.info(`${_a}Has Remote-Party-ID.`);const{remoteName:t,remoteNumber:r}=function(e,t,n){let s,r;if(e.indexOf('" <sip:')>-1){const t=e.split('" <sip:');s=t[0].slice(1);const n=t[1].indexOf("@");r=t[1].substring(0,n)}else if(e.indexOf("@")>-1){const t=e.indexOf("@");r=e.substring(5,t)}return s=s||r,{remoteName:s||n||t,remoteNumber:r||t}}(e,this.status.number,this.status.name);if(s.name=t,s.number=r,r!==i(this,ql,"f").number){const e=yield ua(r,_a);if(Gt.info(`${_a}Change number and get avatar.`),e&&(s.avatar=e),n){const e=yield ca(r,_a);Gt.info(`${_a}Change number and get contact name.`),e&&(s.name=e)}}}this.status=Object.assign(Object.assign({},s),{callStatus:t})})))),ra.set(this,(e=>r(this,void 0,void 0,(function*(){const{request:t}=e;(e=>{const t=$l(e);for(const e of t.media)if(-1!==Ml.indexOf(e.type)&&"video"!==e.type)return!e.direction||"recvonly"===e.direction;return!1})(t.body)&&(this.status.isHold=!0);const n=t.from.display_name,s=t.getHeader("Remote-Party-Id");i(this,sa,"f").call(this,s,"talking",!n||void 0),Wt.get("videoPlan");const r="video"===Fl(t.body);i(this,ql,"f").isVideo!==r&&(r?(yield new Promise(((e,t)=>{setTimeout((()=>{e()}),2500)})),this.renegotiate(!1),this.status={isVideo:!1}):this.status={isVideo:!1}),Gt.info(`${_a}reinvite.`),this.emitEvent("reinvite",{callId:i(this,ql,"f").callId,session:this,isInviteVideo:r})})))),ia.set(this,(()=>("outbound"===i(this,ql,"f").communicationType&&i(this,Jl,"f").call(this,i(this,ql,"f").communicationType),this.RTCSession.on("accepted",(e=>r(this,void 0,void 0,(function*(){const t=i(this,ql,"f").callId;if(Gt.info(`${_a}Call accepted.Call ID: ${t}`),"remote"===e.originator){Gt.info(`${_a}Originator is remote.`);const t=e.response.getHeader("Remote-Party-ID");i(this,sa,"f").call(this,t,"talking")}this.emitEvent("accepted",{callId:t,session:this}),this.callReport=fa({extension:i(this,ql,"f").number,callId:i(this,ql,"f").callId}),i(this,zl,"f").call(this),i(this,Kl,"f").call(this)})))),this.RTCSession.on("confirmed",(e=>{const t=this.RTCSession.connection.getSenders(),n=new MediaStream;t.forEach((e=>{var t;"video"===(null===(t=e.track)||void 0===t?void 0:t.kind)&&(n.addTrack(e.track),this.localStream=n)})),this.status={callStatus:"talking"},i(this,Gl,"f").setCurrentSession(i(this,ql,"f").callId),this.emitEvent("confirmed",{callId:i(this,ql,"f").callId,session:this})})),this.RTCSession.on("icecandidate",(e=>{i(this,ta,"f")&&clearTimeout(i(this,ta,"f")),o(this,ta,setTimeout((()=>{e.ready(),Gt.info(`${_a}stop icecandidate gathered.`)}),2e3),"f")})),this.RTCSession.on("sdp",(e=>{const{originator:t,type:n,sdp:s}=e;Gt.info(`${_a}Got sdp.`,t,n);const r=i(this,na,"f").call(this,t,n,s);e.sdp=r,this.emitEvent("sdp",{callId:i(this,ql,"f").callId,originator:t,type:n,sdp:r})})),this.RTCSession.on("peerconnection",(()=>{"outbound"!==i(this,ql,"f").communicationType&&(i(this,Jl,"f").call(this,i(this,ql,"f").communicationType),this.status.isRing=!1,i(this,Gl,"f").emitEvent("startSession",{callId:i(this,ql,"f").callId,session:this}))})),this.RTCSession.on("progress",(e=>r(this,void 0,void 0,(function*(){if("local"===e.originator)return;const{response:t}=e,n=t.status_code,s=t.getHeader("Remote-Party-ID");180!==n&&183!==n||i(this,sa,"f").call(this,s,"ringing"),Gt.info(`${_a}Progress originator: ${e.originator}`),this.emitEvent("progress",{callId:i(this,ql,"f").callId,statusCode:t.status_code})})))),this.RTCSession.on("ended",(e=>{var t;t=this.status.callId,i(this,Gl,"f").sessions.forEach((e=>{const n=e.status.transferParent;n&&n.callId===t&&e.terminate()})),i(this,ea,"f").call(this,"ended",e.cause)})),this.RTCSession.on("failed",(e=>{var t;const n=null===(t=e.message)||void 0===t?void 0:t.status_code;i(this,ea,"f").call(this,"failed",e.cause,n)})),this.RTCSession.on("getusermediafailed",(()=>{this.RTCSession.isEnded()&&i(this,ea,"f").call(this,"clientError","getusermediafailed")})),this.RTCSession.on("peerconnection:createanswerfailed",(()=>{this.RTCSession.isEnded()&&i(this,ea,"f").call(this,"clientError","peerconnection:createanswerfailed")})),this.RTCSession.on("peerconnection:createofferfailed",(()=>{this.RTCSession.isEnded()&&i(this,ea,"f").call(this,"clientError","peerconnection:createofferfailed")})),this.RTCSession.on("peerconnection:setlocaldescriptionfailed",(()=>{this.RTCSession.isEnded()&&i(this,ea,"f").call(this,"clientError","peerconnection:setlocaldescriptionfailed")})),this.RTCSession.on("peerconnection:setremotedescriptionfailed",(()=>{this.RTCSession.isEnded()&&i(this,ea,"f").call(this,"clientError","peerconnection:setremotedescriptionfailed")})),this.RTCSession.on("reinvite",i(this,ra,"f")),this.RTCSession.on("hold",(()=>{this.status={isHold:!0}})),this.RTCSession.on("unhold",(()=>{this.status={isHold:!1},i(this,Gl,"f").sessions.forEach((e=>{e.status.callId!==this.status.callId&&!0!==e.status.isHold&&e.hold()}))})),this.RTCSession.on("muted",(()=>{this.status={isMute:!0}})),this.RTCSession.on("unmuted",(()=>{this.status={isMute:!1}})),this))),this.stopTimer=()=>(i(this,jl,"f").stop(),this),this.on=(e,t)=>this.addListener(e,t),this.reject=()=>{this.terminate("reject")},oa.set(this,(e=>r(this,void 0,void 0,(function*(){var t,n,s,r;const{fqdnDomain:o,cloudDomain:l,showCloudPlan:a,enableNatFqdn:u,turnPort:c}=Wt.get(),h=null===(n=null===(t=this.RTCSession)||void 0===t?void 0:t._sessionTimers)||void 0===n?void 0:n.enabled,d=(null===(s=i(this,Gl,"f").deviceIds)||void 0===s?void 0:s.microphoneId)||void 0,f=(null===(r=i(this,Gl,"f").deviceIds)||void 0===r?void 0:r.cameraId)||void 0,_=yield Ht(!!(null==e?void 0:e.video),d,f);if(null===_)return Promise.reject(Hs.error("GET_LOCAL_MEDIA_INFO_ERROR"));if(_.isNoneAudio)return Promise.reject(Hs.error("NOT_FOUND_AUDIO_INPUT_DEVICE"));const{mediaConstraints:p,isNoneCamera:m}=_,g=(null==e?void 0:e.video)?"video":"audio";if("video"===g&&m)return Promise.reject(Hs.error("NOT_FOUND_VIDEO_INPUT_DEVICE"));if(!1===(yield jt(g)))return Promise.reject(Hs.error("GET_AGREE_CHROME_USER_MEDIA_ROLE_ERROR"));const T={mediaConstraints:p,rtcOfferConstraints:{offerToReceiveAudio:!0,offerToReceiveVideo:(null==e?void 0:e.offerToReceiveVideo)||!1},sessionTimersExpires:1800};return h&&(T.sessionTimersExpires=1800,T.extraHeaders=["Require: timer"]),a?T.pcConfig={iceServers:[{urls:[`stun:${l}:${c}`]}]}:1===u&&o&&(T.pcConfig={iceServers:[{urls:[`stun:${o}:${c}`]}]}),Gt.info(_a+"Answer option is:",T),T})))),this.answer=e=>r(this,void 0,void 0,(function*(){if(ha("answer",i(this,Gl,"f").sessions))return Gt.info(_a+"This operator has refused because the current call has not been connected."),Promise.reject(Hs.error("CURRENT_CALL_HAS_NOT_CONNECTED"));try{const t=yield i(this,oa,"f").call(this,e);aa(i(this,Gl,"f").sessions);let n=!1;return(null==e?void 0:e.video)&&(n=!0),this.status={isVideo:n},this.RTCSession.answer(t),Hs.success("SUCCESS")}catch(e){return Promise.reject(e)}})),this.hangup=()=>{this.terminate("hangup")},this.blindTransfer=e=>{i(this,Gl,"f").blindTransfer(this.status.callId,e)},this.attendedTransfer=e=>{i(this,Gl,"f").attendedTransfer(this.status.callId,e)},this.hold=()=>(this.RTCSession.hold(),Gt.info(`${_a}Hold the call, Call ID: ${i(this,ql,"f").callId}`),!0),this.unhold=()=>(this.RTCSession._rtcOfferConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:t.isVideo},this.RTCSession.unhold(),Gt.info(`${_a}Unhold the call, Call ID: ${i(this,ql,"f").callId}`),!0),this.dtmf=e=>{const t={interToneGap:100,transportType:la.RFC2833};this.RTCSession.sendDTMF(e,t),Gt.info(`${_a}Send DTMF to call ID: ${i(this,ql,"f").callId}, DTMF Number: ${e}`)},this.mute=()=>{this.RTCSession.mute({audio:!0}),Gt.info(`${_a}Mute call. Call ID: ${i(this,ql,"f").callId}`)},this.unmute=()=>{this.RTCSession.unmute({audio:!0}),Gt.info(`${_a}Unmute call. Call ID: ${i(this,ql,"f").callId}`)},this.startRecord=()=>{if(0===i(this,Gl,"f").recordPermissions)return void Gt.info(`${_a}Not permission.`);i(this,ql,"f").isConference&&(this.status.recordStatus="recording");const e=Wt.get("recordCode");this.dtmf(e)},this.pauseRecord=()=>{if(0===i(this,Gl,"f").recordPermissions)return void Gt.info(`${_a}Not permission.`);i(this,ql,"f").isConference&&(this.status.recordStatus="pause");const e=Wt.get("recordCode");this.dtmf(e)},this.terminate=(e="terminate")=>{this.RTCSession.terminate({status_code:Number([0,1,2].includes(this.RTCSession.status)?"487":"486")}),Gt.info(`${_a}${e} call. Call ID: ${i(this,ql,"f").callId}`)},this.renegotiate=e=>{const t={useUpdate:!1,rtcOfferConstraints:{offerToReceiveAudio:!0,offerToReceiveVideo:e||!1}};return this.RTCSession._rtcOfferConstraints=t.rtcOfferConstraints,this.RTCSession.renegotiate(t),Gt.info(`${_a}Renegotiate call, Call ID: ${i(this,ql,"f").callId}, offerToReceiveVideo: ${e}`),!0},this.audioToVideo=e=>{const{videoTrack:t}={audioTrack:(n=null!=e?e:new MediaStream).getAudioTracks(),videoTrack:n.getVideoTracks()};var n;this.localStream.getVideoTracks().forEach((e=>{e.stop()})),this.RTCSession.connection.addTrack(t[0],this.localStream),Gt.info(`${_a}Change audio to video. Call ID: ${i(this,ql,"f").callId}`)},this.videoToAudio=()=>{const{connection:e}=this.RTCSession,t=e.getSenders();this.localStream.getVideoTracks().forEach((e=>{e.stop(),this.localStream.removeTrack(e)})),t.forEach((t=>{var n;"video"===(null===(n=t.track)||void 0===n?void 0:n.kind)&&e.removeTrack(t)})),Gt.info(`${_a}Change video to audio. Call ID: ${i(this,ql,"f").callId}`)},this.setStatus=e=>(o(this,ql,$t(i(this,ql,"f"),e),"f"),this),this.destroy=()=>{var e,t,n;this.removeAllListeners(),i(this,jl,"f").stop(),i(this,Vl,"f")&&clearInterval(i(this,Vl,"f")),null===(n=null===(t=null===(e=this.RTCSession)||void 0===e?void 0:e.connection)||void 0===t?void 0:t.close)||void 0===n||n.call(t)},this.RTCSession=e,o(this,ql,t,"f"),o(this,Hl,{ringDuration:0,callingDuration:0,callDuration:0,holdDuration:0},"f"),this.callReport=fa({extension:t.number,callId:t.callId}),o(this,jl,new kl((e=>{let{ringDuration:t,callingDuration:n,callDuration:s,holdDuration:r}=this.timer;const{callStatus:i,isHold:o}=this.status;this.timer={ringDuration:"ringing"===i?t++:t,callingDuration:"calling"===i?n++:n,callDuration:"talking"===i?s++:0,holdDuration:"talking"===i&&o?r++:0}})),"f"),i(this,jl,"f").start(),o(this,Gl,n,"f"),i(this,ia,"f").call(this),Gt.info(`${_a}Create session. callId:${t.callId}`)}get status(){return i(this,ql,"f")}get incomingList(){return i(this,Gl,"f").incomingList}set status(e){const t=Object.assign({},i(this,ql,"f"));o(this,ql,$t(t,e),"f"),this.emitEvent("statusChange",i(this,ql,"f"),t)}get timer(){return i(this,Hl,"f")}get localStream(){return i(this,Bl,"f")}set localStream(e){o(this,Bl,e,"f"),this.emitEvent("updateLocalStream",{callId:i(this,ql,"f").callId,localStream:i(this,Bl,"f")})}get remoteStream(){return i(this,Wl,"f")}set remoteStream(e){o(this,Wl,e,"f"),this.emitEvent("updateRemoteStream",{callId:i(this,ql,"f").callId,remoteStream:i(this,Wl,"f")})}set timer(e){const t=$t(i(this,Hl,"f"),e);o(this,Hl,t,"f"),this.emitEvent("updateTimer",{callId:i(this,ql,"f").callId,timer:i(this,Hl,"f")})}}var ma,ga,Ta,va,Ea,Ca,Sa,Aa,Ra,ya,ba,wa,Ia,Oa;ql=new WeakMap,Hl=new WeakMap,jl=new WeakMap,Bl=new WeakMap,Wl=new WeakMap,Gl=new WeakMap,Vl=new WeakMap,Kl=new WeakMap,zl=new WeakMap,Jl=new WeakMap,Xl=new WeakMap,Yl=new WeakMap,Ql=new WeakMap,Zl=new WeakMap,ea=new WeakMap,ta=new WeakMap,na=new WeakMap,sa=new WeakMap,ra=new WeakMap,ia=new WeakMap,oa=new WeakMap;const Na="[phone] ";class Da extends Bs.EventEmitter{constructor(e,t){super(),ma.set(this,void 0),ga.set(this,void 0),Ta.set(this,0),va.set(this,!1),Ea.set(this,0),Ca.set(this,!0),Sa.set(this,null),this.emitEvent=(e,...t)=>(this.emit(e,...t),!0),this.on=(e,t)=>this.addListener(e,t),Aa.set(this,(e=>{const{host:t,number:n,registername:s,ha1:r,userAgent:i="WebClient",realm:o="YSAsterisk"}=e,l=new Ul.WebSocketInterface(`wss://${t.host}/ws`),a="sip:"+n+"@"+t.hostname,u={sockets:[l],uri:a,contact_uri:`${a};${i.toLowerCase()}`,authorization_user:s||n,ha1:r,realm:o,register:!0,user_agent:i,session_timers:!0,register_expires:1800,no_answer_timeout:300};return new Ul.UA(u)})),Ra.set(this,((e,t,n)=>{const s=e.remote_identity.uri.user,r={name:e.remote_identity.display_name||s,number:s,avatar:"",callId:t,communicationType:"outbound",isVideo:!1,isRing:!1,isHold:!1,isMute:!1,callStatus:"calling",callStartTime:Date.now(),recordStatus:"stop",isTransfer:!1,isConference:!1,company:""};if("incoming"===e.direction)r.communicationType="inbound",r.isRing=!0,r.callStatus="connecting";else{const e=i(this,Sa,"f");r.isVideo=(null==e?void 0:e.isVideo)||!1;let t=null==e?void 0:e.attendedInfo;t&&(r.isTransfer=!0,r.transferParent=t),(null==e?void 0:e.avatar)&&(r.avatar=e.avatar),(null==e?void 0:e.name)&&(r.name=e.name),o(this,Sa,null,"f")}return new pa(e,$t(r,n||{}),this)})),ya.set(this,(()=>r(this,void 0,void 0,(function*(){if(1===i(this,ma,"f").status)return o(this,Ta,0,"f"),Gt.info(`${Na}The UA is ready, No need to re-register.`),Promise.reject();if(i(this,wa,"f").call(this))return Promise.reject();try{const e=yield ws(),{registername:t,registerpassword:n,realm:s}=e.data;return this.config.ha1=n,this.config.registername=t,this.config.realm=s,this.reRegister(t,n),Promise.resolve()}catch(e){return Gt.error(`${Na}Re-init failed.`,e),Promise.reject()}})))),ba.set(this,(e=>"outgoing"===e&&(!!i(this,Sa,"f")&&!!i(this,Sa,"f").attendedInfo))),this.start=()=>{let e;i(this,ma,"f").on("newRTCSession",(e=>r(this,void 0,void 0,(function*(){const{originator:t,session:n,request:s}=e;Gt.info(Na+"newRTCSession emit.");const r=s.getHeader("call-id");if(!r)return void Gt.error(`${Na}can not get call id.`);if(da(Wt.get("callWaiting"),this.sessions)&&!i(this,ba,"f").call(this,n.direction))return void n.terminate({status_code:Number([0,1,2].includes(n.status)?"487":"486")});const o=i(this,Ra,"f").call(this,n,r);if(Gt.info(`${Na}generate session obj. call id: ${r}`),"remote"===t){const e=s.getHeader("Contacts-Company"),t="video"===Fl(s.body),n=yield ua(o.status.number,Na);o.setStatus({company:e,isVideo:t,avatar:n||""});void 0!==s.getHeader("Session-Expires")?(o.RTCSession._sessionTimers.enabled=!0,o.RTCSession._sessionTimers.refresher=!0):o.RTCSession._sessionTimers.enabled=!1}i(this,ga,"f").set(r,o),this.emitEvent("newRTCSession",{callId:r,session:o}),"remote"===t?this.emitEvent("incoming",{callId:r,session:o}):(this.currentSessionID=r,this.emitEvent("startSession",{callId:r,session:o}))}))));const t=n=>{n.socket.send("heartbeat"),e=setTimeout((()=>{t(n)}),3e4)};return i(this,ma,"f").on("connected",(n=>{e&&clearTimeout(e),t(n),Gt.info(`${Na}connected.`),this.emitEvent("connected")})),i(this,ma,"f").on("connecting",(()=>{Gt.info(`${Na}connecting.`)})),i(this,ma,"f").on("disconnected",(()=>{o(this,Ta,0,"f"),this.isRegistered=!1,Gt.info(`${Na}disconnected.`),this.emitEvent("disconnected")})),i(this,ma,"f").on("registered",(()=>{o(this,Ta,0,"f"),this.isRegistered=!0,Gt.info(`${Na}registered.`),this.emitEvent("registered")})),i(this,ma,"f").on("registrationFailed",(e=>{this.isRegistered=!1,"Request Timeout"===e.cause||"Connection Error"===e.cause||"Rejected"===e.cause?this.reRegister(this.config.registername,this.config.ha1):"Authentication Error"===e.cause&&i(this,ya,"f").call(this),Gt.info(`${Na}registrationFailed, Cause: ${e.cause}`),this.emitEvent("registrationFailed",e.cause)})),i(this,ma,"f").on("unregistered",(()=>{this.isRegistered=!1,Gt.info(`${Na}unregistered.`)})),i(this,ma,"f").start(),this},wa.set(this,(()=>!(void 0!==this.reRegistryPhoneTimes&&i(this,Ta,"f")>=this.reRegistryPhoneTimes))),this.reRegister=(e,t)=>{var n;return 1===i(this,ma,"f").status?(o(this,Ta,0,"f"),Gt.info(`${Na}The UA is ready, No need to re-register.`),this):!1===i(this,wa,"f").call(this)?Hs.error("RE_REGISTRY_MAX_LIMIT_TIMES"):(o(this,Ta,(n=i(this,Ta,"f"),++n),"f"),i(this,ma,"f").set("ha1",t),i(this,ma,"f").set("authorization_user",e),i(this,ma,"f").register(),Gt.info(`${Na}reRegister the UA.`),this)},Ia.set(this,null),this.call=(e,t,n)=>r(this,void 0,void 0,(function*(){var s,r;if(ha("call",this.sessions))return Promise.reject(Hs.error("CURRENT_CALL_HAS_NOT_CONNECTED"));if(!e)return Promise.reject(Hs.error("INVALID_NUMBER"));if(i(this,Ia,"f"))return Promise.reject(Hs.error("CALL_TOO_MANY_TIMES"));if(o(this,Ia,setTimeout((()=>{o(this,Ia,null,"f")}),1e3),"f"),da(Wt.get("callWaiting"),this.sessions)&&!n)return Promise.reject(Hs.error("MAX_LIMIT_CALL"));Gt.info(Na+"start call.");const l=(null==t?void 0:t.video)?"video":"audio",a=(null===(s=this.deviceIds)||void 0===s?void 0:s.microphoneId)||void 0,u=(null===(r=this.deviceIds)||void 0===r?void 0:r.cameraId)||void 0,c=yield Ht("video"===l,a,u);if(null===c)return Promise.reject(Hs.error("GET_LOCAL_MEDIA_INFO_ERROR"));if(c.isNoneAudio)return Promise.reject(Hs.error("NOT_FOUND_AUDIO_INPUT_DEVICE"));const{mediaConstraints:h,isNoneCamera:d}=c;if("video"===l&&d)return Promise.reject(Hs.error("NOT_FOUND_VIDEO_INPUT_DEVICE"));if(!1===(yield jt(l)))return Promise.reject(Hs.error("GET_AGREE_CHROME_USER_MEDIA_ROLE_ERROR"));Gt.info(Na+"Check local stream."),o(this,Ca,d,"f");const f={mediaConstraints:h,rtcOfferConstraints:{offerToReceiveAudio:!0,offerToReceiveVideo:(null==t?void 0:t.offerToReceiveVideo)||!1},sessionTimersExpires:1800,extraHeaders:null==t?void 0:t.extraHeaders},{fqdnDomain:_,cloudDomain:p,showCloudPlan:m,enableNatFqdn:g,turnPort:T}=Wt.get();let v;if(m?f.pcConfig={iceServers:[{urls:[`stun:${p}:${T}`]}]}:1===g&&_&&(f.pcConfig={iceServers:[{urls:[`stun:${_}:${T}`]}]}),n){const e=i(this,ga,"f").get(n);if(!e)return Promise.reject(Hs.error("ATTENDED_PARENT_NOT_FOUND"));v={callId:n,avatar:e.status.avatar,name:e.status.name,number:e.status.number,callDuration:e.timer.callDuration,holdDuration:e.timer.holdDuration}}var E;aa(this.sessions),(E={type:"call"},ys.post("/v1.0/dct/init",E)).then();const C=yield ca(e,Na),S=yield ua(e,Na);o(this,Sa,{isVideo:"video"===l,attendedInfo:v,name:C||void 0,avatar:S||void 0},"f"),Gt.info(Na+"send call.");try{return i(this,ma,"f").call(e,f),Hs.success("SUCCESS")}catch(e){return Hs.error("INVALID_NUMBER")}})),this.reject=e=>{const t=this.terminate(e,"reject");return 0==t&&Gt.error(`${Na}reject failed. Call ID: ${e}`),t},this.answer=(e,t)=>r(this,void 0,void 0,(function*(){const n=i(this,ga,"f").get(e);if(!n)return Promise.reject(Hs.error("NOT_FOUND_CALL_ID"));if(ha("answer",this.sessions))return Gt.info(Na+"This operator has refused because the current call has not been connected."),Promise.reject(Hs.error("CURRENT_CALL_HAS_NOT_CONNECTED"));Gt.info(Na+"Answer call. Call ID: "+e);try{yield n.answer(t)}catch(e){return Promise.reject(e)}return Hs.success("SUCCESS")})),this.hangup=e=>{const t=this.terminate(e,"hangup");return 0==t&&Gt.error(`${Na}hangup failed. Call ID: ${e}`),t},Oa.set(this,((e,t,n)=>{var s,r;if(!t)return Gt.info(`${Na}Transfer failed. type: ${n}. Cause: number params invalid or undefined.`),!1;const o=i(this,ga,"f").get(e);if(!o)return Gt.info(`${Na}Transfer failed. type: ${n}. Cause: not found session.`),!1;const{RTCSession:l}=o,a="sip:"+t+"@"+(null===(s=this.config)||void 0===s?void 0:s.host.hostname);if("attended"===n){const e=null===(r=o.status.transferParent)||void 0===r?void 0:r.callId;if(!e)return Gt.error(`${Na}Transfer failed. type: ${n}.Cause: not found parent call id.`),!1;const t=i(this,ga,"f").get(e);if(!t)return Gt.error(`${Na}Transfer failed. type: ${n}.Cause: not found parent session.`),!1;if("talking"!==o.status.callStatus){const e=Object.keys(l._earlyDialogs);l._status=l.C.STATUS_CONFIRMED,l._dialog=l._earlyDialogs[e[0]]}const s=t.RTCSession;let u=s._from_tag,c=s._to_tag;"inbound"===t.status.communicationType&&(u=s._to_tag,c=s._from_tag);const h={_request:{call_id:t.status.callId},_from_tag:u,_to_tag:c};l.refer(a,{replaces:h})}else l.refer(a),this.terminate(e);return!0})),this.blindTransfer=(e,t)=>(Gt.info(`${Na}Blind transfer dispatch.`),i(this,Oa,"f").call(this,e,t,"blind")),this.attendedTransfer=(e,t)=>(Gt.info(`${Na}Attended transfer dispatch.`),i(this,Oa,"f").call(this,e,t,"attended")),this.hold=e=>{const t=i(this,ga,"f").get(e);return!!t&&(t.hold(),!0)},this.unhold=e=>{const t=i(this,ga,"f").get(e);return!!t&&(t.unhold(),!0)},this.dtmf=(e,t)=>{const n=i(this,ga,"f").get(e);return!!n&&(n.dtmf(t),!0)},this.mute=e=>{const t=i(this,ga,"f").get(e);return!!t&&(t.mute(),!0)},this.unmute=e=>{const t=i(this,ga,"f").get(e);return!!t&&(t.unmute(),!0)},this.startRecord=e=>{const t=i(this,ga,"f").get(e);return!(!t||0===this.recordPermissions)&&(t.startRecord(),!0)},this.pauseRecord=e=>{const t=i(this,ga,"f").get(e);return!(!t||0===this.recordPermissions)&&(t.pauseRecord(),!0)},this.terminate=(e,t="terminate")=>{const n=i(this,ga,"f").get(e);return!!n&&(n.terminate(t),i(this,ga,"f").delete(e),!0)},this.renegotiate=(e,t)=>{const n=i(this,ga,"f").get(e);return!!n&&(n.renegotiate(t),!0)},this.audioToVideo=e=>!!i(this,ga,"f").get(e),this.videoToAudio=e=>{const t=i(this,ga,"f").get(e);return!!t&&(t.videoToAudio(),!0)},this.disconnect=()=>!!i(this,ma,"f")&&(i(this,ma,"f").stop(),Gt.info(Na+"disconnect."),!0),this.getSession=e=>{const t=i(this,ga,"f").get(e);return t||null},this.getSessions=()=>Array.from(i(this,ga,"f").values()),this.setCurrentSession=e=>!!i(this,ga,"f").get(e)&&(this.currentSessionID=e,Gt.info(`${Na}Change current session to: ${e}`),!0),this.getCurrentSession=()=>this.currentSession,this.destroy=()=>{this.isRegistered=!1,i(this,ga,"f").forEach((e=>{e.destroy()})),i(this,ga,"f").clear(),i(this,ma,"f").removeAllListeners(),i(this,ma,"f").stop(),this.removeAllListeners(),Gt.info(`${Na}Phone has been destroy.`)},this.config=e,o(this,ma,i(this,Aa,"f").call(this,e),"f"),o(this,ga,new Map,"f"),this.currentSessionID=null,this.reRegistryPhoneTimes=Wt.get("reRegistryPhoneTimes"),e.jsSIPDebug&&Ul.debug(e.jsSIPDebug),null==t||t.afterInited(this)}get sessions(){return i(this,ga,"f")}get currentSession(){const e=this.currentSessionID;if(!e)return null;const t=this.sessions.get(e);return t||null}get isRegistered(){return i(this,va,"f")}get videoPlan(){return Wt.get("videoPlan")}set isRegistered(e){o(this,va,e,"f"),this.emitEvent("isRegisteredChange",i(this,va,"f"))}get recordPermissions(){return i(this,Ea,"f")}set recordPermissions(e){o(this,Ea,e,"f"),this.emitEvent("recordPermissionsChange",i(this,Ea,"f"))}get incomingList(){return this.getSessions().filter((e=>!0===e.status.isRing))}get isNoneCamera(){return i(this,Ca,"f")}get isMaxCall(){return da(Wt.get("callWaiting"),this.sessions)}}ma=new WeakMap,ga=new WeakMap,Ta=new WeakMap,va=new WeakMap,Ea=new WeakMap,Ca=new WeakMap,Sa=new WeakMap,Aa=new WeakMap,Ra=new WeakMap,ya=new WeakMap,ba=new WeakMap,wa=new WeakMap,Ia=new WeakMap,Oa=new WeakMap;var Pa={};({get exports(){return Pa},set exports(e){Pa=e}}).exports=function(e){var t={};function n(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(s,r,function(t){return e[t]}.bind(null,r));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){function s(e){var t=e.url,n=e.protocols,s=void 0===n?"":n,r=e.pingTimeout,i=void 0===r?15e3:r,o=e.pongTimeout,l=void 0===o?1e4:o,a=e.reconnectTimeout,u=void 0===a?2e3:a,c=e.pingMsg,h=void 0===c?"heartbeat":c,d=e.repeatLimit,f=void 0===d?null:d;this.opts={url:t,protocols:s,pingTimeout:i,pongTimeout:l,reconnectTimeout:u,pingMsg:h,repeatLimit:f},this.ws=null,this.repeat=0,this.onclose=function(){},this.onerror=function(){},this.onopen=function(){},this.onmessage=function(){},this.onreconnect=function(){},this.createWebSocket()}Object.defineProperty(t,"__esModule",{value:!0}),s.prototype.createWebSocket=function(){try{this.opts.protocols?this.ws=new WebSocket(this.opts.url,this.opts.protocols):this.ws=new WebSocket(this.opts.url),this.initEventHandle()}catch(e){throw this.reconnect(),e}},s.prototype.initEventHandle=function(){var e=this;this.ws.onclose=function(){e.onclose(),e.reconnect()},this.ws.onerror=function(){e.onerror(),e.reconnect()},this.ws.onopen=function(){e.repeat=0,e.onopen(),e.heartCheck()},this.ws.onmessage=function(t){e.onmessage(t),e.heartCheck()}},s.prototype.reconnect=function(){var e=this;null!==this.opts.repeatLimit&&this.opts.repeatLimit<=this.repeat||this.lockReconnect||this.forbidReconnect||(this.lockReconnect=!0,this.repeat++,this.onreconnect(),setTimeout((function(){e.createWebSocket(),e.lockReconnect=!1}),this.opts.reconnectTimeout))},s.prototype.send=function(e){this.ws.send(e)},s.prototype.heartCheck=function(){this.heartReset(),this.heartStart()},s.prototype.heartStart=function(){var e=this;this.forbidReconnect||(this.pingTimeoutId=setTimeout((function(){e.ws.send(e.opts.pingMsg),e.pongTimeoutId=setTimeout((function(){e.ws.close()}),e.opts.pongTimeout)}),this.opts.pingTimeout))},s.prototype.heartReset=function(){clearTimeout(this.pingTimeoutId),clearTimeout(this.pongTimeoutId)},s.prototype.close=function(){this.forbidReconnect=!0,this.heartReset(),this.ws.close()},"undefined"!=typeof window&&(window.WebsocketHeartbeatJs=s),t.default=s}]);var xa=h(Pa);const La="connect",Ua="close";class ka extends Bs.EventEmitter{constructor(e){super(),this.init=()=>{this.connection.onopen=()=>{Gt.info("[ws] connection established!"),this.connected=!0,this.isSubScribe||this.resubscribe();const e=(new Date).getTime();Gt.info("[ws] connection timeDiff:",e-this.wsConnectTimeDiff),0!==this.wsConnectTimeDiff&&e-this.wsConnectTimeDiff>=3e5&&(Gt.info("[ws] refresh pages"),this.emit(La),this.wsConnectTimeDiff=0),this.connectedChangeCallBack&&this.connectedChangeCallBack()},this.connection.onmessage=e=>{if(this.sendHeart||(this.sendHeart=setTimeout((()=>{this.connected&&this.connection.send("heartbeat"),clearInterval(this.sendHeart),this.sendHeart=null}),35e3)),(null==e?void 0:e.data)&&"heartbeat response"===(null==e?void 0:e.data)&&this.sendHeart&&(clearInterval(this.sendHeart),this.sendHeart=null),"heartbeat response"===e.data)return;let t={};try{t=JSON.parse(e.data)}catch(e){Gt.error("[ws] JSON parse subscribe message error.")}if(t.hasOwnProperty("errcode")&&-3===t.errcode)return void this.resubscribe();let n=null;if(t.msg){try{n=JSON.parse(t.msg)}catch(e){Gt.error("[ws] JSON parse data error.")}null!==n&&void 0!==t.type&&-2!==t.errcode&&this.emit(String(t.type),e)}},this.connection.onreconnect=()=>{Gt.info("[ws] reconnecting...")},this.connection.onerror=()=>{this.connected=!1,this.isSubScribe=!1,Gt.info("[ws] error"),this.connectedChangeCallBack&&this.connectedChangeCallBack()},this.connection.onclose=()=>{Gt.info("[ws] close"),this.emit("close"),this.connected=!1,this.isSubScribe=!1,0===this.wsConnectTimeDiff&&(this.wsConnectTimeDiff=(new Date).getTime()),this.connectedChangeCallBack&&this.connectedChangeCallBack()}},this.stop=()=>{this.connected&&(this.subscribes=[],this.isSubScribe=!1,this.subscribeKeys={},this.listenKeys={},this.connection.close())},this.send=e=>{this.connected&&this.connection.send(e)},this.onConnectListen=e=>{this.addListener(La,e)},this.onRemoveConnectListen=e=>{e?this.removeListener(La,e):this.removeAllListeners(La)},this.onCLose=e=>{this.addListener(Ua,e)},this.onRemoveClose=e=>{e?this.removeListener(Ua,e):this.removeAllListeners(Ua)},this.onSubscribe=e=>{var t;const{addList:n,removeList:s}=e;null==n||n.subscribeCodes.forEach((e=>{const t=n.listener;this.subscribeKeys[e]?this.subscribeKeys[e].acount+=1:(this.subscribeKeys[e]={},this.subscribeKeys[e].acount=1),this.addListener(String(e),t)})),null==s||s.subscribeCodes.forEach((e=>{const t=s.listener;this.subscribeKeys[e]&&(this.subscribeKeys[e].acount-=1,this.subscribeKeys[e].acount<=0&&(this.subscribeKeys[e]=null,delete this.subscribeKeys[e]),t?this.removeListener(String(e),t):this.removeAllListeners(String(e)))})),this.resubscribe(null===(t=Object.keys(this.subscribeKeys))||void 0===t?void 0:t.map((e=>Number(e))))},this.resubscribe=e=>{var t;if(!this.connected)return;this.isSubScribe=!0;let n=[];e&&e.length?(n=[...e],this.subscribes.map((e=>{e.global&&(n=n.concat(e.topicList))}))):(this.subscribes.map((e=>{n=n.concat(e.topicList)})),n=n.concat(null===(t=Object.keys(this.subscribeKeys))||void 0===t?void 0:t.map((e=>Number(e))))),n=[...new Set(n)],n.length>0&&this.connection.send(JSON.stringify({topic_list:n}))},this.onConnectedChange=e=>{this.connectedChangeCallBack=e};try{this.connection=new xa({url:e,pingTimeout:3e4,pongTimeout:2e4,reconnectTimeout:5e3,pingMsg:"heartbeat"}),this.init()}catch(e){Gt.error("[ws] instance error.",e)}this.isSubScribe=!1,this.connected=!1,this.subscribes=[],this.connectKeys=[],this.subscribeKeys={},this.listenKeys={},this.wsConnectTimeDiff=0,this.connectedChangeCallBack=null,this.sendHeart=null}}var Ma,$a,Fa,qa,Ha,ja,Ba,Wa;const Ga="[PBX] ";class Va{constructor(e){Ma.add(this),this.token=null,this.socket=null,$a.set(this,!1),Fa.set(this,(()=>r(this,void 0,void 0,(function*(){try{const t=Wt.get("userAgent"),{data:n}=yield(e={username:this.username,password:this.secret,login_source:"WebPC"===t?"webpc":null,login_jump:"sdk"},ys.post("/v1.0/login",e)),{access_token:s,errcode:r,errmsg:i}=n;return 0!==r?(this.token=null,Gt.error(`${Ga}Login failed. Error code: ${r}, Error Message: ${i}`),Promise.reject(qs.error("PBX_API_ERROR"))):(this.token=s,Wt.set("token",s),ys.token=s,Gt.info(`${Ga}Login.`),{token:s})}catch(e){return this.token=null,Gt.error(`${Ga}Login error.`,e),Promise.reject(qs.error("PBX_NETWORK_ERROR"))}var e})))),qa.set(this,(()=>r(this,void 0,void 0,(function*(){try{const{data:e}=yield ys.get("/v1.0/extension/getpersonalglobal"),{errmsg:t,errcode:n,enable_nat_fqdn:s=0,fqdn_domain:r="",cloud_domain:i="",turn_port:o=11009,record_feature_code:l="",enb_internal_client:a=0}=e;if(0!==n)return Gt.error(`${Ga}Get personal global data failed. Error code: ${n}, Error Message: ${t}`),Promise.reject(qs.error("PBX_API_ERROR"));if("cn"===Wt.get("planMode")&&1!==a)return yield this.logout().catch((e=>{Gt.error(`${Ga}Linkus disabled and logout failed.`)})),Gt.error(`${Ga}Linkus disabled.`),Promise.reject(qs.error("LINKUS_DISABLED"));Wt.set("cloudDomain",i),Wt.set("enableNatFqdn",s),Wt.set("fqdnDomain",r),Wt.set("turnPort",o),Wt.set("recordCode",l)}catch(e){return Gt.error(`${Ga}Get personal global error.`,e),Promise.reject(qs.error("PBX_NETWORK_ERROR"))}})))),Ha.set(this,(()=>r(this,void 0,void 0,(function*(){try{const{data:e}=yield ys.get("/v1.0/licenseservice/get"),{errmsg:t,errcode:n}=e;if(0!==n)return Gt.error(`${Ga}Get license service failed. Error code: ${n}, Error Message: ${t}`),Promise.reject(qs.error("PBX_API_ERROR"));const{fqdnStatus:s,videoStatus:r}=Bt(e);Wt.set("fqdnStatus",s),Wt.set("videoPlan",r)}catch(e){return Gt.error(`${Ga}Get license service error.`,e),Promise.reject(qs.error("PBX_NETWORK_ERROR"))}})))),ja.set(this,(()=>r(this,void 0,void 0,(function*(){try{const{data:e}=yield ys.get("v1.0/extension/getpersonal"),{errcode:t,errmsg:n}=e;if(0!==t)return Gt.error(`${Ga}Get extension data failed. Error code: ${t}, Error Message: ${n}`),Promise.reject(qs.error("PBX_API_ERROR"));if(!e.extension)return Promise.reject(qs.error("GET_PERSONAL_NOT_FOUND_DATA"));const{id:s,number:r,caller_id_name:i,enb_web_client_call_waiting:o,enb_ctl_record:l,enb_web_client:a,enb_desktop_client:u}=e.extension,c=Wt.get("planMode"),h=Wt.get("userAgent");if("en"===c&&1!==("WebClient"===h?a:u))return yield this.logout().catch((e=>{Gt.error(`${Ga}Linkus disabled and logout failed.`)})),Gt.error(`${Ga}Linkus disabled.`),Promise.reject(qs.error("LINKUS_DISABLED"));this.extensionId=s,this.extensionName=i,this.extensionNumber=r,Wt.set("extensionId",s),Wt.set("extensionNumber",r);const d=0!==o;return Wt.set("callWaiting",d),{extensionNumber:r,extensionId:s,extensionName:i,recordPermissions:l}}catch(e){return Gt.error(`${Ga}Get extension info error.`,e),Promise.reject(qs.error("PBX_NETWORK_ERROR"))}})))),Ba.set(this,(()=>r(this,void 0,void 0,(function*(){try{const{data:e}=yield ws(),{realm:t,registername:n,registerpassword:s,errcode:r,errmsg:i}=e;return 0!==r?(Gt.error(`${Ga}Get register info failed. Error code: ${r}, Error Message: ${i}`),Promise.reject(qs.error("PBX_API_ERROR"))):(Gt.info(`${Ga}Get registry info.`),{realm:t,registername:n,registerpassword:s})}catch(e){return Gt.error(`${Ga}Get registry info error.`,e),Promise.reject(qs.error("PBX_NETWORK_ERROR"))}})))),this.init=()=>r(this,void 0,void 0,(function*(){if(i(this,$a,"f"))return Promise.reject(qs.error("PBX_ALREADY_INITIALIZED"));try{yield i(this,Fa,"f").call(this),yield i(this,qa,"f").call(this),yield i(this,Ha,"f").call(this);const{extensionNumber:e,extensionId:t,extensionName:n,recordPermissions:s}=yield i(this,ja,"f").call(this),{realm:r,registername:l,registerpassword:a}=yield i(this,Ba,"f").call(this),u={realm:r,registername:l,ha1:a,extensionNumber:e,extensionId:t,extensionName:n,recordPermissions:s};return i(this,Ma,"m",Wa).call(this),o(this,$a,!0,"f"),Gt.info(`${Ga}PBX init success.`),Promise.resolve(u)}catch(e){return this.token=null,o(this,$a,!1,"f"),Gt.error(`${Ga}Init failed.`),Promise.reject(e)}})),this.destroy=()=>{var e,t;null===(e=this.socket)||void 0===e||e.removeAllListeners(),null===(t=this.socket)||void 0===t||t.stop(),this.socket=null,this.token=null,this.secret="",o(this,$a,!1,"f"),Wt.remove("token"),ys.token="",Gt.info(`${Ga}Pbx has been destroy.`)},this.cdrQuery=e=>r(this,void 0,void 0,(function*(){const{page:t=1,size:n=20,status:s=0,sortBy:r="time",orderBy:i="desc",filter:o=null}=e||{};try{const{data:e}=yield(e=>ys.get("/v1.0/cdr/searchpersonal",e))({page:t,page_size:n,sort_by:r,order_by:i,status:s,number:o});return e}catch(e){return Promise.reject(e)}})),this.logout=()=>r(this,void 0,void 0,(function*(){try{const{data:e}=yield ys.get("/v1.0/logout"),{errcode:t,errmsg:n}=e;return{errcode:t,errmsg:n}}catch(e){return Promise.reject(e)}})),this.secret=e.secret,this.username=e.username,this.url=e.url,this.token=this.secret}get info(){return{token:this.token,extensionId:this.extensionId,url:this.url}}get isInited(){return i(this,$a,"f")}}$a=new WeakMap,Fa=new WeakMap,qa=new WeakMap,Ha=new WeakMap,ja=new WeakMap,Ba=new WeakMap,Ma=new WeakSet,Wa=function(){this.socket=new ka("wss://"+this.url.host+"/api/v1.0/subscribe?access_token="+this.token),Gt.info(`${Ga}Create pbx subscribe socket.`),this.socket.init(),Gt.info(`${Ga}Init pbx subscribe socket.`)};const Ka="[PBX Subscribe] ";function za(e,t,n,s,i,o=!1){return r(this,void 0,void 0,(function*(){if(o)try{yield t.logout()}catch(e){Gt.error(`${Ka}Log failed.`)}throw t.destroy(),e.destroy(),Gt.error(`${Ka}Got ${n}, ${s}`),qs.error(i)}))}const Ja=["10000","20007","20008","20010","20015","20053","20065","20066","20047","20048","20104","20082"];var Xa="1.0.4";const Ya="[main] ";function Qa(){return r(this,void 0,void 0,(function*(){try{const{data:e}=yield bs(),{product:t={},errcode:n}=e;if(0!==n)return!1;if(void 0===t.base_oem_id)return Gt.error(`${Ya}SDK does not support this PBX firmware version.`),!1;const s=kt({company_name:t.company_name||"",disp_dev_name:t.disp_dev_name||"",oem_id:t.oem_id||"",platform_name:t.platform_name||"",product_name:t.product_name||"",product_type:t.product_type||"",version:t.version||"",sdk_version:Xa});return Wt.set("productInfo",s),Wt.set("planMode",1===t.base_oem_id?"cn":"en"),"p_cloudpbx"===t.platform_name&&Wt.set("showCloudPlan",!0),Gt.log("record",`${Ya}get product success.`,JSON.stringify(s)),!0}catch(e){return Gt.error(`${Ya}get product failed.`),!1}}))}function Za(e,t){e.destroy(),t.destroy()}return e.PBXOperator=Va,e.PHONE_ERROR=Us,e.PhoneOperator=Da,e.Result=Fs,e.Session=pa,e.init=function(e){var t;return r(this,void 0,void 0,(function*(){const{enableLog:n=!0,pbxURL:s,username:i,secret:o,reRegistryPhoneTimes:l,userAgent:a="WebClient",deviceIds:c={}}=e;!1===n&&Gt.disable(),u.init({uploadLog:Ns}),Gt.username=i,Gt.info(`${Ya}init invoke.`);const h=function(e){if(e instanceof URL)return Gt.info(`${Ya}get url success.`),e;if("string"!=typeof e)return Gt.error(`${Ya}pbxURL type must a string or URL.`),null;let t=null;try{t=new URL(e)}catch(e){Gt.error(`${Ya}invalid pbxURL.`)}return Gt.info(`${Ya}get url success.`),t}(s);if(null===h)return Promise.reject(Fs.error("INVALID_PBX_URL"));if(!function(e){const t="https:"===e.protocol;return!1===t&&Gt.error(`${Ya}pbxURL protocol not https. url.protocol: ${e.protocol}`),Gt.info(`${Ya}check url success.`),t}(h))return Promise.reject(Fs.error("PBX_URL_NOT_HTTPS"));Wt.set("pbxURL",h),Wt.set("secret",o),Wt.set("username",i),Wt.set("userAgent",a),function(e,t){const n={baseURL:e+"/api",timeout:6e5};ys.config=n}(h.origin);if(!1===(yield Qa()))return Promise.reject(Fs.error("GET_PRODUCT_FAILED"));null!=l||Wt.set("reRegistryPhoneTimes",l);const d=new Va({url:h,secret:o,username:i});let f;try{f=yield d.init()}catch(e){return Promise.reject(e)}const _=new Da({id:f.extensionId,host:h,registername:f.registername,ha1:f.ha1,realm:f.realm,number:f.extensionNumber,userAgent:a});_.deviceIds=c,_.recordPermissions=f.recordPermissions;const p=new Array;return"WebClient"===a?p.push("20015"):p.push("20013"),null===(t=d.socket)||void 0===t||t.onSubscribe({addList:{subscribeCodes:Ja.concat(p),listener:e=>{!function(e,t,n){var s;r(this,void 0,void 0,(function*(){const r=JSON.parse(e.data),i=JSON.parse(r.msg),o=r.type,l=Wt.get("extensionNumber");switch(o){case 1e4:if(i.username===Wt.get("extensionNumber"))throw n.destroy(),t.destroy(),Gt.error(`${Ka}Got ${o}, It seems like you have logged in elsewhere!`),qs.error("LOGGED_IN_ELSEWHERE");break;case 20007:za(t,n,o,"Extension has been deleted!","EXTENSION_DELETED");break;case 20008:const e=i.record_feature_code;Gt.info(`${Ka}Got ${o}, Record code change: ${e}`),Wt.set("recordCode",e);break;case 20010:za(t,n,o,"Need re-login!","RE_LOGIN");break;case 20053:const{fqdnStatus:r,videoStatus:a}=Bt(i);Wt.set("fqdnStatus",r),Wt.set("videoPlan",a),t.emitEvent("videoPlanChange",a);break;case 20065:Wt.set("enableNatFqdn",i.enable_nat_fqdn),Wt.set("fqdnDomain",i.fqdn_domain),Wt.set("turnPort",i.turn_port);break;case 20066:Gt.info(`${Ka}Got ${o}, Registry info change.`),t.config.ha1=i.reg_password,t.config.registername=i.reg_name,t.config.realm=i.realm,t.reRegister(i.reg_name,i.reg_password);break;case 20047:Gt.info(`${Ka}Got ${o}, Registry info change.`),t.recordPermissions=i.enb_ctl_record;break;case 20048:Gt.info(`${Ka}Got ${o}, Record status change.`);const u="conference"===i.call_feature;let c="";if(l===i.callee_origin_number&&(c=i.callee_sip_callid),l===i.caller_origin_number&&(c=i.caller_sip_callid),t.sessions.has(c)){Gt.info(`${Ka}Change session status.`);const e=t.sessions.get(c),n=Object.assign({},e.status);e.setStatus({recordStatus:i.record_status,isConference:u}).emitEvent("statusChange",e.status,n)}break;case 20104:Gt.info(`${Ka}Got ${o}, Hot standby status change.`),null===(s=n.socket)||void 0===s||s.resubscribe();break;case 20135:{Gt.info(`${Ka}Got ${o}, Call waiting value change.`);const e=0!==i.enb_call_waiting;Wt.set("callWaiting",e);break}case 20082:if("cn"!==Wt.get("planMode"))return;1!==i.enb_internal_client&&za(t,n,o,"Linkus client has been disabled!","LINKUS_DISABLED",!0);break;case 20013:if("en"!==Wt.get("planMode"))return;if("WebPC"!==Wt.get("userAgent"))return;1!==i.enb_desktop_client&&za(t,n,o,"Linkus client has been disabled!","LINKUS_DISABLED",!0);break;case 20015:if("en"!==Wt.get("planMode"))return;if("WebClient"!==Wt.get("userAgent"))return;1!==i.enb_web_client&&za(t,n,o,"Linkus client has been disabled!","LINKUS_DISABLED",!0)}}))}(e,_,d)}}}),window&&window.addEventListener("unload",(e=>{e.preventDefault();try{Za(_,d)}catch(e){Gt.error(`${Ya}Unload page, Destroy error.`)}})),{phone:_,pbx:d,destroy:()=>{Za(_,d)}}}))},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
